(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{837:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eh});var n=s(5155),a=s(2115),o=s(5863),r=s(2596),i=s(9688);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,r.$)(t))}let c=a.forwardRef((e,t)=>{let{className:s,value:a,...r}=e;return(0,n.jsx)(o.bL,{ref:t,className:l("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...r,children:(0,n.jsx)(o.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});c.displayName=o.bL.displayName;var d=s(646),u=s(4861),m=s(4186),h=s(9869),p=s(9890),f=s(1886),g=s(6671);let x=new Map;function v(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(x.has(e))return;let a=g.o[t](s,{...n,onDismiss(){x.delete(e),"function"==typeof n.onDismiss&&n.onDismiss()}});x.set(e,a)}var b=s(5604);function y(e){let{onUploadComplete:t,trigger:s}=e,o=(0,a.useRef)(null),[r,i]=(0,a.useState)(new Map);(0,a.useEffect)(()=>b.uploadCoordinator.onProgress(e=>{i(t=>{let s=new Map(t);return("complete"===e.transaction.state||"error"===e.transaction.state)&&setTimeout(()=>{i(t=>{let s=new Map(t);return s.delete(e.transaction.id),s})},3e3),s.set(e.transaction.id,e),s})}),[]),(0,a.useEffect)(()=>{s&&o.current&&o.current.click()},[s]);let l=(0,a.useCallback)(async e=>{var s;if(!(null===(s=e.target.files)||void 0===s?void 0:s.length))return;let n=Array.from(e.target.files);if(n.filter(e=>e.size>0x6400000).length){v("upload-filesize","error","Files too large. Maximum 100MB");return}for(let e of n)try{let t=await b.uploadCoordinator.startUpload(e);console.log("\uD83D\uDE80 Started upload transaction: ".concat(t," for ").concat(e.name))}catch(t){console.error("Failed to start upload for ".concat(e.name,":"),t),v("upload-error-".concat(e.name),"error","Upload failed: ".concat(e.name))}if(t){let e=()=>{let s=Array.from(r.values());s.every(e=>"complete"===e.transaction.state||"error"===e.transaction.state)&&s.length>0?t():setTimeout(e,1e3)};setTimeout(e,1e3)}e.target.value=""},[r,t]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("input",{ref:o,type:"file",multiple:!0,accept:"image/*,video/*,.gif,.mov,.m4v,.heic,.heif",onChange:l,className:"hidden"}),r.size>0&&(0,n.jsx)("div",{className:"fixed bottom-4 right-4 space-y-2 z-50",children:Array.from(r.values()).map(e=>(0,n.jsx)(w,{upload:e},e.transaction.id))})]})}function w(e){let{upload:t}=e,{transaction:s,progress:a,stage:o,message:r}=t;return(0,n.jsxs)("div",{className:"p-3 rounded-lg border ".concat((()=>{switch(s.state){case"complete":return"bg-green-100 border-green-300";case"error":return"bg-red-100 border-red-300";case"cancelled":return"bg-gray-100 border-gray-300";default:return"bg-blue-100 border-blue-300"}})()," min-w-64 max-w-sm"),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-sm font-medium truncate",children:s.filename}),(()=>{switch(s.state){case"complete":return(0,n.jsx)("span",{className:"text-green-500",children:"✓"});case"error":return(0,n.jsx)("span",{className:"text-red-500",children:"✗"});case"cancelled":return(0,n.jsx)("span",{className:"text-gray-500",children:"⊗"});default:return(0,n.jsx)("span",{className:"text-blue-500 animate-spin",children:"⟳"})}})()]}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[(0,n.jsx)("span",{children:r||o}),(0,n.jsxs)("span",{children:[a,"%"]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:(0,n.jsx)("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all duration-300",style:{width:"".concat(a,"%")}})}),s.error&&(0,n.jsx)("div",{className:"text-xs text-red-600 mt-1",children:s.error})]})}var j=s(5143),N=s(402),S=s(8266);function k(e){let{src:t,alt:s,className:o,placeholder:r="/placeholder.svg"}=e,[i,l]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=new IntersectionObserver(t=>{let[s]=t;s.isIntersecting&&(d(!0),e.disconnect())},{rootMargin:"50px",threshold:.1});return u.current&&e.observe(u.current),()=>e.disconnect()},[]),(0,n.jsx)("img",{ref:u,src:c?t:r,alt:s,className:"".concat(o," ").concat(!i&&c?"opacity-50":"opacity-100"," transition-opacity duration-300"),onLoad:()=>l(!0),loading:"lazy"})}function C(e){let{item:t,isActive:s,isInLoop:a,onActivate:o,onDelete:r,onAddToLoop:i,onRemove:l}=e,{attributes:c,listeners:d,setNodeRef:u,transform:m,transition:h,isDragging:p}=(0,N.gl)({id:t.slug}),f={transform:S.Ks.Transform.toString(m),transition:h,opacity:p?.5:1};return(0,n.jsxs)("div",{ref:u,style:f,className:"group flex items-center gap-8 p-8 transition-all ".concat(s?"bg-accent":"hover:bg-accent/30"),children:[(0,n.jsx)("div",{...c,...d,className:"cursor-grab active:cursor-grabbing opacity-30 hover:opacity-100 transition-opacity",children:(0,n.jsxs)("div",{className:"w-5 h-5 flex flex-col gap-1",children:[(0,n.jsx)("div",{className:"w-full h-0.5 bg-current rounded"}),(0,n.jsx)("div",{className:"w-full h-0.5 bg-current rounded"}),(0,n.jsx)("div",{className:"w-full h-0.5 bg-current rounded"})]})}),(0,n.jsx)("div",{className:"w-32 aspect-[32/24] rounded-2xl overflow-hidden bg-muted flex-shrink-0 ".concat(a?"":"opacity-40 grayscale"),children:t.url&&t.type.startsWith("image/")?(0,n.jsx)(k,{src:t.url,alt:t.filename,className:"w-full h-full object-cover ".concat("processing"===t.processing_status?"animate-pulse":"")}):t.url&&t.type.startsWith("video/")?(0,n.jsx)("video",{src:t.url,muted:!0,loop:!0,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover ".concat("processing"===t.processing_status?"animate-pulse":"")}):(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:"□"})})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"flex items-center gap-4 mb-2",children:(0,n.jsx)("h4",{className:"font-semibold text-lg truncate",children:t.filename})}),(0,n.jsxs)("div",{className:"flex items-center gap-8 text-sm text-muted-foreground",children:[(0,n.jsxs)("span",{children:[(t.size/1024/1024).toFixed(1)," MB"]}),(0,n.jsx)("span",{children:new Date(t.uploadedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),t.duration&&(0,n.jsxs)("span",{children:[t.duration,"s"]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity",children:["processing"===t.processing_status?(0,n.jsx)("div",{className:"px-3 py-1 rounded-full text-xs font-medium bg-blue-500 text-white",children:"Processing..."}):(0,n.jsx)("button",{onClick:()=>a?l(t.slug):i(t),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors ".concat(a?"bg-green-400 text-black hover:bg-green-500":"bg-muted text-muted-foreground hover:bg-accent"),title:a?"Disable":"Enable",children:a?"Active":"Inactive"}),(0,n.jsx)("button",{onClick:()=>r(t.slug),className:"h-12 w-12 rounded-xl hover:bg-destructive hover:text-white flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-lg",children:"\xd7"})})]})]})}function A(e){let t=new Map;for(let s of e){let e=t.get(s.filename);if(!e){t.set(s.filename,s);continue}let n=e=>{switch(e){case"completed":return 3;case"processing":return 2;case"uploaded":return 1;default:return 0}};n(s.processing_status)>n(e.processing_status)&&t.set(s.filename,s)}return Array.from(t.values())}function E(e){let{progress:t}=e,{transaction:s}=t;return(0,n.jsxs)("div",{className:"group flex items-center gap-8 p-8 bg-accent/20 transition-all",children:[(0,n.jsx)("div",{className:"w-5 h-5 opacity-30",children:(0,n.jsx)(h.A,{className:"w-full h-full"})}),(0,n.jsx)("div",{className:"w-32 aspect-[32/24] rounded-2xl overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:(0,n.jsx)(p.A,{className:"h-8 w-8 text-muted-foreground"})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,n.jsx)("h4",{className:"font-semibold text-lg truncate",children:s.filename}),(()=>{switch(s.state){case"complete":return(0,n.jsx)(d.A,{className:"h-4 w-4 text-green-500"});case"error":return(0,n.jsx)(u.A,{className:"h-4 w-4 text-red-500"});default:return(0,n.jsx)(m.A,{className:"h-4 w-4 text-blue-500 animate-spin"})}})()]}),(0,n.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:(()=>{switch(s.state){case"pending":return"Queued...";case"processing":default:return t.message||s.stage||"Processing...";case"uploading":return"Uploading files...";case"finalizing":return"Processing on device...";case"complete":return"Complete";case"error":return s.error||"Error"}})()}),(0,n.jsxs)("span",{className:"text-sm font-medium",children:[Math.round(s.progress),"%"]})]}),(0,n.jsx)(c,{value:s.progress,className:"h-2 w-full max-w-xs"})]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)("div",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat((()=>{switch(s.state){case"complete":return"bg-green-400 text-black";case"error":return"bg-red-400 text-white";case"finalizing":return"bg-purple-400 text-black";default:return"bg-blue-400 text-black"}})()),children:(()=>{switch(s.state){case"processing":return"Converting";case"uploading":return"Uploading";case"finalizing":return"Finalizing";case"complete":return"Complete";case"error":return"Error";default:return"Processing"}})()})})]})}function T(e){var t,o,r;let{dashboardData:i,onCurrentlyPlayingChange:l}=e,[c,d]=(0,a.useState)([]),[u,m]=(0,a.useState)([]),[p,g]=(0,a.useState)(0),[x,b]=(0,a.useState)(!1),[w,S]=(0,a.useState)(new Map);(0,a.useEffect)(()=>{Promise.resolve().then(s.bind(s,5604)).then(e=>{let{uploadCoordinator:t}=e;return t.onProgress(e=>{S(t=>{let s=new Map(t);return("complete"===e.transaction.state||"error"===e.transaction.state)&&setTimeout(()=>{S(t=>{let s=new Map(t);return s.delete(e.transaction.id),s})},3e3),s.set(e.transaction.id,e),s})})})},[]);let k=(0,j.FR)((0,j.MS)(j.AN),(0,j.MS)(j.uN,{coordinateGetter:N.JR}));(0,a.useEffect)(()=>{var e,t;if(!i)return;let s=A(null!==(e=i.media)&&void 0!==e?e:[]),n=(null!==(t=i.loop)&&void 0!==t?t:[]).map(e=>s.find(t=>t.slug===e)).filter(Boolean);if(d(s),m(n),i.active){let e=n.findIndex(e=>e.slug===i.active);-1!==e&&g(e)}},[i]),(0,a.useEffect)(()=>{let e=()=>{(0,f.Uk)(),(0,f.ZW)().then(e=>{var t,s;let n=A(null!==(t=e.media)&&void 0!==t?t:[]);d(n);let a=(null!==(s=e.loop)&&void 0!==s?s:[]).map(e=>n.find(t=>t.slug===e)).filter(Boolean);if(m(a),e.active){let t=a.findIndex(t=>t.slug===e.active);-1!==t&&g(t)}}).catch(console.error)};return window.addEventListener("mediaUploaded",e),()=>{window.removeEventListener("mediaUploaded",e)}},[]),(0,a.useEffect)(()=>{var e,t;if((null==i?void 0:null===(t=i.status)||void 0===t?void 0:null===(e=t.player)||void 0===e?void 0:e.is_playing)&&u.length>0){let e=setInterval(()=>{g(e=>(e+1)%u.length)},8e3);return()=>clearInterval(e)}},[null==i?void 0:null===(o=i.status)||void 0===o?void 0:null===(t=o.player)||void 0===t?void 0:t.is_playing,u.length]),(0,a.useEffect)(()=>{l(u.length>0?u[p]:null)},[u,p,l]);let T=async e=>{try{await (0,f.EL)(e);let t=u.findIndex(t=>t.slug===e);-1!==t&&g(t)}catch(e){v("media-play-fail","error","Failed to play media")}},U=async e=>{try{var t,s;await (0,f.jq)(e);let n=await (0,f.ZW)(),a=A(null!==(t=n.media)&&void 0!==t?t:[]),o=(null!==(s=n.loop)&&void 0!==s?s:[]).map(e=>a.find(t=>t.slug===e)).filter(Boolean);if(d(a),m(o),n.active){let e=o.findIndex(e=>e.slug===n.active);-1!==e&&g(e)}else g(0)}catch(e){v("media-remove-fail","error","Failed to remove from loop")}},_=async e=>{try{var t,s;await (0,f.w8)(e);let n=await (0,f.ZW)(),a=A(null!==(t=n.media)&&void 0!==t?t:[]),o=(null!==(s=n.loop)&&void 0!==s?s:[]).map(e=>a.find(t=>t.slug===e)).filter(Boolean);if(d(a),m(o),n.active&&o.length>0){let e=o.findIndex(e=>e.slug===n.active);-1!==e?g(e):g(0)}else g(0)}catch(e){v("media-delete-fail","error","Failed to delete media")}},I=async e=>{try{var t,s;await (0,f.hR)(e.slug);let n=await (0,f.ZW)(),a=A(null!==(t=n.media)&&void 0!==t?t:[]),o=(null!==(s=n.loop)&&void 0!==s?s:[]).map(e=>a.find(t=>t.slug===e)).filter(Boolean);if(d(a),m(o),n.active){let e=o.findIndex(e=>e.slug===n.active);-1!==e&&g(e)}}catch(e){v("media-add-fail","error","Failed to add to loop")}},F=u.map(e=>e.slug),R=u.length>0?null===(r=u[p])||void 0===r?void 0:r.slug:i.active;return(0,n.jsxs)("div",{className:" pb-16",children:[(0,n.jsx)(y,{onUploadComplete:()=>{(0,f.Uk)()},trigger:x}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"mb-12 flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Loop Library"}),(0,n.jsxs)("p",{className:"text-muted-foreground",children:[c.length," items",(()=>{let e=uploadJobs.filter(e=>"complete"!==e.stage||!c.some(t=>t.filename===e.filename&&"completed"===t.processing_status));return e.length>0?" • ".concat(e.length," uploading"):""})()]})]}),(0,n.jsxs)("button",{onClick:()=>{b(!x)},className:"flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-2xl hover:bg-primary/90 transition-colors",children:[(0,n.jsx)(h.A,{className:"h-4 w-4"}),"Upload Media"]})]}),0===c.length&&0===uploadJobs.filter(e=>"complete"!==e.stage||!c.some(t=>t.filename===e.filename&&"completed"===t.processing_status)).length?(0,n.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-32 text-center",children:[(0,n.jsx)("div",{className:"text-8xl mb-8",children:"□"}),(0,n.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"No media"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Upload files to get started"})]}):(0,n.jsx)("div",{className:"rounded-3xl bg-card overflow-hidden",children:(0,n.jsxs)("div",{className:"divide-y divide-border",children:[Array.from(w.values()).map(e=>(0,n.jsx)(E,{progress:e},e.transaction.id)),c.length>0&&(0,n.jsx)(j.Mp,{sensors:k,collisionDetection:j.fp,onDragEnd:e=>{let{active:t,over:s}=e;s&&t.id!==s.id&&d(e=>{let n=e.findIndex(e=>e.slug===t.id),a=e.findIndex(e=>e.slug===s.id),o=(0,N.be)(e,n,a),r=new Set(u.map(e=>e.slug)),i=o.filter(e=>r.has(e.slug)).map(e=>e.slug);return(0,f.ij)(i).catch(console.error),o})},children:(0,n.jsx)(N.gB,{items:c.map(e=>e.slug),strategy:N._G,children:c.map(e=>(0,n.jsx)(C,{item:e,isActive:e.slug===R,isInLoop:F.includes(e.slug),onActivate:T,onDelete:_,onAddToLoop:I,onRemove:U},e.slug))})})]})})]})]})}class U{connect(){var e;if((null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN){console.log("WebSocket already connected");return}this.connectionState="connecting",this.notifyStateChange();try{let e;let t="https:"===window.location.protocol?"wss:":"ws:";e="".concat(t,"//").concat(window.location.host,"/ws"),0===this.reconnectAttempts&&console.log("Connecting to WebSocket:",e),this.ws=new WebSocket(e),this.ws.onopen=this.handleOpen.bind(this),this.ws.onmessage=this.handleMessage.bind(this),this.ws.onclose=this.handleClose.bind(this),this.ws.onerror=this.handleError.bind(this)}catch(e){console.warn("Failed to create WebSocket connection:",e),this.connectionState="connecting",this.notifyStateChange(),this.scheduleReconnect()}}disconnect(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.ws&&(this.ws.close(),this.ws=null),this.connectionState="disconnected",this.connectionId=null,this.notifyStateChange()}subscribe(e){if("connected"!==this.connectionState||!this.ws){console.warn("Cannot subscribe to ".concat(e,": not connected"));return}this.subscribedRooms.add(e),this.send({type:"subscribe",room:e})}unsubscribe(e){"connected"===this.connectionState&&this.ws&&(this.subscribedRooms.delete(e),this.send({type:"unsubscribe",room:e}))}on(e,t){let s=this.listeners.get(e);return s&&s.add(t),()=>{let s=this.listeners.get(e);s&&s.delete(t)}}off(e,t){let s=this.listeners.get(e);s&&s.delete(t)}getConnectionState(){return this.connectionState}getConnectionId(){return this.connectionId}send(e){var t;(null===(t=this.ws)||void 0===t?void 0:t.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("Cannot send message: WebSocket not connected",e)}handleOpen(){console.log("WebSocket connected successfully"),this.connectionState="connected",this.reconnectAttempts=0,this.reconnectDelay=1e3,this.notifyStateChange(),this.startPing()}handleMessage(e){try{let s=JSON.parse(e.data);if("connection"===s.type){var t;this.connectionId=null===(t=s.data)||void 0===t?void 0:t.connection_id,this.connectionId?console.log("WebSocket connection confirmed:",this.connectionId):console.log("WebSocket connection confirmed"),this.subscribedRooms.forEach(e=>{this.send({type:"subscribe",room:e})})}this.emit(s.type,s)}catch(t){console.error("Failed to parse WebSocket message:",t,e.data)}}handleClose(e){1e3!==e.code&&1001!==e.code&&console.log("WebSocket connection closed:",e.code,e.reason),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),1e3!==e.code?(this.connectionState="connecting",this.scheduleReconnect()):this.connectionState="disconnected",this.connectionId=null,this.notifyStateChange()}handleError(e){this.reconnectAttempts<3?console.log("WebSocket connection issue, retrying..."):console.warn("WebSocket connection problems after multiple attempts"),this.connectionState="connecting",this.notifyStateChange()}emit(e,t){let s=this.listeners.get(e);s&&s.forEach(s=>{try{s(t)}catch(t){console.error("Error in WebSocket event listener for ".concat(e,":"),t)}})}notifyStateChange(){this.emit("connection",{type:"connection",data:{state:this.connectionState,connectionId:this.connectionId}})}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.warn("Max WebSocket reconnection attempts reached. Connection lost."),this.connectionState="error",this.notifyStateChange();return}this.reconnectAttempts++;let e=Math.min(this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.maxReconnectDelay);this.reconnectAttempts>2&&console.log("Reconnecting to WebSocket (attempt ".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{"connected"!==this.connectionState&&this.connect()},e)}startPing(){this.pingInterval&&clearInterval(this.pingInterval),this.pingInterval=setInterval(()=>{"connected"===this.connectionState&&this.send({type:"ping"})},3e4)}constructor(){this.ws=null,this.connectionState="disconnected",this.listeners=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.maxReconnectDelay=3e4,this.pingInterval=null,this.connectionId=null,this.subscribedRooms=new Set,["connection","initial_dashboard","dashboard_update","media_uploaded","media_deleted","loop_updated","playback_changed","wifi_status_changed","system_status_changed","upload_progress","error","subscribe_response","unsubscribe_response","pong"].forEach(e=>{this.listeners.set(e,new Set)})}}let _=new U;function I(){return(0,a.useEffect)(()=>_.on("initial_dashboard",e=>{var t,s,n,a;console.log("initial_dashboard media length =",null===(s=e.data)||void 0===s?void 0:null===(t=s.media)||void 0===t?void 0:t.length,null===(a=e.data)||void 0===a?void 0:null===(n=a.media)||void 0===n?void 0:n.slice(0,2))}),[]),(0,n.jsx)("div",{className:"space-y-16 pb-16",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"mb-12",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Loop Library"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]}),(0,n.jsx)("div",{className:"rounded-3xl bg-muted/20 py-32 text-center",children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Connecting to LOOP..."})]})})]})})}_.connect(),window.addEventListener("focus",()=>{"disconnected"===_.getConnectionState()&&_.connect()});var F=s(184);let R=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(F.bL,{className:l("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...a,ref:t,children:(0,n.jsx)(F.zi,{className:l("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});function P(e){var t,s,a;let{status:o,currentlyPlaying:r}=e,i=async()=>{try{await (0,f.sd)()}catch(e){v("playback-toggle-fail","error","Failed to toggle playback")}},l=async()=>{try{await (0,f.S)()}catch(e){v("loopmode-fail","error","Failed to toggle loop mode")}};return(0,n.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-black border-t border-gray-800",children:(0,n.jsx)("div",{className:"mx-auto max-w-6xl px-8 py-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-800 flex-shrink-0",children:(null==r?void 0:r.url)&&r.type.startsWith("image/")?(0,n.jsx)("img",{src:r.url||"/placeholder.svg",alt:r.filename,className:"w-full h-full object-cover"}):(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"□"})})}),(0,n.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,n.jsx)("div",{className:"text-white text-sm font-medium truncate",children:r?r.filename:"No media in loop"}),(0,n.jsx)("div",{className:"text-gray-400 text-xs",children:r?"Now Playing":"Add media to start"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-6 flex-shrink-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-xs text-gray-400",children:(null==o?void 0:null===(t=o.player)||void 0===t?void 0:t.loop_mode)==="all"?"Loop All":"Loop One"}),(0,n.jsx)(R,{checked:(null==o?void 0:null===(s=o.player)||void 0===s?void 0:s.loop_mode)==="all",onCheckedChange:l,className:"data-[state=checked]:bg-green-400 data-[state=unchecked]:bg-gray-600"})]}),(0,n.jsx)("button",{onClick:i,className:"h-10 w-10 rounded-full bg-white text-black hover:bg-gray-100 transition-colors flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-lg",children:(null==o?void 0:null===(a=o.player)||void 0===a?void 0:a.is_playing)?"⏸":"▶"})})]})]})})})}R.displayName=F.bL.displayName;var D=s(1189),L=s(4416);let M=D.bL,z=D.l9,W=D.ZL;D.bm;let O=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(D.hJ,{ref:t,className:l("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a})});O.displayName=D.hJ.displayName;let B=a.forwardRef((e,t)=>{let{className:s,children:a,...o}=e;return(0,n.jsxs)(W,{children:[(0,n.jsx)(O,{}),(0,n.jsxs)(D.UC,{ref:t,className:l("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[a,(0,n.jsxs)(D.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(L.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});B.displayName=D.UC.displayName;let H=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:l("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};H.displayName="DialogHeader";let X=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(D.hE,{ref:t,className:l("text-lg font-semibold leading-none tracking-tight",s),...a})});X.displayName=D.hE.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(D.VY,{ref:t,className:l("text-sm text-muted-foreground",s),...a})}).displayName=D.VY.displayName;var J=s(9708),q=s(2085);let Q=(0,q.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Z=a.forwardRef((e,t)=>{let{className:s,variant:a,size:o,asChild:r=!1,...i}=e,c=r?J.DX:"button";return(0,n.jsx)(c,{className:l(Q({variant:a,size:o,className:s})),ref:t,...i})});Z.displayName="Button";let G=(0,q.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function V(e){let{className:t,variant:s,...a}=e;return(0,n.jsx)("div",{className:l(G({variant:s}),t),...a})}let K=a.forwardRef((e,t)=>{let{className:s,type:a,...o}=e;return(0,n.jsx)("input",{type:a,className:l("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...o})});K.displayName="Input";var Y=s(968);let $=(0,q.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ee=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(Y.b,{ref:t,className:l($(),s),...a})});ee.displayName=Y.b.displayName;var et=s(2652),es=s(6517),en=s(4449),ea=s(2919);function eo(){let[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)(!1),[r,i]=(0,a.useState)(!1),[l,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(""),[m,h]=(0,a.useState)({connected:!1,ssid:"",hotspotActive:!1});(0,a.useEffect)(()=>{let e=async()=>{try{let e=await (0,f.BS)();(null==e?void 0:e.wifi)&&h({connected:!!e.wifi.connected,ssid:e.wifi.current_ssid||"",hotspotActive:!!e.wifi.hotspot_active})}catch(e){}};e();let t=setInterval(e,5e3);return()=>clearInterval(t)},[]);let p=async()=>{o(!0);try{let e=await (0,f.Xf)();t(e.networks),v("wifi-scan-ok","success","Found ".concat(e.networks.length," networks"))}catch(e){v("wifi-scan-err","error","Failed to scan for networks")}finally{o(!1)}},g=async()=>{if(l){i(!0);try{await (0,f.Zs)(l.ssid,d),v("wifi-connect","success","Connected to ".concat(l.ssid)),h(e=>({...e,connected:!0,ssid:l.ssid})),c(null),u("")}catch(e){v("wifi-connect-fail","error","Failed to connect to network")}finally{i(!1)}}},x=async()=>{try{await (0,f.Id)();let e=!m.hotspotActive;h(t=>({...t,hotspotActive:e})),v("hotspot-toggle","success",e?"Hotspot enabled":"Hotspot disabled")}catch(e){v("hotspot-err","error","Failed to toggle hotspot")}},b=e=>e>75?(0,n.jsx)(et.A,{className:"h-4 w-4"}):e>50?(0,n.jsx)(et.A,{className:"h-4 w-4 opacity-75"}):e>25?(0,n.jsx)(et.A,{className:"h-4 w-4 opacity-50"}):(0,n.jsx)(et.A,{className:"h-4 w-4 opacity-25"});return(0,n.jsxs)("div",{className:"rounded-3xl bg-card p-8 space-y-4",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"WiFi Configuration"}),(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[m.connected?(0,n.jsx)(es.A,{className:"h-5 w-5 text-green-500"}):(0,n.jsx)(en.A,{className:"h-5 w-5 text-red-500"}),(0,n.jsx)("span",{className:"font-medium",children:m.connected?'Connected to "'.concat(m.ssid,'"'):"Not connected"})]}),m.hotspotActive&&(0,n.jsx)(V,{variant:"secondary",children:"Hotspot Active"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(Z,{onClick:p,disabled:s,variant:"outline",children:s?"Scanning...":"Scan for Networks"}),(0,n.jsx)(Z,{onClick:x,variant:m.hotspotActive?"destructive":"outline",children:m.hotspotActive?"Disable Hotspot":"Enable Hotspot"})]}),e.length>0&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h4",{className:"font-medium",children:"Available Networks"}),(0,n.jsx)("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:e.map(e=>(0,n.jsxs)(M,{children:[(0,n.jsx)(z,{asChild:!0,children:(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg cursor-pointer hover:bg-accent",onClick:()=>c(e),children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"font-medium",children:e.ssid}),e.secured&&(0,n.jsx)(ea.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[b(e.signal),(0,n.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.signal,"%"]})]})]})}),(0,n.jsxs)(B,{children:[(0,n.jsx)(H,{children:(0,n.jsxs)(X,{children:["Connect to ",e.ssid]})}),(0,n.jsxs)("div",{className:"space-y-4",children:[e.secured&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(ee,{htmlFor:"password",children:"Password"}),(0,n.jsx)(K,{id:"password",type:"password",value:d,onChange:e=>u(e.target.value),placeholder:"Enter network password"})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(Z,{variant:"outline",onClick:()=>c(null),children:"Cancel"}),(0,n.jsx)(Z,{onClick:g,disabled:r||e.secured&&!d,children:r?"Connecting...":"Connect"})]})]})]})]},e.ssid))})]})]})}var er=s(1788);function ei(){let[e]=(0,a.useState)("1.0.0"),[t,s]=(0,a.useState)(null),[o,r]=(0,a.useState)(!1),[i,l]=(0,a.useState)(!1),c=async()=>{r(!0);try{(await (0,f.Ux)()).updates_available.git?(s("Available"),v("update-avail","success","Git update available")):v("update-none","info","System is up to date")}catch(e){v("update-check-fail","error","Failed to check for updates")}finally{r(!1)}},u=async()=>{if(t){l(!0);try{await (0,f.Px)(),v("update-installed","success","Update installed - device will restart"),s(null)}catch(e){v("update-install-fail","error","Failed to install update")}finally{l(!1)}}};return(0,n.jsxs)("div",{className:"rounded-3xl bg-card p-8 space-y-4",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"System & Updates"}),(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(d.A,{className:"h-5 w-5 text-green-500"}),(0,n.jsx)("span",{className:"font-medium",children:"Current Version"})]}),(0,n.jsx)(V,{variant:"outline",children:e})]}),t&&(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-primary/5 border border-primary/20 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(er.A,{className:"h-5 w-5 text-primary"}),(0,n.jsx)("span",{className:"font-medium",children:"Update Available"})]}),(0,n.jsx)(V,{children:t})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(Z,{onClick:c,disabled:o,variant:"outline",children:o?"Checking...":"Check for Updates"}),(0,n.jsx)(Z,{onClick:u,disabled:!t||i,children:i?"Installing...":"Install Update"})]}),t&&(0,n.jsxs)("div",{className:"text-sm text-muted-foreground p-3 bg-muted rounded-lg",children:[(0,n.jsx)("strong",{children:"Note:"})," The device will automatically restart after the update is installed. Make sure no critical operations are running."]})]})}function el(e){let t,{storage:s}=e;if(!s)return(0,n.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Storage"}),(0,n.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Loading storage info…"})]})]});let a=e=>0===e?"0 GB":"".concat((e/0x40000000).toFixed(1)," GB"),o=s.system/s.total*100,r=s.app/s.total*100,i=s.media/s.total*100;return s.free,s.total,(0,n.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Storage"}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Total Usage"}),(0,n.jsxs)("span",{className:"font-medium",children:[a(s.used)," / ",a(s.total)]})]}),(0,n.jsx)("div",{className:"w-full bg-muted/20 rounded-full h-3 overflow-hidden",children:(0,n.jsxs)("div",{className:"h-full flex",children:[(0,n.jsx)("div",{className:"bg-red-500 transition-all duration-300",style:{width:"".concat(o,"%")}}),(0,n.jsx)("div",{className:"bg-blue-500 transition-all duration-300",style:{width:"".concat(r,"%")}}),(0,n.jsx)("div",{className:"bg-green-500 transition-all duration-300",style:{width:"".concat(i,"%")}})]})})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500"}),(0,n.jsx)("span",{className:"text-muted-foreground",children:"System"})]}),(0,n.jsx)("span",{className:"font-medium",children:a(s.system)})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),(0,n.jsx)("span",{className:"text-muted-foreground",children:"App"})]}),(0,n.jsx)("span",{className:"font-medium",children:a(s.app)})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,n.jsx)("span",{className:"text-muted-foreground",children:"Media"})]}),(0,n.jsx)("span",{className:"font-medium",children:a(s.media)})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-muted/20",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-muted/40"}),(0,n.jsx)("span",{className:"text-muted-foreground",children:"Available"})]}),(0,n.jsx)("span",{className:"font-medium text-green-600",children:a(s.free)})]})]})]})]})}var ec=s(8018);let ed=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsxs)(ec.bL,{ref:t,className:l("relative flex w-full touch-none select-none items-center",s),...a,children:[(0,n.jsx)(ec.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-muted-foreground/50",children:(0,n.jsx)(ec.Q6,{className:"absolute h-full bg-primary"})}),(0,n.jsx)(ec.zi,{className:"block h-8 w-8 rounded-full border-[3px] border-primary bg-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});function eu(){let[e,t]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{let{brightness:e}=await (0,f.QQ)();t("number"==typeof e?e:100)}catch(e){console.error("Failed to fetch brightness",e)}})()},[]);let s=async()=>{if(null!==e)try{await (0,f.A4)({brightness:e}),v("display-set","success","Brightness set to ".concat(e,"%"))}catch(e){v("brightness-err","error",e.message||"Failed to set brightness")}};return null===e?(0,n.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Display Settings"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-sm font-medium",children:"Brightness"}),(0,n.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Loading brightness…"})]})]})]}):(0,n.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Display Settings"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-sm font-medium",children:"Brightness"}),(0,n.jsx)(ed,{min:0,max:100,value:[e],onValueChange:e=>t(e[0]),onValueCommit:()=>s()}),(0,n.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:[e,"%"]})]})]})}function em(e){let{isOpen:t,onClose:s}=e,[o,r]=(0,a.useState)(null),[i,l]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(!t){r(null);return}(async()=>{l(!0);try{let e=await (0,f.UB)();r(e)}catch(e){console.error("Failed to fetch storage info:",e)}finally{l(!1)}})()},[t]),(0,n.jsx)(M,{open:t,onOpenChange:s,children:(0,n.jsx)(B,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0",children:(0,n.jsxs)("div",{className:"p-8",children:[(0,n.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,n.jsx)(X,{className:"text-3xl font-semibold",children:"Settings"})}),(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsx)(eu,{}),(0,n.jsx)(el,{storage:i?null:o}),(0,n.jsx)(eo,{}),(0,n.jsx)(ei,{})]})]})})})}function eh(){var e;let[t,s]=(0,a.useState)(!1),[o,r]=(0,a.useState)(null),{data:i,connectionState:l}=function(){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)("disconnected"),[o,r]=(0,a.useState)(null),[i,l]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),u=(0,a.useCallback)(e=>{console.log("✅ Media uploaded, updating dashboard:",e.data),window.dispatchEvent(new CustomEvent("mediaUploaded",{detail:e.data})),t(t=>{let s;let n=e.data;if(!i||!t)return t;let a=t.media.findIndex(e=>e.slug===n.slug);return a>=0?(s=[...t.media])[a]=n:s=[...t.media,n],{...t,media:s}})},[i]),m=(0,a.useCallback)(e=>{console.log("Media deleted, updating dashboard"),t(t=>{if(t){let s=t.media.filter(t=>{var s;return t.slug!==(null===(s=e.data)||void 0===s?void 0:s.slug)});return{...t,media:s}}return t})},[]),h=(0,a.useCallback)(e=>{console.log("Loop updated via WebSocket"),t(t=>{if(t){var s;return{...t,loop:(null===(s=e.data)||void 0===s?void 0:s.loop)||[]}}return t})},[]),p=(0,a.useCallback)(e=>{let{bytes_received:t,total_bytes:s,percent:n,filename:a,stage:o}=e.data||{};if("finalizing"===o&&a){window.dispatchEvent(new CustomEvent("uploadFinalizingProgress",{detail:{filename:a,progress:n||0,stage:o}}));return}if(void 0!==t||void 0!==s){let e="number"==typeof n?n:s?t/s*100:0;d({filename:"uploading",progress:e,status:e>=100?"finalizing":"uploading"})}},[]);return(0,a.useEffect)(()=>{let e=!0,s=_.on("connection",t=>{var s,a;if(!e)return;let o=(null===(s=t.data)||void 0===s?void 0:s.state)||((null===(a=t.data)||void 0===a?void 0:a.status)==="connected"?"connected":"disconnected");n(o),"connected"===o&&(r(null),_.subscribe("dashboard"),_.subscribe("progress"))}),a=_.on("initial_dashboard",s=>{e&&(console.log("Received initial dashboard data via WebSocket"),t(s.data),l(!0),r(null))}),o=_.on("dashboard_update",s=>{e&&(console.log("Received dashboard update via WebSocket"),t(s.data),r(null))}),i=_.on("media_uploaded",u),c=_.on("media_deleted",m),d=_.on("loop_updated",h),f=_.on("playback_changed",s=>{e&&(console.log("Playback changed via WebSocket"),t(e=>{var t;return e&&(null===(t=s.data)||void 0===t?void 0:t.player)?{...e,status:{...e.status,player:s.data.player}}:e}))}),g=_.on("upload_progress",p),x=_.on("error",t=>{var s;e&&(console.error("WebSocket error:",t.data),r(Error((null===(s=t.data)||void 0===s?void 0:s.message)||"WebSocket error")))});return n(_.getConnectionState()),"connected"===_.getConnectionState()&&(_.subscribe("dashboard"),_.subscribe("progress")),()=>{e=!1,s(),a(),o(),i(),c(),d(),f(),g(),x(),_.unsubscribe("dashboard"),_.unsubscribe("progress")}},[u,m,h]),{data:e,error:o,connectionState:s,uploadProgress:c,isConnected:"connected"===s,isConnecting:"connecting"===s}}();return(0,n.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,n.jsx)("header",{className:"border-b border-border",children:(0,n.jsx)("div",{className:"mx-auto max-w-6xl px-8 py-8",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("h1",{className:"text-3xl font-semibold",children:["LOOP ",(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:"v0.1"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-8",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(()=>{switch(l){case"connecting":return(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-yellow-400 animate-pulse"});case"connected":return(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-400"});case"disconnected":default:return(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-gray-400"});case"error":return(0,n.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-400 animate-pulse"})}})(),(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:(()=>{switch(l){case"connecting":return"Re-connecting…";case"connected":return"Connected";case"disconnected":return"Offline";case"error":return"Connection Lost";default:return"Unknown"}})()})]}),(0,n.jsx)("button",{onClick:()=>s(!0),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Settings"})]})]})})}),(0,n.jsx)("main",{className:"mx-auto max-w-6xl px-8 py-12",children:i?(0,n.jsx)(T,{dashboardData:i,onCurrentlyPlayingChange:r}):(0,n.jsx)(I,{})}),(0,n.jsx)(P,{status:null!==(e=null==i?void 0:i.status)&&void 0!==e?e:null,currentlyPlaying:o}),(0,n.jsx)(em,{isOpen:t,onClose:()=>s(!1)})]})}ed.displayName=ec.bL.displayName},1886:(e,t,s)=>{"use strict";s.d(t,{A4:()=>I,BS:()=>p,EL:()=>f,Id:()=>C,KG:()=>P,Px:()=>T,QQ:()=>F,S:()=>N,UB:()=>A,Uk:()=>_,Ux:()=>E,Xf:()=>S,YB:()=>w,ZW:()=>U,Zs:()=>k,eW:()=>j,hR:()=>x,ij:()=>b,jq:()=>v,sd:()=>y,w8:()=>g});var n=s(6671);let a="/api";class o{set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}invalidate(e){this.cache.delete(e)}clear(){this.cache.clear()}constructor(){this.cache=new Map}}let r=new o;async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=Error("No attempts made");for(let i=0;i<=t;i++)try{return await e()}catch(l){var a,o,r;if(n=l,!((null===(a=l.message)||void 0===a?void 0:a.includes("503"))||(null===(o=l.message)||void 0===o?void 0:o.includes("Service Unavailable"))||(null===(r=l.message)||void 0===r?void 0:r.includes("Failed to fetch"))||"AbortError"===l.name)||i===t)throw l;let e=s*Math.pow(2,i)+500*Math.random();console.log("API retry ".concat(i+1,"/").concat(t," after ").concat(e,"ms: ").concat(l.message)),await new Promise(t=>setTimeout(t,e))}throw n}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=()=>fetch(e,t);return s?n():i(n)}async function c(e){if(!e.ok){let t;try{let s=e.headers.get("content-type");if(s&&s.includes("application/json")){let s=await e.json();t=s.message||s.error||"HTTP ".concat(e.status)}else t=await e.text()}catch(s){t="HTTP ".concat(e.status,": ").concat(e.statusText)}throw Error(t)}let t=e.headers.get("content-type");if(t&&t.includes("application/json"))return e.json();throw Error("Expected JSON response but received HTML")}function d(e){if(!e.success)throw Error(e.message||"API request failed");return e.data}class u{async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(await l("".concat(this.baseUrl).concat(e),{...t,method:"GET"}))}async post(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={...s,method:"POST",headers:{"Content-Type":"application/json",...s.headers}};return t&&(n.body=t instanceof FormData?t:JSON.stringify(t),t instanceof FormData&&n.headers&&delete n.headers["Content-Type"]),c(await l("".concat(this.baseUrl).concat(e),n))}async put(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(await l("".concat(this.baseUrl).concat(e),{...s,method:"PUT",headers:{"Content-Type":"application/json",...s.headers},body:t?JSON.stringify(t):void 0}))}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(await l("".concat(this.baseUrl).concat(e),{...t,method:"DELETE"}))}async upload(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(await l("".concat(this.baseUrl).concat(e),{...s,method:"POST",body:t},!0))}constructor(e=a){this.baseUrl=e}}let m=new u;function h(e,t,s){return n.o.promise(e,{loading:t,success:s||"Operation completed",error:e=>"Error: ".concat(e.message)}),e}async function p(e){return(await U(e)).status}async function f(e){let t=h(m.post("/media/".concat(e,"/activate")).then(d),"Activating media...","Media activated");return _(),t}async function g(e){let t=h(m.delete("/media/".concat(e)).then(d),"Deleting media...","Media deleted");return _(),t}async function x(e){let t=h(m.post("/loop",{slug:e}).then(d),"Adding to loop...","Added to loop");return _(),t}async function v(e){let t=h(m.delete("/loop/".concat(e)).then(d),"Removing from loop...","Removed from loop");return _(),t}async function b(e){let t=h(m.put("/loop",{loop:e}).then(d),"Saving order…","Loop order saved");return _(),t}async function y(){return h(m.post("/playback/toggle").then(d),"Toggling playback...")}async function w(){return h(m.post("/playback/next").then(d),"Skipping to next...")}async function j(){return h(m.post("/playback/previous").then(d),"Skipping to previous...")}async function N(){return h(m.post("/playback/loop-mode").then(d),"Toggling loop mode...")}async function S(){return d(await h(m.get("/wifi/scan"),"Scanning for networks...","Networks found"))}async function k(e,t){return h(m.post("/wifi/connect",{ssid:e,password:t}).then(d),"Connecting to ".concat(e,"..."),"Connected to ".concat(e))}async function C(){return h(m.post("/wifi/hotspot").then(d),"Toggling hotspot...")}async function A(e){return m.get("/dashboard/storage",e)}async function E(){return d(await h(m.get("/updates/check"),"Checking for updates..."))}async function T(){return h(m.post("/updates/install").then(d),"Installing update...","Update installed successfully")}async function U(e){if(!(null==e?void 0:e.signal)&&R)return console.log("Dashboard request already in flight, returning existing promise"),R;if(R&&!(null==e?void 0:e.signal))return R;console.log("Starting new dashboard request");let t=Date.now(),s=m.get("/dashboard",{...e,signal:(null==e?void 0:e.signal)||AbortSignal.timeout(6e4)}).finally(()=>{let e=Date.now()-t;console.log("Dashboard request completed in ".concat(e,"ms")),R=null});R=s;try{return await s}catch(e){throw R=null,e}}function _(){r.invalidate("dashboard")}async function I(e){return h(m.post("/display/brightness",e).then(d),"Applying display settings…","Display updated")}async function F(){return d(await m.get("/display/brightness"))}let R=null;async function P(e,t,s){console.log("Starting upload of processed media: ".concat(t));let n=e instanceof FormData?e:(()=>{let s=new FormData;return s.append("files",e,t),s})(),o=new XMLHttpRequest;return new Promise((e,r)=>{o.open("POST","".concat(a,"/media")),console.log("XHR request opened for ".concat(t)),o.onload=()=>{var s;if(console.log("XHR onload fired for ".concat(t,": status ").concat(o.status,", readyState ").concat(o.readyState)),console.log("Response received: ".concat((null===(s=o.responseText)||void 0===s?void 0:s.length)||0," bytes")),o.status>=200&&o.status<300)try{let s=JSON.parse(o.responseText||"{}");console.log("Upload successful for ".concat(t,":"),s),e(d(s))}catch(e){console.error("Failed to parse response for ".concat(t,":"),e),console.error("Raw response: ".concat(o.responseText)),r(Error("Invalid response format: ".concat(e)))}else console.error("Upload failed for ".concat(t,": HTTP ").concat(o.status)),console.error("Error response: ".concat(o.responseText)),r(Error("Upload failed: HTTP ".concat(o.status)))},o.onerror=e=>{console.error("XHR error for ".concat(t,":"),e),console.error("XHR state: status=".concat(o.status,", readyState=").concat(o.readyState)),r(Error("Network error during upload"))},o.onabort=()=>{console.warn("XHR aborted for ".concat(t)),r(Error("Upload aborted"))},o.ontimeout=()=>{console.error("XHR timeout for ".concat(t)),r(Error("Upload timeout"))},o.upload&&s&&(o.upload.onloadstart=()=>{console.log("Upload started for ".concat(t))},o.upload.onprogress=e=>{if(e.lengthComputable){let n=e.loaded/e.total;console.log("Upload progress for ".concat(t,": ").concat((100*n).toFixed(1),"% (").concat(e.loaded,"/").concat(e.total," bytes)")),s(n)}else console.log("Upload progress for ".concat(t,": ").concat(e.loaded," bytes (total unknown)"))},o.upload.onload=()=>{console.log("Upload data transfer complete for ".concat(t))},o.upload.onerror=e=>{console.error("Upload error for ".concat(t,":"),e)},o.upload.onabort=()=>{console.warn("Upload aborted for ".concat(t))},o.upload.ontimeout=()=>{console.error("Upload timeout for ".concat(t))}),o.timeout=3e5,console.log("Sending XHR request for ".concat(t,"..."));try{o.send(n),console.log("XHR send() called for ".concat(t))}catch(e){console.error("Failed to send XHR for ".concat(t,":"),e),r(e)}})}},2857:(e,t,s)=>{Promise.resolve().then(s.bind(s,837))},5604:(e,t,s)=>{"use strict";s.r(t),s.d(t,{uploadCoordinator:()=>o});var n=s(1886);class a{async startUpload(e){let t=await e.arrayBuffer(),s=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("").slice(0,16),n=e.name.replace(/\.[^.]+$/,"").replace(/\s+/g,"_").toLowerCase(),a="".concat(n,"_").concat(s),o="upload_".concat(a);if(this.transactions.has(o)){let t=this.transactions.get(o);if("error"!==t.state&&"cancelled"!==t.state)throw Error("Upload already in progress: ".concat(e.name))}let r={id:o,filename:e.name,originalFile:e,state:"pending",progress:0,stage:"queued",createdAt:Date.now(),expectedSlug:a};return this.transactions.set(o,r),this.persistTransaction(r),this.emit(r,"queued",0,"Upload queued"),this.activeCount<this.maxConcurrent&&this.processTransaction(o),o}async processTransaction(e){let t=this.transactions.get(e);if(t){this.activeCount++;try{await this.processFile(t),await this.uploadFiles(t),await this.waitForCompletion(t),this.updateTransaction(t,"complete",100,"Upload complete")}catch(s){this.updateTransaction(t,"error",0,s.message),console.error("Upload failed [".concat(e,"]:"),s)}finally{this.cleanupTransaction(e),this.activeCount--,this.processNextQueued()}}}async processFile(e){return this.updateTransaction(e,"processing",0,"Starting conversion..."),new Promise((t,n)=>{let a=new Worker(s.tu(new URL(s.p+s.u(158),s.b)));this.workers.set(e.id,a),a.addEventListener("message",s=>{let{id:o,progress:r,stage:i,done:l,blob:c,error:d}=s.data;if(o===e.id){if(d){a.terminate(),this.workers.delete(e.id),n(Error(d));return}if("number"==typeof r&&i){let t=Math.min(.5*r,50);this.updateTransaction(e,"processing",t,this.getStageMessage(i))}l&&c&&(e.zipBlob=c,a.terminate(),this.workers.delete(e.id),t())}}),a.postMessage({id:e.id,file:e.originalFile,expectedSlug:e.expectedSlug}),setTimeout(()=>{this.workers.has(e.id)&&(a.terminate(),this.workers.delete(e.id),n(Error("Processing timeout")))},3e5)})}async uploadFiles(e){if(!e.zipBlob)throw Error("ZIP blob not available");this.updateTransaction(e,"uploading",50,"Uploading files...");let t=new FormData;t.append("files",e.originalFile,e.filename),t.append("files",e.zipBlob,"".concat(this.getBasename(e.filename),"_frames.zip"));let s=await (0,n.KG)(t,"".concat(e.filename," + frames"),t=>{this.updateTransaction(e,"uploading",50+30*t,"Uploading files...")});e.uploadResult=s}async waitForCompletion(e){return this.updateTransaction(e,"finalizing",80,"Processing on device..."),new Promise(t=>{let s=setTimeout(()=>{console.warn("Timeout waiting for completion: ".concat(e.filename)),t()},3e4);e.completionCallback=()=>{clearTimeout(s),t()}})}updateTransaction(e,t,s,n){e.state=t,e.progress=Math.round(s),e.stage=n,this.persistTransaction(e),this.emit(e,n,s)}emit(e,t,s,n){let a={transaction:{...e},stage:t,progress:s,message:n};this.listeners.forEach(e=>{try{e(a)}catch(e){console.error("Upload progress listener error:",e)}})}cleanupTransaction(e){let t=this.workers.get(e);t&&(t.terminate(),this.workers.delete(e)),setTimeout(()=>{this.transactions.delete(e),localStorage.removeItem("upload_tx_".concat(e))},6e4)}processNextQueued(){if(this.activeCount>=this.maxConcurrent)return;let e=Array.from(this.transactions.values()).filter(e=>"pending"===e.state).sort((e,t)=>e.createdAt-t.createdAt);e.length>0&&this.processTransaction(e[0].id)}setupWebSocketListeners(){window.addEventListener("mediaUploaded",e=>{let t=e.detail;for(let[e,s]of(console.log("\uD83D\uDCE1 Received mediaUploaded event:",t),this.transactions))if(s.filename===(null==t?void 0:t.filename)&&"finalizing"===s.state){console.log("✅ Matched upload completion: ".concat(s.filename," -> ").concat(t.slug)),this.updateTransaction(s,"complete",100,"Upload complete"),s.completionCallback&&s.completionCallback();break}}),window.addEventListener("uploadFinalizingProgress",e=>{let{filename:t,progress:s,stage:n}=e.detail;for(let[e,a]of(console.log("\uD83D\uDCCA Upload finalizing progress: ".concat(t," ").concat(s,"% (").concat(n,")")),this.transactions))if(a.filename===t&&"finalizing"===a.state){let e=80+.2*s;this.updateTransaction(a,"finalizing",e,"Processing on device...");break}}),window.addEventListener("uploadProgress",e=>{let{filename:t,progress:s,stage:n}=e.detail;if("finalizing"===n&&t){for(let[e,n]of this.transactions)if(n.filename===t&&"finalizing"===n.state){let e=80+.2*s;this.updateTransaction(n,"finalizing",e,"Processing on device...");break}}})}persistTransaction(e){try{let t={...e,originalFile:void 0,zipBlob:void 0};localStorage.setItem("upload_tx_".concat(e.id),JSON.stringify(t))}catch(e){console.warn("Failed to persist transaction:",e)}}restoreTransactions(){try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(null==t?void 0:t.startsWith("upload_tx_")){let e=localStorage.getItem(t);if(e){let s=JSON.parse(e);Date.now()-s.createdAt<36e5?("complete"!==s.state&&"error"!==s.state&&(s.state="error",s.stage="interrupted"),this.transactions.set(s.id,s)):localStorage.removeItem(t)}}}}catch(e){console.warn("Failed to restore transactions:",e)}}getBasename(e){return e.replace(/\.[^.]+$/,"")}getStageMessage(e){switch(e){case"resizing":return"Optimizing video...";case"converting":return"Extracting frames...";default:return"Processing..."}}onProgress(e){return this.listeners.add(e),()=>this.listeners.delete(e)}getTransaction(e){return this.transactions.get(e)}getAllTransactions(){return Array.from(this.transactions.values())}cancelUpload(e){let t=this.transactions.get(e);t&&"complete"!==t.state&&(this.updateTransaction(t,"cancelled",0,"Cancelled"),this.cleanupTransaction(e))}constructor(){this.transactions=new Map,this.workers=new Map,this.listeners=new Set,this.maxConcurrent=2,this.activeCount=0,this.restoreTransactions(),this.setupWebSocketListeners()}}let o=new a}},e=>{var t=t=>e(e.s=t);e.O(0,[671,484,441,684,358],()=>t(2857)),_N_E=e.O()}]);