(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1816:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ed});var a=s(5155),n=s(2115),r=s(9890),o=s(1788),i=s(5690),l=s(7712),c=s(4616),d=s(2525),u=s(9869),m=s(1886);class f{async startUpload(e){let t;let s=await e.arrayBuffer();try{var a,n;if(null===(n=crypto)||void 0===n?void 0:null===(a=n.subtle)||void 0===a?void 0:a.digest)t=await crypto.subtle.digest("SHA-256",s);else throw Error("Web Crypto API not available")}catch(a){console.warn("Web Crypto API not available, using fallback hash:",a),t=this.createFallbackHash(e,s)}let r=Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("").slice(0,16),o=e.name.replace(/\.[^.]+$/,"").replace(/\s+/g,"_").toLowerCase(),i="".concat(o,"_").concat(r),l="upload_".concat(i);if(this.transactions.has(l)){let t=this.transactions.get(l);if("error"!==t.state&&"cancelled"!==t.state)throw console.warn("Blocking duplicate upload: ".concat(e.name," (ID: ").concat(l,")")),Error("Upload already in progress: ".concat(e.name));console.log("Replacing failed upload transaction: ".concat(l)),this.cleanupTransaction(l)}if(Array.from(this.transactions.values()).find(t=>t.filename===e.name&&"error"!==t.state&&"cancelled"!==t.state&&"complete"!==t.state))throw console.warn("Blocking duplicate upload by filename: ".concat(e.name)),Error("Upload already in progress: ".concat(e.name));let c={id:l,filename:e.name,originalFile:e,state:"pending",progress:0,stage:"queued",createdAt:Date.now(),expectedSlug:i};return this.transactions.set(l,c),this.persistTransaction(c),this.emit(c,"queued",0,"Upload queued"),this.activeCount<this.maxConcurrent&&this.processTransaction(l),l}createFallbackHash(e,t){let s=new Uint8Array(t),a=0;for(let t=0;t<e.name.length;t++)a=31*a+e.name.charCodeAt(t)&0xffffffff;a=31*a+e.size&0xffffffff;for(let t=0;t<e.type.length;t++)a=31*a+e.type.charCodeAt(t)&0xffffffff;let n=Math.min(1024,s.length),r=Math.max(1,Math.floor(s.length/n));for(let e=0;e<s.length;e+=r)a=31*a+s[e]&0xffffffff;let o=new ArrayBuffer(32),i=new DataView(o);for(let e=0;e<8;e++)i.setUint32(4*e,a+31*e,!1);return o}async processTransaction(e){let t=this.transactions.get(e);if(t){this.activeCount++;try{await this.processFile(t),await this.uploadFiles(t),await this.waitForCompletion(t),this.updateTransaction(t,"complete",100,"Upload complete")}catch(n){let a=n instanceof Error?n.message:String(n);this.updateTransaction(t,"error",0,a),console.error("Upload failed [".concat(e,"]:"),n);try{let{forceStopProgress:e}=await Promise.resolve().then(s.bind(s,1886));await e(),console.log("Force stopped backend progress display after upload failure")}catch(e){console.warn("Failed to force stop backend progress:",e)}}finally{this.cleanupTransaction(e),this.activeCount--,this.processNextQueued()}}}async processFile(e){if(!e.originalFile)throw Error("Original file not available for processing");this.updateTransaction(e,"processing",0,"Starting conversion...");let t=e.originalFile;if("image/svg+xml"===e.originalFile.type||e.originalFile.name.toLowerCase().endsWith(".svg")){this.updateTransaction(e,"processing",5,"Converting SVG to PNG...");let{convertSvgToRgb565Zip:t}=await s.e(405).then(s.bind(s,9405));try{let s=await t(e.originalFile,{onProgress:(t,s)=>{let a=Math.min(.4*t,40);this.updateTransaction(e,"processing",a,this.getStageMessage(s))}},e.expectedSlug);e.zipBlob=s.blob;return}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("SVG conversion failed: ".concat(e))}}return new Promise((a,n)=>{let r=new Worker(s.tu(new URL(s.p+s.u(158),s.b)));this.workers.set(e.id,r),r.addEventListener("message",t=>{let{id:s,progress:o,stage:i,done:l,blob:c,error:d}=t.data;if(s===e.id){if(d){r.terminate(),this.workers.delete(e.id),n(Error(d));return}if("number"==typeof o&&i){let t=Math.min(.4*o,40);this.updateTransaction(e,"processing",t,this.getStageMessage(i))}l&&c&&(e.zipBlob=c,r.terminate(),this.workers.delete(e.id),a())}}),r.postMessage({id:e.id,file:t,expectedSlug:e.expectedSlug}),setTimeout(()=>{this.workers.has(e.id)&&(r.terminate(),this.workers.delete(e.id),n(Error("Processing timeout")))},3e5)})}async uploadFiles(e){if(!e.zipBlob)throw Error("ZIP blob not available");if(!e.originalFile)throw Error("Original file not available for upload");this.updateTransaction(e,"uploading",40,"Uploading files...");let t=new FormData;t.append("files",e.originalFile,e.filename),t.append("files",e.zipBlob,"".concat(this.getBasename(e.filename),"_frames.zip"));let s=await (0,m.KG)(t,"".concat(e.filename," + frames"),t=>{this.updateTransaction(e,"uploading",40+20*t,"Uploading files...")});e.uploadResult=s}async waitForCompletion(e){return this.updateTransaction(e,"finalizing",60,"Processing on device..."),new Promise(t=>{let s=setTimeout(()=>{console.warn("Timeout waiting for completion: ".concat(e.filename)),t()},3e4);e.completionCallback=()=>{clearTimeout(s),t()}})}updateTransaction(e,t,s,a){e.state=t,e.progress=Math.round(s),e.stage=a,this.persistTransaction(e),this.emit(e,a,s)}emit(e,t,s,a){let n={transaction:{...e},stage:t,progress:s,message:a};this.listeners.forEach(e=>{try{e(n)}catch(e){console.error("Upload progress listener error:",e)}})}cleanupTransaction(e){console.log("Cleaning up transaction: ".concat(e));let t=this.workers.get(e);t&&(t.terminate(),this.workers.delete(e));let s=this.transactions.get(e);s&&s.completionCallback&&delete s.completionCallback,setTimeout(()=>{this.transactions.delete(e),localStorage.removeItem("upload_tx_".concat(e)),console.log("Transaction ".concat(e," removed from memory"))},3e5)}processNextQueued(){if(this.activeCount>=this.maxConcurrent)return;let e=Array.from(this.transactions.values()).filter(e=>"pending"===e.state).sort((e,t)=>e.createdAt-t.createdAt);e.length>0&&(console.log("Processing next queued transaction: ".concat(e[0].id," (").concat(e.length," pending, ").concat(this.activeCount," active)")),this.processTransaction(e[0].id))}setupWebSocketListeners(){window.addEventListener("mediaUploaded",e=>{let t=e.detail;for(let e of(console.log("\uD83D\uDCE1 Received mediaUploaded event:",t),this.transactions.values())){if("finalizing"!==e.state&&"uploading"!==e.state)continue;let s=e.filename===(null==t?void 0:t.filename),a=((null==t?void 0:t.filename)||"").replace(/\.[^.]+$/,"").toLowerCase(),n=e.filename.replace(/\.[^.]+$/,"").toLowerCase(),r=n===a||n.includes(a)||a.includes(n)||e.filename.toLowerCase().includes(a);if(s||r){console.log("✅ Matched upload completion: ".concat(e.filename," -> ").concat(t.slug," (").concat(s?"exact":"fuzzy"," match)")),this.updateTransaction(e,"complete",100,"Upload complete");let a=e.completionCallback;a&&a();break}}}),window.addEventListener("uploadProgress",e=>{let{filename:t,progress:s,percent:a,stage:n}=e.detail||{},r=void 0!==s?s:a;if(void 0!==r&&t){console.log("\uD83D\uDCCA Backend upload progress: ".concat(t," ").concat(r,"% (").concat(n,")"));let e=Array.from(this.transactions.values()).filter(e=>"finalizing"===e.state);console.log("\uD83D\uDD0D Looking for match among ".concat(e.length," finalizing transactions:"),e.map(e=>"".concat(e.filename," (").concat(e.id.slice(0,8),")")));let s=!1;for(let e of this.transactions.values()){if("finalizing"!==e.state&&"uploading"!==e.state)continue;let a=e.filename===t,o=t.replace(/\.[^.]+$/,"").toLowerCase(),i=e.filename.replace(/\.[^.]+$/,"").toLowerCase(),l=i===o||i.includes(o)||o.includes(i)||e.filename.toLowerCase().includes(o);if(a||l){let o;if(console.log('✅ Found matching transaction: "'.concat(e.filename,'" vs "').concat(t,'" (').concat(a?"exact":"fuzzy"," match)")),console.log("\uD83D\uDD0D Progress mapping debug: filename=".concat(t,", backendProgress=").concat(r,', stage="').concat(n,'"')),"complete"===n)o=100,console.log("✅ Complete stage: mapped to ".concat(o,"%"));else if("finalizing"===n){let e=60+35/65*(r-20);o=Math.min(95,Math.max(60,e)),console.log("\uD83D\uDCCA Finalizing stage: ".concat(r,"% -> ").concat(e," -> ").concat(o,"% (clamped)"))}else o=Math.min(95,Math.max(60,60+35/65*(r-20))),console.log('⚠️  Unknown stage "'.concat(n,'": treating as finalizing ').concat(r,"% -> ").concat(o,"%"));console.log("\uD83C\uDFAF Updating transaction ".concat(e.id,": ").concat(e.progress,"% -> ").concat(Math.round(o),"%")),this.updateTransaction(e,"finalizing",Math.round(o),this.getStageMessage(n)||"Processing on device..."),s=!0;break}}s||console.warn('❌ No matching finalizing transaction found for "'.concat(t,'"'))}}),window.addEventListener("uploadFinalizingProgress",e=>{let{filename:t,progress:s,stage:a}=e.detail;for(let e of(console.log("\uD83D\uDCCA Upload finalizing progress: ".concat(t," ").concat(s,"% (").concat(a,")")),this.transactions.values()))if(e.filename===t&&"finalizing"===e.state){let t=60+.4*s;this.updateTransaction(e,"finalizing",t,"Processing on device...");break}})}persistTransaction(e){try{let t={...e,originalFile:void 0,zipBlob:void 0};localStorage.setItem("upload_tx_".concat(e.id),JSON.stringify(t))}catch(e){console.warn("Failed to persist transaction:",e)}}restoreTransactions(){try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(null==t?void 0:t.startsWith("upload_tx_")){let e=localStorage.getItem(t);if(e){let s=JSON.parse(e);Date.now()-s.createdAt<36e5?("complete"!==s.state&&"error"!==s.state&&(s.state="error",s.stage="interrupted"),this.transactions.set(s.id,s)):localStorage.removeItem(t)}}}}catch(e){console.warn("Failed to restore transactions:",e)}}getBasename(e){return e.replace(/\.[^.]+$/,"")}getStageMessage(e){switch(e){case"resizing":return"Optimizing video...";case"converting":case"extracting":return"Extracting frames...";case"finalizing":return"Processing on device...";case"organizing":return"Organizing files...";case"complete":return"Upload complete";default:return"Processing..."}}onProgress(e){return this.listeners.add(e),()=>this.listeners.delete(e)}getTransaction(e){return this.transactions.get(e)}getAllTransactions(){return Array.from(this.transactions.values())}cancelUpload(e){let t=this.transactions.get(e);t&&"complete"!==t.state&&(console.log("Cancelling upload: ".concat(e)),this.updateTransaction(t,"cancelled",0,"Cancelled"),this.cleanupTransaction(e),this.activeCount=Math.max(0,this.activeCount-1),this.processNextQueued())}getStats(){let e=Array.from(this.transactions.values()).reduce((e,t)=>(e[t.state]=(e[t.state]||0)+1,e),{});return{active:this.activeCount,pending:e.pending||0,total:this.transactions.size}}constructor(){this.transactions=new Map,this.workers=new Map,this.listeners=new Set,this.maxConcurrent=2,this.activeCount=0,this.restoreTransactions(),this.setupWebSocketListeners()}}let g=new f;var p=s(6671);let h=new Map;function x(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(h.has(e))return;let n=p.o[t](s,{...a,onDismiss(){h.delete(e),"function"==typeof a.onDismiss&&a.onDismiss()}});h.set(e,n)}var v=s(9708),b=s(2085),y=s(2596),w=s(9688);function j(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,w.QP)((0,y.$)(t))}let N=(0,b.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),k=n.forwardRef((e,t)=>{let{className:s,variant:n,size:r,asChild:o=!1,...i}=e,l=o?v.DX:"button";return(0,a.jsx)(l,{className:j(N({variant:n,size:r,className:s})),ref:t,...i})});function C(e){let{onUploadComplete:t,trigger:s}=e,o=(0,n.useRef)(null),[i,l]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s&&o.current&&o.current.click()},[s]);let c=(0,n.useCallback)(async e=>{if(e.length){if(e.filter(e=>e.size>0x6400000).length){x("upload-filesize","error","Files too large. Maximum 100MB");return}for(let t of e)try{if(!g){console.error("Upload coordinator not available");continue}let e=await g.startUpload(t);console.log("\uD83D\uDE80 Started upload transaction: ".concat(e," for ").concat(t.name))}catch(e){console.error("Failed to start upload for ".concat(t.name,":"),e),x("upload-error-".concat(t.name),"error","Upload failed: ".concat(t.name))}t&&t()}},[t]),d=(0,n.useCallback)(async e=>{var t;if(!(null===(t=e.target.files)||void 0===t?void 0:t.length))return;let s=Array.from(e.target.files);await c(s),e.target.value=""},[c]),m=(0,n.useCallback)(e=>{e.preventDefault(),l(!0)},[]),f=(0,n.useCallback)(e=>{e.preventDefault(),l(!1)},[]),p=(0,n.useCallback)(async e=>{e.preventDefault(),l(!1);let t=Array.from(e.dataTransfer.files);await c(t)},[c]),h=(0,n.useCallback)(()=>{var e;null===(e=o.current)||void 0===e||e.click()},[]);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{onDragOver:m,onDragLeave:f,onDrop:p,className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer ".concat(i?"border-blue-500 bg-blue-500/10":"border-gray-600 hover:border-gray-500"),onClick:h,children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-800 flex items-center justify-center",children:(0,a.jsx)(u.A,{className:"w-6 h-6 text-gray-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-medium mb-1",children:i?"Drop files here":"Upload Media"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Drag & drop files here or click to browse"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Supports: Images, Videos, GIFs (max 100MB each)"})]})]})}),(0,a.jsxs)(k,{onClick:h,className:"w-full",variant:"outline",children:[(0,a.jsx)(r.A,{className:"w-4 h-4 mr-2"}),"Choose Files"]}),(0,a.jsx)("input",{ref:o,type:"file",multiple:!0,accept:"image/*,video/*,.gif,.mov,.m4v,.heic,.heif",onChange:d,className:"hidden"})]})}k.displayName="Button";var S=s(4439);let T=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsxs)(S.bL,{ref:t,className:j("relative overflow-hidden",s),...r,children:[(0,a.jsx)(S.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)(E,{}),(0,a.jsx)(S.OK,{})]})});T.displayName=S.bL.displayName;let E=n.forwardRef((e,t)=>{let{className:s,orientation:n="vertical",...r}=e;return(0,a.jsx)(S.VM,{ref:t,orientation:n,className:j("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:(0,a.jsx)(S.lr,{className:"relative flex-1 rounded-full bg-border"})})});function A(e){let{src:t,alt:s,className:r,placeholder:o="/placeholder.svg"}=e,[i,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)(!1),u=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=new IntersectionObserver(t=>{let[s]=t;s.isIntersecting&&(d(!0),e.disconnect())},{rootMargin:"50px",threshold:.1});return u.current&&e.observe(u.current),()=>e.disconnect()},[]),(0,a.jsx)("img",{ref:u,src:c?t:o,alt:s,className:"".concat(r," ").concat(!i&&c?"opacity-50":"opacity-100"," transition-opacity duration-300"),onLoad:()=>l(!0),loading:"lazy"})}function F(e){let{item:t,isEnabled:s,onToggleEnabled:n,onDelete:u,onActivate:m}=e;return(0,a.jsxs)("div",{className:"group flex items-center gap-8 p-4 hover:bg-accent/30 transition-all",children:[(0,a.jsx)("div",{className:" h-[8rem] rounded-lg overflow-hidden  aspect-[32/24] bg-muted flex-shrink-0 ".concat(s?"":"opacity-40 grayscale"),children:t.url&&t.type.startsWith("image/")?(0,a.jsx)(A,{src:t.url,alt:t.filename,className:"w-full h-full object-cover ".concat("processing"===t.processing_status?"animate-pulse":"")}):t.url&&t.type.startsWith("video/")?(0,a.jsx)("video",{src:t.url,muted:!0,loop:!0,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover ".concat("processing"===t.processing_status?"animate-pulse":"")}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(r.A,{className:"w-6 h-6 text-muted-foreground"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("h4",{className:"font-medium truncate",children:t.filename}),(0,a.jsx)("button",{onClick:()=>{if(t.url){let e=document.createElement("a");e.href=t.url,e.download=t.filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)}},className:"opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-accent rounded",title:"Download file",children:(0,a.jsx)(o.A,{className:"w-3 h-3 text-muted-foreground hover:text-foreground"})}),"processing"===t.processing_status&&(0,a.jsx)("div",{className:"px-2 py-1 rounded text-xs bg-blue-500 text-white",children:"Processing..."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,a.jsxs)("span",{children:[(t.size/1024/1024).toFixed(1)," MB"]}),(0,a.jsx)("span",{children:new Date(t.uploadedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),t.duration&&(0,a.jsxs)("span",{children:[t.duration,"s"]}),t.frame_count&&(0,a.jsxs)("span",{children:[t.frame_count," frames"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)(k,{variant:"ghost",size:"sm",onClick:()=>m(t.slug),title:"Play this item",children:(0,a.jsx)(i.A,{className:"w-4 h-4"})}),(0,a.jsx)(k,{variant:s?"default":"outline",size:"sm",onClick:()=>n(t.slug),className:s?"bg-green-600 hover:bg-green-700":"",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-1"}),"Enabled"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{className:"w-4 h-4 mr-1"}),"Disabled"]})}),(0,a.jsx)(k,{variant:"ghost",size:"sm",onClick:()=>u(t.slug),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:(0,a.jsx)(d.A,{className:"w-4 h-4"})})]})]})}function D(e){let{dashboardData:t}=e,[s,r]=(0,n.useState)(!1),o=(null==t?void 0:t.media)||[],i=(null==t?void 0:t.loop)||[],l=function(e){let t=new Map;for(let s of e){let e=t.get(s.filename);if(!e){t.set(s.filename,s);continue}let a=e=>{switch(e){case"completed":return 3;case"processing":return 2;case"uploaded":return 1;default:return 0}};a(s.processing_status)>a(e.processing_status)&&t.set(s.filename,s)}return Array.from(t.values())}(o);(0,n.useEffect)(()=>{let e=()=>{(0,m.Uk)()};return window.addEventListener("mediaUploaded",e),()=>{window.removeEventListener("mediaUploaded",e)}},[]);let c=async e=>{let t=i.includes(e);try{t?await (0,m.jq)(e):await (0,m.hR)(e)}catch(e){console.error("Failed to toggle enabled state:",e)}},d=async e=>{try{await (0,m.w8)(e)}catch(e){console.error("Failed to delete media:",e)}},f=async e=>{try{await (0,m.EL)(e)}catch(e){console.error("Failed to activate media:",e)}};return t?(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsx)("div",{className:"border border-dashed border-gray-600 rounded-lg p-6",children:(0,a.jsx)(C,{onUploadComplete:()=>{(0,m.Uk)()},trigger:s})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-2xl font-semibold",children:["Media Library (",l.length," items, ",i.length," enabled)"]}),(0,a.jsxs)(k,{onClick:()=>{r(!s)},variant:"outline",children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Upload Media"]})]}),(0,a.jsx)("div",{className:"border rounded-lg",children:(0,a.jsx)(T,{className:"h-[600px]",children:(0,a.jsxs)("div",{className:"divide-y",children:[l.map(e=>(0,a.jsx)(F,{item:e,isEnabled:i.includes(e.slug),onToggleEnabled:c,onDelete:d,onActivate:f},e.slug)),0===l.length&&(0,a.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"No media files uploaded yet"})]})})})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-gray-400 border-t-transparent rounded-full"}),(0,a.jsx)("span",{children:"Loading dashboard..."})]})})}E.displayName=S.VM.displayName;var U=s(184);let _=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(U.bL,{className:j("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...n,ref:t,children:(0,a.jsx)(U.zi,{className:j("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});function z(e){var t,s,n;let{status:r,currentlyPlaying:o}=e,i=async()=>{try{await (0,m.sd)()}catch(e){x("playback-toggle-fail","error","Failed to toggle playback")}},l=async()=>{try{await (0,m.S)()}catch(e){x("loopmode-fail","error","Failed to toggle loop mode")}};return(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-black border-t border-gray-800",children:(0,a.jsx)("div",{className:"mx-auto max-w-6xl px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-800 flex-shrink-0",children:(null==o?void 0:o.url)&&o.type.startsWith("image/")?(0,a.jsx)("img",{src:o.url||"/placeholder.svg",alt:o.filename,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"□"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"text-white text-sm font-medium truncate",children:o?o.filename:"No media in loop"}),(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:o?"Now Playing":"Add media to start"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs text-gray-400",children:(null==r?void 0:null===(t=r.player)||void 0===t?void 0:t.loop_mode)==="all"?"Loop All":"Loop One"}),(0,a.jsx)(_,{checked:(null==r?void 0:null===(s=r.player)||void 0===s?void 0:s.loop_mode)==="all",onCheckedChange:l,className:"data-[state=checked]:bg-green-400 data-[state=unchecked]:bg-gray-600"})]}),(0,a.jsx)("button",{onClick:i,className:"h-10 w-10 rounded-full bg-white text-black hover:bg-gray-100 transition-colors flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lg",children:(null==r?void 0:null===(n=r.player)||void 0===n?void 0:n.is_playing)?"⏸":"▶"})})]})]})})})}function L(e){let{connectionState:t}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(()=>{switch(t){case"connecting":return(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-yellow-400 animate-pulse"});case"connected":return(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-400"});case"disconnected":default:return(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-gray-400"});case"error":return(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-400 animate-pulse"})}})(),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:(()=>{switch(t){case"connecting":return"Re-connecting…";case"connected":return"Connected";case"disconnected":return"Offline";case"error":return"Connection Lost";default:return"Unknown"}})()})]})}_.displayName=U.bL.displayName;var M=s(2283),P=s(4416);let R=M.bL,O=M.l9,I=M.ZL;M.bm;let B=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(M.hJ,{ref:t,className:j("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n})});B.displayName=M.hJ.displayName;let H=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsxs)(I,{children:[(0,a.jsx)(B,{}),(0,a.jsxs)(M.UC,{ref:t,className:j("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r,children:[n,(0,a.jsxs)(M.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(P.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});H.displayName=M.UC.displayName;let q=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:j("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};q.displayName="DialogHeader";let X=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(M.hE,{ref:t,className:j("text-lg font-semibold leading-none tracking-tight",s),...n})});X.displayName=M.hE.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(M.VY,{ref:t,className:j("text-sm text-muted-foreground",s),...n})}).displayName=M.VY.displayName;let W=(0,b.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function V(e){let{className:t,variant:s,...n}=e;return(0,a.jsx)("div",{className:j(W({variant:s}),t),...n})}let G=n.forwardRef((e,t)=>{let{className:s,type:n,...r}=e;return(0,a.jsx)("input",{type:n,className:j("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});G.displayName="Input";var J=s(968);let Q=(0,b.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),$=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(J.b,{ref:t,className:j(Q(),s),...n})});$.displayName=J.b.displayName;var Z=s(2652),K=s(6517),Y=s(4449),ee=s(2919);function et(){let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!1),[o,i]=(0,n.useState)(!1),[l,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(""),[f,g]=(0,n.useState)({connected:!1,current_ssid:void 0,hotspot_active:!1,configured_ssid:void 0});(0,n.useEffect)(()=>{let e=async()=>{try{let e=await (0,m.BS)();(null==e?void 0:e.wifi)&&g(e.wifi)}catch(e){}};e();let t=setInterval(e,5e3);return()=>clearInterval(t)},[]);let p=async()=>{r(!0);try{let e=await (0,m.Xf)();t(e.networks),x("wifi-scan-ok","success","Found ".concat(e.networks.length," networks"))}catch(e){x("wifi-scan-err","error","Failed to scan for networks")}finally{r(!1)}},h=async()=>{if(f.current_ssid)try{await (0,m.XX)(),g(e=>({...e,configured_ssid:f.current_ssid}))}catch(e){x("save-error","error","Failed to save current network")}},v=async()=>{if(l){i(!0);try{await (0,m.Zs)(l.ssid,d),x("wifi-connect","success","Connected to ".concat(l.ssid)),g(e=>({...e,connected:!0,current_ssid:l.ssid,configured_ssid:l.ssid})),c(null),u("")}catch(e){x("wifi-connect-fail","error","Failed to connect to network")}finally{i(!1)}}},b=async()=>{try{await (0,m.Id)();let e=!f.hotspot_active;g(t=>({...t,hotspot_active:e})),x("hotspot-toggle","success",e?"Hotspot enabled":"Hotspot disabled")}catch(e){x("hotspot-err","error","Failed to toggle hotspot")}},y=e=>e>75?(0,a.jsx)(Z.A,{className:"h-4 w-4"}):e>50?(0,a.jsx)(Z.A,{className:"h-4 w-4 opacity-75"}):e>25?(0,a.jsx)(Z.A,{className:"h-4 w-4 opacity-50"}):(0,a.jsx)(Z.A,{className:"h-4 w-4 opacity-25"});return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8 space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"WiFi Configuration"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[f.connected?(0,a.jsx)(K.A,{className:"h-5 w-5 text-green-500"}):(0,a.jsx)(Y.A,{className:"h-5 w-5 text-red-500"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-medium",children:f.connected?'Connected to "'.concat(f.current_ssid,'"'):"Not connected"}),f.connected&&(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:f.configured_ssid===f.current_ssid?"Saved in LOOP":"Not saved in LOOP"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:f.hotspot_active&&(0,a.jsx)(V,{variant:"secondary",children:"Hotspot Active"})})]}),f.configured_ssid&&f.configured_ssid!==f.current_ssid&&(0,a.jsx)("div",{className:"flex items-center justify-between p-3 bg-orange-50 border border-orange-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-5 w-5 rounded-full bg-orange-400 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs text-white font-medium",children:"!"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"font-medium text-orange-800",children:['Configured: "',f.configured_ssid,'"']}),(0,a.jsx)("span",{className:"text-sm text-orange-600",children:"Not currently connected"})]})]})})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)(k,{onClick:p,disabled:s,variant:"outline",children:s?"Scanning...":"Scan for Networks"}),f.connected&&f.configured_ssid!==f.current_ssid&&(0,a.jsx)(k,{onClick:h,variant:"outline",className:"border-green-200 text-green-700 hover:bg-green-50",children:"Save Current Network"}),(0,a.jsx)(k,{onClick:b,variant:f.hotspot_active?"destructive":"outline",children:f.hotspot_active?"Disable Hotspot":"Enable Hotspot"})]}),e.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Available Networks"}),(0,a.jsx)("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:e.map(e=>(0,a.jsxs)(R,{children:[(0,a.jsx)(O,{asChild:!0,children:(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg cursor-pointer hover:bg-accent",onClick:()=>c(e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"font-medium",children:e.ssid}),e.secured&&(0,a.jsx)(ee.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[y(e.signal),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.signal,"%"]})]})]})}),(0,a.jsxs)(H,{children:[(0,a.jsx)(q,{children:(0,a.jsxs)(X,{children:["Connect to ",e.ssid]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[e.secured&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)($,{htmlFor:"password",children:"Password"}),(0,a.jsx)(G,{id:"password",type:"password",value:d,onChange:e=>u(e.target.value),placeholder:"Enter network password"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(k,{variant:"outline",onClick:()=>c(null),children:"Cancel"}),(0,a.jsx)(k,{onClick:v,disabled:o||e.secured&&!d,children:o?"Connecting...":"Connect"})]})]})]})]},e.ssid))})]})]})}var es=s(646);function ea(){let[e]=(0,n.useState)("1.0.0"),[t,s]=(0,n.useState)(null),[r,i]=(0,n.useState)(!1),[l,c]=(0,n.useState)(!1),d=async()=>{i(!0);try{(await (0,m.Ux)()).updates_available.git?(s("Available"),x("update-avail","success","Git update available")):x("update-none","info","System is up to date")}catch(e){x("update-check-fail","error","Failed to check for updates")}finally{i(!1)}},u=async()=>{if(t){c(!0);try{await (0,m.Px)(),x("update-installed","success","Update installed - device will restart"),s(null)}catch(e){x("update-install-fail","error","Failed to install update")}finally{c(!1)}}};return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8 space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"System & Updates"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(es.A,{className:"h-5 w-5 text-green-500"}),(0,a.jsx)("span",{className:"font-medium",children:"Current Version"})]}),(0,a.jsx)(V,{variant:"outline",children:e})]}),t&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-primary/5 border border-primary/20 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.A,{className:"h-5 w-5 text-primary"}),(0,a.jsx)("span",{className:"font-medium",children:"Update Available"})]}),(0,a.jsx)(V,{children:t})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(k,{onClick:d,disabled:r,variant:"outline",children:r?"Checking...":"Check for Updates"}),(0,a.jsx)(k,{onClick:u,disabled:!t||l,children:l?"Installing...":"Install Update"})]}),t&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground p-3 bg-muted rounded-lg",children:[(0,a.jsx)("strong",{children:"Note:"})," The device will automatically restart after the update is installed. Make sure no critical operations are running."]})]})}function en(e){let t,{storage:s}=e;if(!s)return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Storage"}),(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading storage info…"})]})]});let n=e=>0===e?"0 GB":"".concat((e/0x40000000).toFixed(1)," GB"),r=s.system/s.total*100,o=s.app/s.total*100,i=s.media/s.total*100;return s.free,s.total,(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Storage"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total Usage"}),(0,a.jsxs)("span",{className:"font-medium",children:[n(s.used)," / ",n(s.total)]})]}),(0,a.jsx)("div",{className:"w-full bg-muted/20 rounded-full h-3 overflow-hidden",children:(0,a.jsxs)("div",{className:"h-full flex",children:[(0,a.jsx)("div",{className:"bg-red-500 transition-all duration-300",style:{width:"".concat(r,"%")}}),(0,a.jsx)("div",{className:"bg-blue-500 transition-all duration-300",style:{width:"".concat(o,"%")}}),(0,a.jsx)("div",{className:"bg-green-500 transition-all duration-300",style:{width:"".concat(i,"%")}})]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"System"})]}),(0,a.jsx)("span",{className:"font-medium",children:n(s.system)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"App"})]}),(0,a.jsx)("span",{className:"font-medium",children:n(s.app)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Media"})]}),(0,a.jsx)("span",{className:"font-medium",children:n(s.media)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-muted/20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-muted/40"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Available"})]}),(0,a.jsx)("span",{className:"font-medium text-green-600",children:n(s.free)})]})]})]})]})}var er=s(8018);let eo=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsxs)(er.bL,{ref:t,className:j("relative flex w-full touch-none select-none items-center",s),...n,children:[(0,a.jsx)(er.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-muted-foreground/50",children:(0,a.jsx)(er.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(er.zi,{className:"block h-8 w-8 rounded-full border-[3px] border-primary bg-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});function ei(){let[e,t]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{let{brightness:e}=await (0,m.QQ)();t("number"==typeof e?e:100)}catch(e){console.error("Failed to fetch brightness",e)}})()},[]);let s=async()=>{if(null!==e)try{await (0,m.A4)({brightness:e}),x("display-set","success","Brightness set to ".concat(e,"%"))}catch(e){x("brightness-err","error",e.message||"Failed to set brightness")}};return null===e?(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Display Settings"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Brightness"}),(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading brightness…"})]})]})]}):(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Display Settings"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Brightness"}),(0,a.jsx)(eo,{min:0,max:100,value:[e],onValueChange:e=>t(e[0]),onValueCommit:()=>s()}),(0,a.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:[e,"%"]})]})]})}function el(e){let{isOpen:t,onClose:s}=e,[r,o]=(0,n.useState)(null),[i,l]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!t){o(null);return}(async()=>{l(!0);try{let e=await (0,m.UB)();o(e)}catch(e){console.error("Failed to fetch storage info:",e)}finally{l(!1)}})()},[t]),(0,a.jsx)(R,{open:t,onOpenChange:s,children:(0,a.jsx)(H,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0",children:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,a.jsx)(X,{className:"text-3xl font-semibold",children:"Settings"})}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)(ei,{}),(0,a.jsx)(en,{storage:i?null:r}),(0,a.jsx)(et,{}),(0,a.jsx)(ea,{})]})]})})})}eo.displayName=er.bL.displayName;var ec=s(381);function ed(){var e;let{data:t,connectionState:s}=function(){let[e,t]=(0,n.useState)(null),[s,a]=(0,n.useState)("disconnected"),[r,o]=(0,n.useState)(null),[i,l]=(0,n.useState)(null),c=(0,n.useRef)(null),d=(0,n.useRef)(null),u=(0,n.useRef)(!0),f=(0,n.useRef)(0),g=(0,n.useCallback)(()=>i&&i.progress<100?2e3:8e3,[i]),p=(0,n.useCallback)(async()=>{if(u.current)try{a("connecting");let e=await (0,m.ZW)({signal:AbortSignal.timeout(1e4)});if(!u.current)return;t(e),a("connected"),o(null),f.current=Date.now()}catch(t){var e,s;if(!u.current)return;console.error("Dashboard polling error:",t),(null===(e=t.name)||void 0===e?void 0:e.includes("Abort"))||(null===(s=t.message)||void 0===s?void 0:s.includes("timeout"))||(a("disconnected"),o(t))}},[]),h=(0,n.useCallback)(async()=>{if(u.current)try{let e=await (0,m.eB)();if(!u.current)return;let t=e.active_jobs,s=Object.keys(t);if(s.length>0){let e=t[s[0]];l({filename:e.filename,progress:e.progress,status:e.stage}),window.dispatchEvent(new CustomEvent("uploadProgress",{detail:{filename:e.filename,progress:e.progress,percent:e.progress,stage:e.stage}}))}else i&&l(null)}catch(e){if(!u.current)return;console.warn("Progress polling error:",e)}},[i]);return(0,n.useEffect)(()=>{let e=e=>{console.log("✅ Media uploaded, refreshing dashboard:",e.detail),p(),t(t=>{let s;if(!t)return t;let a=e.detail,n=t.media.findIndex(e=>e.slug===(null==a?void 0:a.slug));return n>=0?(s=[...t.media])[n]=a:s=[...t.media,a],{...t,media:s}})};return window.addEventListener("mediaUploaded",e),()=>window.removeEventListener("mediaUploaded",e)},[p]),(0,n.useEffect)(()=>(u.current=!0,p(),c.current&&clearInterval(c.current),c.current=setInterval(()=>{p()},g()),d.current=setInterval(()=>{h()},3e3),()=>{u.current=!1,c.current&&clearInterval(c.current),d.current&&clearInterval(d.current)}),[p,g,h]),(0,n.useEffect)(()=>{"connected"===s&&c.current&&(clearInterval(c.current),c.current=setInterval(()=>{p()},g()))},[g,p,s]),{data:e,error:r,connectionState:s,uploadProgress:i,isConnected:"connected"===s,isConnecting:"connecting"===s}}(),[r,o]=(0,n.useState)(!1);return(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-black text-white relative",children:[(0,a.jsx)("header",{className:"p-4 border-b border-gray-800",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"LOOP"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(L,{connectionState:s}),(0,a.jsxs)(k,{variant:"ghost",size:"sm",onClick:()=>o(!0),className:"text-muted-foreground hover:text-white",children:[(0,a.jsx)(ec.A,{className:"w-4 h-4 mr-2"}),"Settings"]})]})]})}),(0,a.jsx)("main",{className:"flex-1 overflow-hidden",children:t?(0,a.jsx)(D,{dashboardData:t}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-gray-400 border-t-transparent rounded-full"}),(0,a.jsx)("span",{children:"Loading dashboard..."})]})})}),(0,a.jsx)(z,{status:null!==(e=null==t?void 0:t.status)&&void 0!==e?e:null,currentlyPlaying:null}),(0,a.jsx)(el,{isOpen:r,onClose:()=>o(!1)})]})}},1886:(e,t,s)=>{"use strict";s.d(t,{A4:()=>z,BS:()=>p,EL:()=>h,Id:()=>T,KG:()=>P,Px:()=>D,QQ:()=>L,S:()=>N,UB:()=>A,Uk:()=>_,Ux:()=>F,XX:()=>E,Xf:()=>C,YB:()=>w,ZW:()=>U,Zs:()=>S,eB:()=>f,eW:()=>j,forceStopProgress:()=>k,hR:()=>v,jq:()=>b,sd:()=>y,w8:()=>x});var a=s(6671);let n="/api";class r{set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}invalidate(e){this.cache.delete(e)}clear(){this.cache.clear()}constructor(){this.cache=new Map}}let o=new r;async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500,a=Error("No attempts made");for(let u=0;u<=t;u++)try{return await e()}catch(m){var n,r,o,i,l,c,d;if(a=m,!((null===(n=m.message)||void 0===n?void 0:n.includes("503"))||(null===(r=m.message)||void 0===r?void 0:r.includes("Service Unavailable"))||(null===(o=m.message)||void 0===o?void 0:o.includes("Failed to fetch"))||(null===(i=m.message)||void 0===i?void 0:i.includes("NetworkError"))||(null===(l=m.message)||void 0===l?void 0:l.includes("timeout"))||(null===(c=m.message)||void 0===c?void 0:c.includes("ECONNRESET"))||(null===(d=m.message)||void 0===d?void 0:d.includes("ENOTFOUND"))||"AbortError"===m.name||"TimeoutError"===m.name||"TypeError"===m.name)||u===t)throw m;let e=Math.min(s*Math.pow(1.5,u)+200*Math.random(),5e3);console.log("API retry ".concat(u+1,"/").concat(t," after ").concat(e.toFixed(0),"ms: ").concat(m.message)),await new Promise(t=>setTimeout(t,e))}throw a}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=()=>fetch(e,t);return s?a():i(a)}async function c(e){if(!e.ok){let t;try{let s=e.headers.get("content-type");if(s&&s.includes("application/json")){let s=await e.json();t=s.message||s.error||"HTTP ".concat(e.status)}else t=await e.text()}catch(s){t="HTTP ".concat(e.status,": ").concat(e.statusText)}throw Error(t)}let t=e.headers.get("content-type");if(t&&t.includes("application/json"))return e.json();throw Error("Expected JSON response but received HTML")}function d(e){if(!e.success)throw Error(e.message||"API request failed");return e.data}class u{async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="GET:".concat(e,":").concat(JSON.stringify(t));if(this.pendingRequests.has(s))return console.log("Deduplicating GET request: ".concat(e)),this.pendingRequests.get(s);let a=this.getTimeoutForEndpoint(e),n={...t,signal:t.signal||AbortSignal.timeout(a)},r=i(()=>l("".concat(this.baseUrl).concat(e),{...n,method:"GET"}).then(e=>c(e)));this.pendingRequests.set(s,r);try{return await r}finally{this.pendingRequests.delete(s)}}async post(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.getTimeoutForEndpoint(e),n={...s,signal:s.signal||AbortSignal.timeout(a),method:"POST",headers:{"Content-Type":"application/json",...s.headers}};if(t instanceof FormData){n.body=t;let e={...n.headers};delete e["Content-Type"],n.headers=e}else t&&(n.body=JSON.stringify(t));return i(()=>l("".concat(this.baseUrl).concat(e),n).then(e=>c(e)))}async put(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.getTimeoutForEndpoint(e),n={...s,signal:s.signal||AbortSignal.timeout(a),method:"PUT",headers:{"Content-Type":"application/json",...s.headers},body:t?JSON.stringify(t):void 0};return i(()=>l("".concat(this.baseUrl).concat(e),n).then(e=>c(e)))}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getTimeoutForEndpoint(e),a={...t,signal:t.signal||AbortSignal.timeout(s),method:"DELETE"};return i(()=>l("".concat(this.baseUrl).concat(e),a).then(e=>c(e)))}getTimeoutForEndpoint(e){return e.includes("/media")?3e4:e.includes("/dashboard")||e.includes("/poll")?15e3:e.includes("/wifi/scan")?2e4:1e4}cleanup(){let e=Date.now();for(let[t,s]of this.requestTimeouts.entries())e-s>6e4&&(this.pendingRequests.delete(t),this.requestTimeouts.delete(t))}constructor(e=n){this.pendingRequests=new Map,this.requestTimeouts=new Map,this.baseUrl=e}}let m=new u;async function f(){return d(await m.get("/poll/progress"))}function g(e,t,s){return a.o.promise(e,{loading:t,success:s||"Operation completed",error:e=>"Error: ".concat(e.message)}),e}async function p(e){return(await U(e)).status}async function h(e){let t=g(m.post("/media/".concat(e,"/activate")).then(d),"Activating media...","Media activated");return _(),t}async function x(e){let t=g(m.delete("/media/".concat(e)).then(d),"Deleting media...","Media deleted");return _(),t}async function v(e){let t=g(m.post("/loop",{slug:e}).then(d),"Adding to loop...","Added to loop");return _(),t}async function b(e){let t=g(m.delete("/loop/".concat(e)).then(d),"Removing from loop...","Removed from loop");return _(),t}async function y(){return g(m.post("/playback/toggle").then(d),"Toggling playback...")}async function w(){return g(m.post("/playback/next").then(d),"Skipping to next...")}async function j(){return g(m.post("/playback/previous").then(d),"Skipping to previous...")}async function N(){return g(m.post("/playback/loop-mode").then(d),"Toggling loop mode...")}async function k(){return m.post("/playback/force-stop-progress").then(d)}async function C(){return d(await g(m.get("/wifi/scan"),"Scanning for networks...","Networks found"))}async function S(e,t){return g(m.post("/wifi/connect",{ssid:e,password:t}).then(d),"Connecting to ".concat(e,"..."),"Connected to ".concat(e))}async function T(){return g(m.post("/wifi/hotspot").then(d),"Toggling hotspot...")}async function E(){return g(m.post("/wifi/save-current").then(d),"Saving current network...","Current network saved")}async function A(e){return m.get("/dashboard/storage",e)}async function F(){return d(await g(m.get("/updates/check"),"Checking for updates..."))}async function D(){return g(m.post("/updates/install").then(d),"Installing update...","Update installed successfully")}async function U(e){if(!(null==e?void 0:e.signal)&&M)return console.log("Dashboard request already in flight, returning existing promise"),M;if(M&&!(null==e?void 0:e.signal))return M;console.log("Starting new dashboard request");let t=Date.now(),s=m.get("/dashboard",{...e,signal:(null==e?void 0:e.signal)||AbortSignal.timeout(6e4)}).finally(()=>{let e=Date.now()-t;console.log("Dashboard request completed in ".concat(e,"ms")),M=null});M=s;try{return await s}catch(e){throw M=null,e}}function _(){o.invalidate("dashboard")}async function z(e){return g(m.post("/display/brightness",e).then(d),"Applying display settings…","Display updated")}async function L(){return d(await m.get("/display/brightness"))}let M=null;async function P(e,t,s){console.log("Starting upload of processed media: ".concat(t));let a=e instanceof FormData?e:(()=>{let s=new FormData;return s.append("files",e,t),s})(),r=new XMLHttpRequest;return new Promise((e,o)=>{r.open("POST","".concat(n,"/media")),console.log("XHR request opened for ".concat(t)),r.onload=()=>{var s;if(console.log("XHR onload fired for ".concat(t,": status ").concat(r.status,", readyState ").concat(r.readyState)),console.log("Response received: ".concat((null===(s=r.responseText)||void 0===s?void 0:s.length)||0," bytes")),r.status>=200&&r.status<300)try{let s=JSON.parse(r.responseText||"{}");console.log("Upload successful for ".concat(t,":"),s),e(d(s))}catch(e){console.error("Failed to parse response for ".concat(t,":"),e),console.error("Raw response: ".concat(r.responseText)),o(Error("Invalid response format: ".concat(e)))}else console.error("Upload failed for ".concat(t,": HTTP ").concat(r.status)),console.error("Error response: ".concat(r.responseText)),o(Error("Upload failed: HTTP ".concat(r.status)))},r.onerror=e=>{console.error("XHR error for ".concat(t,":"),e),console.error("XHR state: status=".concat(r.status,", readyState=").concat(r.readyState)),o(Error("Network error during upload"))},r.onabort=()=>{console.warn("XHR aborted for ".concat(t)),o(Error("Upload aborted"))},r.ontimeout=()=>{console.error("XHR timeout for ".concat(t)),o(Error("Upload timeout"))},r.upload&&s&&(r.upload.onloadstart=()=>{console.log("Upload started for ".concat(t))},r.upload.onprogress=e=>{if(e.lengthComputable){let a=e.loaded/e.total;console.log("Upload progress for ".concat(t,": ").concat((100*a).toFixed(1),"% (").concat(e.loaded,"/").concat(e.total," bytes)")),s(a)}else console.log("Upload progress for ".concat(t,": ").concat(e.loaded," bytes (total unknown)"))},r.upload.onload=()=>{console.log("File transfer complete for ".concat(t," - backend processing starting..."))},r.upload.onerror=e=>{console.error("Upload error for ".concat(t,":"),e)},r.upload.onabort=()=>{console.warn("Upload aborted for ".concat(t))},r.upload.ontimeout=()=>{console.error("Upload timeout for ".concat(t))}),r.timeout=9e5,console.log("Sending XHR request for ".concat(t,"..."));try{r.send(a),console.log("XHR send() called for ".concat(t))}catch(e){console.error("Failed to send XHR for ".concat(t,":"),e),o(e)}})}},2857:(e,t,s)=>{Promise.resolve().then(s.bind(s,1816))}},e=>{var t=t=>e(e.s=t);e.O(0,[671,171,441,684,358],()=>t(2857)),_N_E=e.O()}]);