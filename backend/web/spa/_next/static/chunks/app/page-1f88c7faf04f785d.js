(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2857:(e,t,s)=>{Promise.resolve().then(s.bind(s,9989))},9989:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eB});var a=s(5155),l=s(2115),n=s(6671);let r="/api";class o{set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}invalidate(e){this.cache.delete(e)}clear(){this.cache.clear()}constructor(){this.cache=new Map}}let i=new o;async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,a=Error("No attempts made");for(let o=0;o<=t;o++)try{return await e()}catch(i){var l,n,r;if(a=i,!((null===(l=i.message)||void 0===l?void 0:l.includes("503"))||(null===(n=i.message)||void 0===n?void 0:n.includes("Service Unavailable"))||(null===(r=i.message)||void 0===r?void 0:r.includes("Failed to fetch"))||"AbortError"===i.name)||o===t)throw i;let e=s*Math.pow(2,o)+500*Math.random();console.log("API retry ".concat(o+1,"/").concat(t," after ").concat(e,"ms: ").concat(i.message)),await new Promise(t=>setTimeout(t,e))}throw a}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=()=>fetch(e,t);return s?a():c(a)}async function u(e){if(!e.ok){let t;try{let s=e.headers.get("content-type");if(s&&s.includes("application/json")){let s=await e.json();t=s.message||s.error||"HTTP ".concat(e.status)}else t=await e.text()}catch(s){t="HTTP ".concat(e.status,": ").concat(e.statusText)}throw Error(t)}let t=e.headers.get("content-type");if(t&&t.includes("application/json"))return e.json();throw Error("Expected JSON response but received HTML")}function m(e){if(!e.success)throw Error(e.message||"API request failed");return e.data}class f{async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(await d("".concat(this.baseUrl).concat(e),{...t,method:"GET"}))}async post(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={...s,method:"POST",headers:{"Content-Type":"application/json",...s.headers}};return t&&(a.body=t instanceof FormData?t:JSON.stringify(t),t instanceof FormData&&a.headers&&delete a.headers["Content-Type"]),u(await d("".concat(this.baseUrl).concat(e),a))}async put(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u(await d("".concat(this.baseUrl).concat(e),{...s,method:"PUT",headers:{"Content-Type":"application/json",...s.headers},body:t?JSON.stringify(t):void 0}))}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(await d("".concat(this.baseUrl).concat(e),{...t,method:"DELETE"}))}async upload(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u(await d("".concat(this.baseUrl).concat(e),{...s,method:"POST",body:t},!0))}constructor(e=r){this.baseUrl=e}}let p=new f;function g(e,t,s){return n.o.promise(e,{loading:t,success:s||"Operation completed",error:e=>"Error: ".concat(e.message)}),e}async function x(e){return(await D(e)).status}async function h(e){let t=g(p.post("/media/".concat(e,"/activate")).then(m),"Activating media...","Media activated");return L(),t}async function v(e){let t=g(p.delete("/media/".concat(e)).then(m),"Deleting media...","Media deleted");return L(),t}async function b(e){let t=g(p.post("/loop",{slug:e}).then(m),"Adding to loop...","Added to loop");return L(),t}async function j(e){let t=g(p.delete("/loop/".concat(e)).then(m),"Removing from loop...","Removed from loop");return L(),t}async function y(e){let t=g(p.put("/loop",{loop:e}).then(m),"Saving order…","Loop order saved");return L(),t}async function N(){return g(p.post("/playback/toggle").then(m),"Toggling playback...")}async function w(){return g(p.post("/playback/loop-mode").then(m),"Toggling loop mode...")}async function k(){return m(await g(p.get("/wifi/scan"),"Scanning for networks...","Networks found"))}async function S(e,t){return g(p.post("/wifi/connect",{ssid:e,password:t}).then(m),"Connecting to ".concat(e,"..."),"Connected to ".concat(e))}async function C(){return g(p.post("/wifi/hotspot").then(m),"Toggling hotspot...")}async function E(e){return(await D(e)).storage}async function A(){return m(await g(p.get("/updates/check"),"Checking for updates..."))}async function U(){return g(p.post("/updates/install").then(m),"Installing update...","Update installed successfully")}async function D(e){if(!(null==e?void 0:e.signal)&&P)return P;let t=p.get("/dashboard",e);P=t;let s=await t;return P=null,s}function L(){i.invalidate("dashboard")}async function F(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3,l=0,n=setInterval(async()=>{try{var a;let r=await p.get("/media/progress",{signal:AbortSignal.timeout(6e4)}),o=(null===(a=m(r))||void 0===a?void 0:a.jobs)||{};l=0;let i={};for(let[t,s]of Object.entries(o))e.includes(t)&&s&&"object"==typeof s&&(i[t]={job_id:s.job_id||t,filename:s.filename||"",status:s.status||"processing",progress:Number(s.progress)||0,stage:s.stage||"",message:s.message||"",timestamp:Number(s.timestamp)||Date.now()/1e3});t(i),e.every(e=>{let t=o[e];return t&&("completed"===t.status||"error"===t.status)})&&(clearInterval(n),s())}catch(e){l++,console.error("Error polling progress (".concat(l,"/").concat(5,"):"),e),l>=5&&(console.error("Too many consecutive errors, stopping progress polling"),clearInterval(n),s())}},a);return()=>clearInterval(n)}async function I(e){return g(p.post("/display/brightness",e).then(m),"Applying display settings…","Display updated")}async function T(){return m(await p.get("/display/brightness"))}let P=null;async function R(e,t,s){console.log("Starting upload of processed media: ".concat(t,", size: ").concat(e.size," bytes"));let a=new FormData;a.append("files",e,t);let l=new XMLHttpRequest;return new Promise((e,n)=>{l.open("POST","".concat(r,"/media")),console.log("XHR request opened for ".concat(t)),l.onload=()=>{var s;if(console.log("XHR onload fired for ".concat(t,": status ").concat(l.status,", readyState ").concat(l.readyState)),console.log("Response received: ".concat((null===(s=l.responseText)||void 0===s?void 0:s.length)||0," bytes")),l.status>=200&&l.status<300)try{let s=JSON.parse(l.responseText||"{}");console.log("Upload successful for ".concat(t,":"),s),e(m(s))}catch(e){console.error("Failed to parse response for ".concat(t,":"),e),console.error("Raw response: ".concat(l.responseText)),n(Error("Invalid response format: ".concat(e)))}else console.error("Upload failed for ".concat(t,": HTTP ").concat(l.status)),console.error("Error response: ".concat(l.responseText)),n(Error("Upload failed: HTTP ".concat(l.status)))},l.onerror=e=>{console.error("XHR error for ".concat(t,":"),e),console.error("XHR state: status=".concat(l.status,", readyState=").concat(l.readyState)),n(Error("Network error during upload"))},l.onabort=()=>{console.warn("XHR aborted for ".concat(t)),n(Error("Upload aborted"))},l.ontimeout=()=>{console.error("XHR timeout for ".concat(t)),n(Error("Upload timeout"))},l.upload&&s&&(l.upload.onloadstart=()=>{console.log("Upload started for ".concat(t))},l.upload.onprogress=e=>{if(e.lengthComputable){let a=e.loaded/e.total;console.log("Upload progress for ".concat(t,": ").concat((100*a).toFixed(1),"% (").concat(e.loaded,"/").concat(e.total," bytes)")),s(a)}else console.log("Upload progress for ".concat(t,": ").concat(e.loaded," bytes (total unknown)"))},l.upload.onload=()=>{console.log("Upload data transfer complete for ".concat(t))},l.upload.onerror=e=>{console.error("Upload error for ".concat(t,":"),e)},l.upload.onabort=()=>{console.warn("Upload aborted for ".concat(t))},l.upload.ontimeout=()=>{console.error("Upload timeout for ".concat(t))}),l.timeout=3e5,console.log("Sending XHR request for ".concat(t,"..."));try{l.send(a),console.log("XHR send() called for ".concat(t))}catch(e){console.error("Failed to send XHR for ".concat(t,":"),e),n(e)}})}let M=new Map;function O(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(M.has(e))return;let l=n.o[t](s,{...a,onDismiss(){M.delete(e),"function"==typeof a.onDismiss&&a.onDismiss()}});M.set(e,l)}var _=s(5143),z=s(402),H=s(8266);let B=null,G=null;function X(e){let{src:t,alt:s,className:n,placeholder:r="/placeholder.svg"}=e,[o,i]=(0,l.useState)(!1),[c,d]=(0,l.useState)(!1),u=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=new IntersectionObserver(t=>{let[s]=t;s.isIntersecting&&(d(!0),e.disconnect())},{rootMargin:"50px",threshold:.1});return u.current&&e.observe(u.current),()=>e.disconnect()},[]),(0,a.jsx)("img",{ref:u,src:c?t:r,alt:s,className:"".concat(n," ").concat(!o&&c?"opacity-50":"opacity-100"," transition-opacity duration-300"),onLoad:()=>i(!0),loading:"lazy"})}function J(e){let{item:t,isActive:s,isInLoop:l,onActivate:n,onDelete:r,onAddToLoop:o,onRemove:i}=e,{attributes:c,listeners:d,setNodeRef:u,transform:m,transition:f,isDragging:p}=(0,z.gl)({id:t.slug}),g={transform:H.Ks.Transform.toString(m),transition:f,opacity:p?.5:1};return(0,a.jsxs)("div",{ref:u,style:g,className:"group flex items-center gap-8 p-8 transition-all ".concat(s?"bg-accent":"hover:bg-accent/30"),children:[(0,a.jsx)("div",{...c,...d,className:"cursor-grab active:cursor-grabbing opacity-30 hover:opacity-100 transition-opacity",children:(0,a.jsxs)("div",{className:"w-5 h-5 flex flex-col gap-1",children:[(0,a.jsx)("div",{className:"w-full h-0.5 bg-current rounded"}),(0,a.jsx)("div",{className:"w-full h-0.5 bg-current rounded"}),(0,a.jsx)("div",{className:"w-full h-0.5 bg-current rounded"})]})}),(0,a.jsx)("div",{className:"w-32 aspect-[32/24] rounded-2xl overflow-hidden bg-muted flex-shrink-0 ".concat(l?"":"opacity-40 grayscale"),children:t.url&&t.type.startsWith("image/")?(0,a.jsx)(X,{src:t.url,alt:t.filename,className:"w-full h-full object-cover"}):t.url&&t.type.startsWith("video/")?(0,a.jsx)("video",{src:t.url,muted:!0,loop:!0,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"□"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"flex items-center gap-4 mb-2",children:(0,a.jsx)("h4",{className:"font-semibold text-lg truncate",children:t.filename})}),(0,a.jsxs)("div",{className:"flex items-center gap-8 text-sm text-muted-foreground",children:[(0,a.jsxs)("span",{children:[(t.size/1024/1024).toFixed(1)," MB"]}),(0,a.jsx)("span",{children:new Date(t.uploadedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),t.duration&&(0,a.jsxs)("span",{children:[t.duration,"s"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)("button",{onClick:()=>l?i(t.slug):o(t),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors ".concat(l?"bg-green-400 text-black hover:bg-green-500":"bg-muted text-muted-foreground hover:bg-accent"),title:l?"Disable":"Enable",children:l?"Active":"Inactive"}),(0,a.jsx)("button",{onClick:()=>r(t.slug),className:"h-12 w-12 rounded-xl hover:bg-destructive hover:text-white flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lg",children:"\xd7"})})]})]})}function V(e){var t,s;let{activeSlug:n,status:r,onCurrentlyPlayingChange:o}=e,[i,c]=(0,l.useState)([]),[d,u]=(0,l.useState)([]),[m,f]=(0,l.useState)(0),p=(0,_.FR)((0,_.MS)(_.AN),(0,_.MS)(_.uN,{coordinateGetter:z.JR})),{data:g}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,[t,s]=(0,l.useState)(G),[a,n]=(0,l.useState)(null);return(0,l.useEffect)(()=>{let t=!1,a=async()=>{try{let e=B;e||(B=e=D());let a=await e;t||(G=a,s(a),n(null))}catch(e){t||n(e)}finally{B=null}};a();let l=setInterval(()=>{L(),a()},e);return()=>{t=!0,clearInterval(l)}},[e]),{data:t,error:a}}(1e4);(0,l.useEffect)(()=>{var e,t;if(!g)return;let s=null!==(e=g.media)&&void 0!==e?e:[],a=(null!==(t=g.loop)&&void 0!==t?t:[]).map(e=>s.find(t=>t.slug===e)).filter(Boolean);if(c(s),u(a),g.active){let e=a.findIndex(e=>e.slug===g.active);-1!==e&&f(e)}},[g]),(0,l.useEffect)(()=>{let e=()=>{L(),D().then(e=>{var t,s;let a=null!==(t=e.media)&&void 0!==t?t:[];c(a);let l=(null!==(s=e.loop)&&void 0!==s?s:[]).map(e=>a.find(t=>t.slug===e)).filter(Boolean);if(u(l),e.active){let t=l.findIndex(t=>t.slug===e.active);-1!==t&&f(t)}}).catch(console.error)};return window.addEventListener("mediaUploaded",e),()=>{window.removeEventListener("mediaUploaded",e)}},[]),(0,l.useEffect)(()=>{var e;if((null==r?void 0:null===(e=r.player)||void 0===e?void 0:e.is_playing)&&d.length>0){let e=setInterval(()=>{f(e=>(e+1)%d.length)},8e3);return()=>clearInterval(e)}},[null==r?void 0:null===(t=r.player)||void 0===t?void 0:t.is_playing,d.length]),(0,l.useEffect)(()=>{o(d.length>0?d[m]:null)},[d,m,o]);let x=async e=>{try{await h(e);let t=d.findIndex(t=>t.slug===e);-1!==t&&f(t)}catch(e){O("media-play-fail","error","Failed to play media")}},N=async e=>{try{var t,s;await j(e);let a=await D(),l=null!==(t=a.media)&&void 0!==t?t:[],n=(null!==(s=a.loop)&&void 0!==s?s:[]).map(e=>l.find(t=>t.slug===e)).filter(Boolean);if(c(l),u(n),a.active){let e=n.findIndex(e=>e.slug===a.active);-1!==e&&f(e)}else f(0)}catch(e){O("media-remove-fail","error","Failed to remove from loop")}},w=async e=>{try{var t,s;await v(e);let a=await D(),l=null!==(t=a.media)&&void 0!==t?t:[],n=(null!==(s=a.loop)&&void 0!==s?s:[]).map(e=>l.find(t=>t.slug===e)).filter(Boolean);if(c(l),u(n),a.active&&n.length>0){let e=n.findIndex(e=>e.slug===a.active);-1!==e?f(e):f(0)}else f(0)}catch(e){O("media-delete-fail","error","Failed to delete media")}},k=async e=>{try{var t,s;await b(e.slug);let a=await D(),l=null!==(t=a.media)&&void 0!==t?t:[],n=(null!==(s=a.loop)&&void 0!==s?s:[]).map(e=>l.find(t=>t.slug===e)).filter(Boolean);if(c(l),u(n),a.active){let e=n.findIndex(e=>e.slug===a.active);-1!==e&&f(e)}}catch(e){O("media-add-fail","error","Failed to add to loop")}},S=d.map(e=>e.slug),C=d.length>0?null===(s=d[m])||void 0===s?void 0:s.slug:n;return(0,a.jsx)("div",{className:"space-y-16 pb-16",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-12",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Loop Library"}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:[i.length," items"]})]}),0===i.length?(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-32 text-center",children:[(0,a.jsx)("div",{className:"text-8xl mb-8",children:"□"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"No media"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Upload files to get started"})]}):(0,a.jsx)("div",{className:"rounded-3xl bg-card overflow-hidden",children:(0,a.jsx)(_.Mp,{sensors:p,collisionDetection:_.fp,onDragEnd:e=>{let{active:t,over:s}=e;s&&t.id!==s.id&&c(e=>{let a=e.findIndex(e=>e.slug===t.id),l=e.findIndex(e=>e.slug===s.id),n=(0,z.be)(e,a,l),r=new Set(d.map(e=>e.slug));return y(n.filter(e=>r.has(e.slug)).map(e=>e.slug)).catch(console.error),n})},children:(0,a.jsx)(z.gB,{items:i.map(e=>e.slug),strategy:z._G,children:(0,a.jsx)("div",{className:"divide-y divide-border",children:i.map(e=>(0,a.jsx)(J,{item:e,isActive:e.slug===C,isInLoop:S.includes(e.slug),onActivate:x,onDelete:w,onAddToLoop:k,onRemove:N},e.slug))})})})})]})})}function W(){return(0,a.jsx)("div",{className:"space-y-16 pb-16",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-12",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Loop Library"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]}),(0,a.jsx)("div",{className:"rounded-3xl bg-muted/20 py-32 text-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Connecting to LOOP..."})]})})]})})}var q=s(9708),Q=s(2085),Y=s(2596),K=s(9688);function Z(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,K.QP)((0,Y.$)(t))}let $=(0,Q.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ee=l.forwardRef((e,t)=>{let{className:s,variant:l,size:n,asChild:r=!1,...o}=e,i=r?q.DX:"button";return(0,a.jsx)(i,{className:Z($({variant:l,size:n,className:s})),ref:t,...o})});ee.displayName="Button";var et=s(184);let es=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(et.bL,{className:Z("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...l,ref:t,children:(0,a.jsx)(et.zi,{className:Z("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});function ea(e){var t,s,n;let{status:r,currentlyPlaying:o}=e,i=(0,l.useCallback)(()=>{let e=new CustomEvent("openUploadDialog",{detail:{browse:!0}});window.dispatchEvent(e)},[]),c=async()=>{try{await N()}catch(e){O("playback-toggle-fail","error","Failed to toggle playback")}},d=async()=>{try{await w()}catch(e){O("loopmode-fail","error","Failed to toggle loop mode")}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)(ee,{onClick:i,className:"bg-white text-black hover:bg-gray-100 rounded-full px-6 py-2 text-sm font-medium transition-colors",children:"Add Media"})}),(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-black border-t border-gray-800",children:(0,a.jsx)("div",{className:"mx-auto max-w-6xl px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-800 flex-shrink-0",children:(null==o?void 0:o.url)&&o.type.startsWith("image/")?(0,a.jsx)("img",{src:o.url||"/placeholder.svg",alt:o.filename,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"□"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"text-white text-sm font-medium truncate",children:o?o.filename:"No media in loop"}),(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:o?"Now Playing":"Add media to start"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs text-gray-400",children:(null==r?void 0:null===(t=r.player)||void 0===t?void 0:t.loop_mode)==="all"?"Loop All":"Loop One"}),(0,a.jsx)(es,{checked:(null==r?void 0:null===(s=r.player)||void 0===s?void 0:s.loop_mode)==="all",onCheckedChange:d,className:"data-[state=checked]:bg-green-400 data-[state=unchecked]:bg-gray-600"})]}),(0,a.jsx)("button",{onClick:c,className:"h-10 w-10 rounded-full bg-white text-black hover:bg-gray-100 transition-colors flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lg",children:(null==r?void 0:null===(n=r.player)||void 0===n?void 0:n.is_playing)?"⏸":"▶"})})]})]})})})]})}es.displayName=et.bL.displayName;var el=s(1189),en=s(4416);let er=el.bL,eo=el.l9,ei=el.ZL;el.bm;let ec=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(el.hJ,{ref:t,className:Z("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...l})});ec.displayName=el.hJ.displayName;let ed=l.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(ei,{children:[(0,a.jsx)(ec,{}),(0,a.jsxs)(el.UC,{ref:t,className:Z("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[l,(0,a.jsxs)(el.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(en.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});ed.displayName=el.UC.displayName;let eu=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:Z("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};eu.displayName="DialogHeader";let em=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(el.hE,{ref:t,className:Z("text-lg font-semibold leading-none tracking-tight",s),...l})});em.displayName=el.hE.displayName,l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(el.VY,{ref:t,className:Z("text-sm text-muted-foreground",s),...l})}).displayName=el.VY.displayName;let ef=(0,Q.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ep(e){let{className:t,variant:s,...l}=e;return(0,a.jsx)("div",{className:Z(ef({variant:s}),t),...l})}let eg=l.forwardRef((e,t)=>{let{className:s,type:l,...n}=e;return(0,a.jsx)("input",{type:l,className:Z("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});eg.displayName="Input";var ex=s(968);let eh=(0,Q.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ev=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(ex.b,{ref:t,className:Z(eh(),s),...l})});ev.displayName=ex.b.displayName;var eb=s(2652),ej=s(6517),ey=s(4449),eN=s(2919);function ew(){let[e,t]=(0,l.useState)([]),[s,n]=(0,l.useState)(!1),[r,o]=(0,l.useState)(!1),[i,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(""),[m,f]=(0,l.useState)({connected:!1,ssid:"",hotspotActive:!1});(0,l.useEffect)(()=>{let e=async()=>{try{let e=await x();(null==e?void 0:e.wifi)&&f({connected:!!e.wifi.connected,ssid:e.wifi.current_ssid||"",hotspotActive:!!e.wifi.hotspot_active})}catch(e){}};e();let t=setInterval(e,5e3);return()=>clearInterval(t)},[]);let p=async()=>{n(!0);try{let e=await k();t(e.networks),O("wifi-scan-ok","success","Found ".concat(e.networks.length," networks"))}catch(e){O("wifi-scan-err","error","Failed to scan for networks")}finally{n(!1)}},g=async()=>{if(i){o(!0);try{await S(i.ssid,d),O("wifi-connect","success","Connected to ".concat(i.ssid)),f(e=>({...e,connected:!0,ssid:i.ssid})),c(null),u("")}catch(e){O("wifi-connect-fail","error","Failed to connect to network")}finally{o(!1)}}},h=async()=>{try{await C();let e=!m.hotspotActive;f(t=>({...t,hotspotActive:e})),O("hotspot-toggle","success",e?"Hotspot enabled":"Hotspot disabled")}catch(e){O("hotspot-err","error","Failed to toggle hotspot")}},v=e=>e>75?(0,a.jsx)(eb.A,{className:"h-4 w-4"}):e>50?(0,a.jsx)(eb.A,{className:"h-4 w-4 opacity-75"}):e>25?(0,a.jsx)(eb.A,{className:"h-4 w-4 opacity-50"}):(0,a.jsx)(eb.A,{className:"h-4 w-4 opacity-25"});return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8 space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"WiFi Configuration"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[m.connected?(0,a.jsx)(ej.A,{className:"h-5 w-5 text-green-500"}):(0,a.jsx)(ey.A,{className:"h-5 w-5 text-red-500"}),(0,a.jsx)("span",{className:"font-medium",children:m.connected?'Connected to "'.concat(m.ssid,'"'):"Not connected"})]}),m.hotspotActive&&(0,a.jsx)(ep,{variant:"secondary",children:"Hotspot Active"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(ee,{onClick:p,disabled:s,variant:"outline",children:s?"Scanning...":"Scan for Networks"}),(0,a.jsx)(ee,{onClick:h,variant:m.hotspotActive?"destructive":"outline",children:m.hotspotActive?"Disable Hotspot":"Enable Hotspot"})]}),e.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Available Networks"}),(0,a.jsx)("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:e.map(e=>(0,a.jsxs)(er,{children:[(0,a.jsx)(eo,{asChild:!0,children:(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg cursor-pointer hover:bg-accent",onClick:()=>c(e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"font-medium",children:e.ssid}),e.secured&&(0,a.jsx)(eN.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[v(e.signal),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.signal,"%"]})]})]})}),(0,a.jsxs)(ed,{children:[(0,a.jsx)(eu,{children:(0,a.jsxs)(em,{children:["Connect to ",e.ssid]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[e.secured&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ev,{htmlFor:"password",children:"Password"}),(0,a.jsx)(eg,{id:"password",type:"password",value:d,onChange:e=>u(e.target.value),placeholder:"Enter network password"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(ee,{variant:"outline",onClick:()=>c(null),children:"Cancel"}),(0,a.jsx)(ee,{onClick:g,disabled:r||e.secured&&!d,children:r?"Connecting...":"Connect"})]})]})]})]},e.ssid))})]})]})}var ek=s(646),eS=s(1788);function eC(){let[e]=(0,l.useState)("1.0.0"),[t,s]=(0,l.useState)(null),[n,r]=(0,l.useState)(!1),[o,i]=(0,l.useState)(!1),c=async()=>{r(!0);try{(await A()).updates_available.git?(s("Available"),O("update-avail","success","Git update available")):O("update-none","info","System is up to date")}catch(e){O("update-check-fail","error","Failed to check for updates")}finally{r(!1)}},d=async()=>{if(t){i(!0);try{await U(),O("update-installed","success","Update installed - device will restart"),s(null)}catch(e){O("update-install-fail","error","Failed to install update")}finally{i(!1)}}};return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8 space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"System & Updates"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ek.A,{className:"h-5 w-5 text-green-500"}),(0,a.jsx)("span",{className:"font-medium",children:"Current Version"})]}),(0,a.jsx)(ep,{variant:"outline",children:e})]}),t&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-primary/5 border border-primary/20 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eS.A,{className:"h-5 w-5 text-primary"}),(0,a.jsx)("span",{className:"font-medium",children:"Update Available"})]}),(0,a.jsx)(ep,{children:t})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(ee,{onClick:c,disabled:n,variant:"outline",children:n?"Checking...":"Check for Updates"}),(0,a.jsx)(ee,{onClick:d,disabled:!t||o,children:o?"Installing...":"Install Update"})]}),t&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground p-3 bg-muted rounded-lg",children:[(0,a.jsx)("strong",{children:"Note:"})," The device will automatically restart after the update is installed. Make sure no critical operations are running."]})]})}function eE(){let e;let[t,s]=(0,l.useState)(null);if((0,l.useEffect)(()=>{let e=async()=>{try{let e=await E();s(e)}catch(e){console.error("Failed to fetch storage info:",e)}};e();let t=setInterval(e,parseInt("10000",10));return()=>clearInterval(t)},[]),!t)return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Storage"}),(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading storage info…"})]})]});let n=e=>0===e?"0 GB":"".concat((e/0x40000000).toFixed(1)," GB"),r=t.system/t.total*100,o=t.app/t.total*100,i=t.media/t.total*100;return t.free,t.total,(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Storage"}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[n(t.used)," of ",n(t.total)," used"]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[n(t.free)," available"]})]}),(0,a.jsxs)("div",{className:"h-2 bg-muted rounded-full overflow-hidden flex",children:[(0,a.jsx)("div",{className:"bg-blue-500 h-full",style:{width:"".concat(r,"%")}}),(0,a.jsx)("div",{className:"bg-purple-500 h-full",style:{width:"".concat(o,"%")}}),(0,a.jsx)("div",{className:"bg-green-500 h-full",style:{width:"".concat(i,"%")}})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"System"})]}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:n(t.system)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"LOOP App"})]}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:n(t.app)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,a.jsx)("span",{className:"text-sm",children:"Media Files"})]}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:n(t.media)})]})]})]})}var eA=s(8018);let eU=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsxs)(eA.bL,{ref:t,className:Z("relative flex w-full touch-none select-none items-center",s),...l,children:[(0,a.jsx)(eA.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-muted-foreground/50",children:(0,a.jsx)(eA.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(eA.zi,{className:"block h-8 w-8 rounded-full border-[3px] border-primary bg-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});function eD(){let[e,t]=(0,l.useState)(null),[s,n]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{let{brightness:e,gamma:s}=await T();t("number"==typeof e?e:100),n("number"==typeof s?s:2.4)}catch(e){console.error("Failed to fetch brightness",e)}})()},[]);let r=async()=>{if(null!==e&&null!==s)try{await I({brightness:e,gamma:null!=s?s:void 0}),O("display-set","success","Display updated")}catch(e){O("brightness-err","error",e.message||"Failed to set brightness")}};return null===e||null===s?(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Display Settings"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Brightness"}),(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading brightness…"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Gamma"}),(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading gamma…"})]})]})]})]}):(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Display Settings"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Brightness"}),(0,a.jsx)(eU,{min:0,max:100,value:[e],onValueChange:e=>t(e[0]),onValueCommit:()=>r()}),(0,a.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:[e,"%"]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Gamma"}),(0,a.jsx)(eU,{min:1,max:3,step:.1,value:[s],onValueChange:e=>n(parseFloat(e[0].toFixed(1))),onValueCommit:()=>r()}),(0,a.jsx)("div",{className:"text-center text-sm text-muted-foreground",children:null==s?void 0:s.toFixed(1)})]})]})]})}function eL(e){let{isOpen:t,onClose:s}=e;return(0,a.jsx)(er,{open:t,onOpenChange:s,children:(0,a.jsx)(ed,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0",children:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,a.jsx)(em,{className:"text-3xl font-semibold",children:"Settings"})}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)(eD,{}),(0,a.jsx)(eE,{}),(0,a.jsx)(ew,{}),(0,a.jsx)(eC,{})]})]})})})}eU.displayName=eA.bL.displayName;var eF=s(5863);let eI=l.forwardRef((e,t)=>{let{className:s,value:l,...n}=e;return(0,a.jsx)(eF.bL,{ref:t,className:Z("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...n,children:(0,a.jsx)(eF.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});eI.displayName=eF.bL.displayName;var eT=s(9869),eP=s(4861),eR=s(4186),eM=s(9890);let eO=()=>new Worker(s.tu(new URL(s.p+s.u(539),s.b)),{type:void 0});function e_(e){let{onUploadComplete:t,autoBrowse:s}=e,[n,r]=(0,l.useState)([]),o=(0,l.useRef)(null),[i,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),m=(0,l.useMemo)(()=>"file-upload-".concat(crypto.randomUUID()),[]),f=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=eO();return o.current=e,()=>{e.terminate(),o.current=null}},[]),(0,l.useEffect)(()=>{s&&!d&&(console.log("Auto-browsing for files..."),u(!0),setTimeout(()=>{var e;null===(e=f.current)||void 0===e||e.click()},100))},[s,d]),(0,l.useEffect)(()=>{if(i)return;let e=n.find(e=>"pending"===e.stage);e&&(async e=>{c(!0),console.log("Starting job ".concat(e.id," for file ").concat(e.filename)),window.dispatchEvent(new CustomEvent("uploadStart"));try{var s,a;console.log("Converting ".concat(e.filename,"...")),r(t=>t.map(t=>t.id===e.id?{...t,stage:"converting",progress:0}:t));let l=null===(s=n.find(t=>t.id===e.id))||void 0===s?void 0:s.fileRef,i=await new Promise((t,s)=>{let a=o.current;if(!a){s(Error("Worker not initialised"));return}let n=l=>{let{id:o,progress:i,done:c,blob:d,error:u}=l.data;o===e.id&&("number"==typeof i&&(console.log("Conversion progress for ".concat(e.filename,": ").concat(i,"%")),r(t=>t.map(t=>t.id===e.id?{...t,progress:Math.round(i)}:t))),u&&(console.error("Conversion error for ".concat(e.filename,":"),u),a.removeEventListener("message",n),s(Error(u))),c&&(console.log("Conversion complete for ".concat(e.filename,", blob size: ").concat(d.size," bytes")),a.removeEventListener("message",n),t(d)))};a.addEventListener("message",n),a.postMessage({id:e.id,file:l})});console.log("Starting upload for ".concat(e.filename,", converted size: ").concat(i.size," bytes")),r(t=>t.map(t=>t.id===e.id?{...t,stage:"uploading",progress:80}:t));let c=await R(i,"".concat(e.id,".zip"),t=>{let s=80+10*t;console.log("Upload progress for ".concat(e.filename,": ").concat(s,"% (raw: ").concat(t,")")),r(t=>t.map(t=>t.id===e.id?{...t,progress:s}:t))});console.log("Upload result for ".concat(e.filename,":"),c),(null==c?void 0:null===(a=c.job_ids)||void 0===a?void 0:a.length)&&(console.log("Polling processing progress for job IDs:",c.job_ids),await new Promise(t=>{F(c.job_ids,t=>{var s,a;let l=null!==(a=null===(s=t[c.job_ids[0]])||void 0===s?void 0:s.progress)&&void 0!==a?a:0,n=90+.1*l;console.log("Server processing progress for ".concat(e.filename,": ").concat(n,"% (server: ").concat(l,"%)")),r(t=>t.map(t=>t.id===e.id?{...t,progress:n}:t))},()=>{console.log("Processing complete for ".concat(e.filename)),t()},2e3)})),console.log("Job ".concat(e.id," complete for ").concat(e.filename)),r(t=>t.map(t=>t.id===e.id?{...t,stage:"complete",progress:100}:t)),t()}catch(t){console.error("Job ".concat(e.id," failed for ").concat(e.filename,":"),t),r(s=>s.map(s=>s.id===e.id?{...s,stage:"error",error:t.message||"Conversion failed"}:s)),O("upload-error","error",t.message||"Upload failed")}finally{window.dispatchEvent(new CustomEvent("uploadEnd")),c(!1)}})(e)},[n,i,t]);let p=(0,l.useCallback)(async e=>{if(0===e.length||!x(e))return;console.log("Adding ".concat(e.length," files to upload queue"));let t=Array.from(e).map(e=>({id:crypto.randomUUID(),filename:e.name,stage:"pending",progress:0,fileRef:e}));r(e=>[...e,...t])},[]),g=(0,l.useCallback)(e=>{e.target.files&&(console.log("Files selected: ".concat(e.target.files.length)),p(e.target.files)),e.target.value=""},[p]);(0,l.useEffect)(()=>{let e=e=>{var t;let s=e.detail;if(null==s?void 0:null===(t=s.files)||void 0===t?void 0:t.length){console.log("Global drop received: ".concat(s.files.length," files"));let e=new DataTransfer;s.files.forEach(t=>e.items.add(t)),p(e.files)}};return window.addEventListener("globalFileDrop",e),()=>window.removeEventListener("globalFileDrop",e)},[p]);let x=e=>!Array.from(e).filter(e=>e.size>0x6400000).length||(O("upload-filesize","error","Files too large. Maximum ".concat(100,"MB")),!1),h=0===n.length?0:Math.round(n.reduce((e,t)=>e+t.progress,0)/n.length),v=n.some(e=>"complete"!==e.stage&&"error"!==e.stage);return(0,a.jsxs)("div",{className:"rounded-2xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-8",children:"Upload Media"}),(0,a.jsxs)("div",{className:"rounded-xl border-2 border-dashed p-12 text-center transition-colors cursor-pointer ".concat(v?"border-ring bg-accent/20 cursor-not-allowed":"border-border hover:border-ring/50 hover:bg-accent/20"),onDragOver:e=>e.preventDefault(),onClick:()=>{if(!v){var e;console.log("Upload area clicked, opening file dialog"),null===(e=f.current)||void 0===e||e.click()}},children:[(0,a.jsx)("input",{ref:f,type:"file",multiple:!0,accept:"image/*,video/*,.gif,.mov,.m4v,.heic,.heif",onChange:g,className:"hidden",id:m,disabled:v}),v?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[v?n.some(e=>"error"===e.stage)?(0,a.jsx)(eP.A,{className:"h-6 w-6 text-red-500"}):n.every(e=>"complete"===e.stage)?(0,a.jsx)(ek.A,{className:"h-6 w-6 text-green-500"}):(0,a.jsx)(eR.A,{className:"h-6 w-6 text-blue-500 animate-spin"}):(0,a.jsx)(eT.A,{className:"h-12 w-12 text-muted-foreground"}),(0,a.jsxs)("div",{className:"text-base font-medium",children:[h,"% total"]})]}),(0,a.jsx)(eI,{value:h,className:"w-full max-w-xs mx-auto"}),(0,a.jsx)("div",{className:"space-y-3 max-w-md mx-auto",children:n.map(e=>(0,a.jsxs)("div",{className:"text-xs space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eM.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"truncate max-w-32",children:e.filename})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:["complete"===e.stage?(0,a.jsx)(ek.A,{className:"h-3 w-3 text-green-500"}):"error"===e.stage?(0,a.jsx)(eP.A,{className:"h-3 w-3 text-red-500"}):(0,a.jsx)(eR.A,{className:"h-3 w-3 text-blue-500"}),(0,a.jsxs)("span",{children:[Math.round(e.progress),"%"]})]})]}),(0,a.jsx)(eI,{value:e.progress,className:"h-1"}),(0,a.jsx)("div",{className:"text-muted-foreground truncate",children:e.error||e.message||e.stage})]},e.id))})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)(eT.A,{className:"mx-auto h-12 w-12 text-muted-foreground mb-6"}),(0,a.jsx)("div",{className:"text-base font-medium mb-2",children:"Drop files here or click to browse"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Supports GIF, JPG, PNG, MP4, WebM (≤ ",100," MB each)"]})]})]})]})}function ez(){let[e,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=e=>{let s=e.detail;console.log("Upload dialog open event received:",s),n(!!(null==s?void 0:s.browse)),t(!0)};return window.addEventListener("openUploadDialog",e),()=>window.removeEventListener("openUploadDialog",e)},[]);let r=(0,l.useCallback)(()=>{console.log("Upload complete, closing dialog"),t(!1),n(!1)},[]),o=(0,l.useCallback)(e=>{console.log("Upload dialog open change:",e),t(e),e||n(!1)},[]);return(0,a.jsx)(er,{open:e,onOpenChange:o,children:(0,a.jsxs)(ed,{className:"max-w-2xl",children:[(0,a.jsx)(eu,{children:(0,a.jsx)(em,{className:"sr-only",children:"Upload Media"})}),(0,a.jsx)(e_,{onUploadComplete:r,autoBrowse:s})]})})}let eH=parseInt("10000",10);function eB(){let[e,t]=(0,l.useState)(null),[s,n]=(0,l.useState)(null),[r,o]=(0,l.useState)(!1),[i,c]=(0,l.useState)(!0),[d,u]=(0,l.useState)(!1),[m,f]=(0,l.useState)(0),[p,g]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),[v,b]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=null,s=async()=>{if(!v){e&&e.abort(),e=new AbortController;try{let s=await D({signal:e.signal});t(s.status),n(s.active),o(!0)}catch(e){(null==e?void 0:e.name)!=="AbortError"&&o(!1)}finally{c(!1)}}};s();let a=setInterval(s,eH);return()=>{clearInterval(a),e&&e.abort()}},[v]),(0,l.useEffect)(()=>{let e=()=>{console.log("Upload started, pausing dashboard polling"),b(!0)},t=()=>{console.log("Upload ended, resuming dashboard polling"),b(!1)};return window.addEventListener("uploadStart",e),window.addEventListener("uploadEnd",t),()=>{window.removeEventListener("uploadStart",e),window.removeEventListener("uploadEnd",t)}},[]);let j=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f(e=>e+1),e.dataTransfer.items&&e.dataTransfer.items.length>0&&u(!0)},[]),y=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f(e=>{let t=e-1;return 0===t&&u(!1),t})},[]),N=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),w=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),u(!1),f(0);let t=Array.from(e.dataTransfer.files);if(t.length>0){console.log("Drag and drop: ".concat(t.length," files received")),window.dispatchEvent(new CustomEvent("openUploadDialog",{detail:{browse:!1}}));let e=new CustomEvent("globalFileDrop",{detail:{files:t}});window.dispatchEvent(e)}},[]);return(0,a.jsxs)("div",{className:"min-h-screen bg-background ".concat(d?"bg-accent/10 transition-colors":""),onDragEnter:j,onDragLeave:y,onDragOver:N,onDrop:w,children:[(0,a.jsx)("header",{className:"border-b border-border",children:(0,a.jsx)("div",{className:"mx-auto max-w-6xl px-8 py-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h1",{className:"text-3xl font-semibold",children:["LOOP ",(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"v0.1"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full ".concat(r?"bg-green-400":"bg-red-400")}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:r?"Connected":"Offline"})]}),(0,a.jsx)("button",{onClick:()=>g(!0),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Settings"})]})]})})}),(0,a.jsxs)("main",{className:"mx-auto max-w-6xl px-8 py-12",children:[d&&(0,a.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center pointer-events-none",children:(0,a.jsxs)("div",{className:"bg-card border-2 border-dashed border-ring rounded-2xl p-12 text-center shadow-2xl",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"↓"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Drop to upload"}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:["Maximum ",100,"MB per file"]})]})}),i?(0,a.jsx)(W,{}):(0,a.jsx)(V,{activeSlug:null!=s?s:void 0,status:e,onCurrentlyPlayingChange:h})]}),(0,a.jsx)(ea,{status:e,currentlyPlaying:x}),(0,a.jsx)(ez,{}),(0,a.jsx)(eL,{isOpen:p,onClose:()=>g(!1)})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[671,484,441,684,358],()=>t(2857)),_N_E=e.O()}]);