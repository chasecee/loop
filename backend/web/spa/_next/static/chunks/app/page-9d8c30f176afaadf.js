(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1886:(e,t,n)=>{"use strict";n.d(t,{A4:()=>F,BS:()=>p,Id:()=>C,KG:()=>P,Px:()=>U,QQ:()=>I,S:()=>j,UB:()=>A,Uk:()=>D,Ux:()=>E,Xf:()=>S,YB:()=>y,ZW:()=>T,Zs:()=>k,eW:()=>w,forceStopProgress:()=>N,hR:()=>g,ij:()=>v,jq:()=>x,sd:()=>b,w8:()=>f});var a=n(6671);let s="/api";class o{set(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;this.cache.set(e,{data:t,timestamp:Date.now(),ttl:n})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}invalidate(e){this.cache.delete(e)}clear(){this.cache.clear()}constructor(){this.cache=new Map}}let r=new o;async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,a=Error("No attempts made");for(let i=0;i<=t;i++)try{return await e()}catch(l){var s,o,r;if(a=l,!((null===(s=l.message)||void 0===s?void 0:s.includes("503"))||(null===(o=l.message)||void 0===o?void 0:o.includes("Service Unavailable"))||(null===(r=l.message)||void 0===r?void 0:r.includes("Failed to fetch"))||"AbortError"===l.name)||i===t)throw l;let e=n*Math.pow(2,i)+500*Math.random();console.log("API retry ".concat(i+1,"/").concat(t," after ").concat(e,"ms: ").concat(l.message)),await new Promise(t=>setTimeout(t,e))}throw a}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=()=>fetch(e,t);return n?a():i(a)}async function c(e){if(!e.ok){let t;try{let n=e.headers.get("content-type");if(n&&n.includes("application/json")){let n=await e.json();t=n.message||n.error||"HTTP ".concat(e.status)}else t=await e.text()}catch(n){t="HTTP ".concat(e.status,": ").concat(e.statusText)}throw Error(t)}let t=e.headers.get("content-type");if(t&&t.includes("application/json"))return e.json();throw Error("Expected JSON response but received HTML")}function d(e){if(!e.success)throw Error(e.message||"API request failed");return e.data}class u{async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(await l("".concat(this.baseUrl).concat(e),{...t,method:"GET"}))}async post(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={...n,method:"POST",headers:{"Content-Type":"application/json",...n.headers}};return t&&(a.body=t instanceof FormData?t:JSON.stringify(t),t instanceof FormData&&a.headers&&delete a.headers["Content-Type"]),c(await l("".concat(this.baseUrl).concat(e),a))}async put(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(await l("".concat(this.baseUrl).concat(e),{...n,method:"PUT",headers:{"Content-Type":"application/json",...n.headers},body:t?JSON.stringify(t):void 0}))}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(await l("".concat(this.baseUrl).concat(e),{...t,method:"DELETE"}))}async upload(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(await l("".concat(this.baseUrl).concat(e),{...n,method:"POST",body:t},!0))}constructor(e=s){this.baseUrl=e}}let m=new u;function h(e,t,n){return a.o.promise(e,{loading:t,success:n||"Operation completed",error:e=>"Error: ".concat(e.message)}),e}async function p(e){return(await T(e)).status}async function f(e){let t=h(m.delete("/media/".concat(e)).then(d),"Deleting media...","Media deleted");return D(),t}async function g(e){let t=h(m.post("/loop",{slug:e}).then(d),"Adding to loop...","Added to loop");return D(),t}async function x(e){let t=h(m.delete("/loop/".concat(e)).then(d),"Removing from loop...","Removed from loop");return D(),t}async function v(e){let t=h(m.put("/loop",{loop:e}).then(d),"Saving order…","Loop order saved");return D(),t}async function b(){return h(m.post("/playback/toggle").then(d),"Toggling playback...")}async function y(){return h(m.post("/playback/next").then(d),"Skipping to next...")}async function w(){return h(m.post("/playback/previous").then(d),"Skipping to previous...")}async function j(){return h(m.post("/playback/loop-mode").then(d),"Toggling loop mode...")}async function N(){return m.post("/playback/force-stop-progress").then(d)}async function S(){return d(await h(m.get("/wifi/scan"),"Scanning for networks...","Networks found"))}async function k(e,t){return h(m.post("/wifi/connect",{ssid:e,password:t}).then(d),"Connecting to ".concat(e,"..."),"Connected to ".concat(e))}async function C(){return h(m.post("/wifi/hotspot").then(d),"Toggling hotspot...")}async function A(e){return m.get("/dashboard/storage",e)}async function E(){return d(await h(m.get("/updates/check"),"Checking for updates..."))}async function U(){return h(m.post("/updates/install").then(d),"Installing update...","Update installed successfully")}async function T(e){if(!(null==e?void 0:e.signal)&&_)return console.log("Dashboard request already in flight, returning existing promise"),_;if(_&&!(null==e?void 0:e.signal))return _;console.log("Starting new dashboard request");let t=Date.now(),n=m.get("/dashboard",{...e,signal:(null==e?void 0:e.signal)||AbortSignal.timeout(6e4)}).finally(()=>{let e=Date.now()-t;console.log("Dashboard request completed in ".concat(e,"ms")),_=null});_=n;try{return await n}catch(e){throw _=null,e}}function D(){r.invalidate("dashboard")}async function F(e){return h(m.post("/display/brightness",e).then(d),"Applying display settings…","Display updated")}async function I(){return d(await m.get("/display/brightness"))}let _=null;async function P(e,t,n){console.log("Starting upload of processed media: ".concat(t));let a=e instanceof FormData?e:(()=>{let n=new FormData;return n.append("files",e,t),n})(),o=new XMLHttpRequest;return new Promise((e,r)=>{o.open("POST","".concat(s,"/media")),console.log("XHR request opened for ".concat(t)),o.onload=()=>{var n;if(console.log("XHR onload fired for ".concat(t,": status ").concat(o.status,", readyState ").concat(o.readyState)),console.log("Response received: ".concat((null===(n=o.responseText)||void 0===n?void 0:n.length)||0," bytes")),o.status>=200&&o.status<300)try{let n=JSON.parse(o.responseText||"{}");console.log("Upload successful for ".concat(t,":"),n),e(d(n))}catch(e){console.error("Failed to parse response for ".concat(t,":"),e),console.error("Raw response: ".concat(o.responseText)),r(Error("Invalid response format: ".concat(e)))}else console.error("Upload failed for ".concat(t,": HTTP ").concat(o.status)),console.error("Error response: ".concat(o.responseText)),r(Error("Upload failed: HTTP ".concat(o.status)))},o.onerror=e=>{console.error("XHR error for ".concat(t,":"),e),console.error("XHR state: status=".concat(o.status,", readyState=").concat(o.readyState)),r(Error("Network error during upload"))},o.onabort=()=>{console.warn("XHR aborted for ".concat(t)),r(Error("Upload aborted"))},o.ontimeout=()=>{console.error("XHR timeout for ".concat(t)),r(Error("Upload timeout"))},o.upload&&n&&(o.upload.onloadstart=()=>{console.log("Upload started for ".concat(t))},o.upload.onprogress=e=>{if(e.lengthComputable){let a=e.loaded/e.total;console.log("Upload progress for ".concat(t,": ").concat((100*a).toFixed(1),"% (").concat(e.loaded,"/").concat(e.total," bytes)")),n(a)}else console.log("Upload progress for ".concat(t,": ").concat(e.loaded," bytes (total unknown)"))},o.upload.onload=()=>{console.log("File transfer complete for ".concat(t," - backend processing starting..."))},o.upload.onerror=e=>{console.error("Upload error for ".concat(t,":"),e)},o.upload.onabort=()=>{console.warn("Upload aborted for ".concat(t))},o.upload.ontimeout=()=>{console.error("Upload timeout for ".concat(t))}),o.timeout=9e5,console.log("Sending XHR request for ".concat(t,"..."));try{o.send(a),console.log("XHR send() called for ".concat(t))}catch(e){console.error("Failed to send XHR for ".concat(t,":"),e),r(e)}})}},2857:(e,t,n)=>{Promise.resolve().then(n.bind(n,3236))},3236:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ep});var a=n(5155),s=n(2115),o=n(5863),r=n(2596),i=n(9688);function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,i.QP)((0,r.$)(t))}let c=s.forwardRef((e,t)=>{let{className:n,value:s,...r}=e;return(0,a.jsx)(o.bL,{ref:t,className:l("relative h-4 w-full overflow-hidden rounded-full bg-secondary",n),...r,children:(0,a.jsx)(o.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})});c.displayName=o.bL.displayName;var d=n(646),u=n(4861),m=n(4186),h=n(9869),p=n(9890),f=n(1886),g=n(6671);let x=new Map;function v(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(x.has(e))return;let s=g.o[t](n,{...a,onDismiss(){x.delete(e),"function"==typeof a.onDismiss&&a.onDismiss()}});x.set(e,s)}var b=n(5604);function y(e){let{onUploadComplete:t,trigger:n}=e,o=(0,s.useRef)(null);(0,s.useEffect)(()=>{n&&o.current&&o.current.click()},[n]);let r=(0,s.useCallback)(async e=>{var n;if(!(null===(n=e.target.files)||void 0===n?void 0:n.length))return;let a=Array.from(e.target.files);if(a.filter(e=>e.size>0x6400000).length){v("upload-filesize","error","Files too large. Maximum 100MB");return}for(let e of a)try{if(!b.uploadCoordinator){console.error("Upload coordinator not available");continue}let t=await b.uploadCoordinator.startUpload(e);console.log("\uD83D\uDE80 Started upload transaction: ".concat(t," for ").concat(e.name))}catch(t){console.error("Failed to start upload for ".concat(e.name,":"),t),v("upload-error-".concat(e.name),"error","Upload failed: ".concat(e.name))}t&&t(),e.target.value=""},[t]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("input",{ref:o,type:"file",multiple:!0,accept:"image/*,video/*,.gif,.mov,.m4v,.heic,.heif",onChange:r,className:"hidden"})})}var w=n(5143),j=n(402),N=n(8266);function S(e){let{src:t,alt:n,className:o,placeholder:r="/placeholder.svg"}=e,[i,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),u=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=new IntersectionObserver(t=>{let[n]=t;n.isIntersecting&&(d(!0),e.disconnect())},{rootMargin:"50px",threshold:.1});return u.current&&e.observe(u.current),()=>e.disconnect()},[]),(0,a.jsx)("img",{ref:u,src:c?t:r,alt:n,className:"".concat(o," ").concat(!i&&c?"opacity-50":"opacity-100"," transition-opacity duration-300"),onLoad:()=>l(!0),loading:"lazy"})}function k(e){let{item:t,isActive:n,isInLoop:s,onDelete:o,onAddToLoop:r,onRemove:i}=e,{attributes:l,listeners:c,setNodeRef:d,transform:u,transition:m,isDragging:h}=(0,j.gl)({id:t.slug}),p={transform:N.Ks.Transform.toString(u),transition:m,opacity:h?.5:1};return(0,a.jsxs)("div",{ref:d,style:p,className:"group flex items-center gap-8 p-8 transition-all ".concat(n?"bg-accent":"hover:bg-accent/30"),children:[(0,a.jsx)("div",{...l,...c,className:"cursor-grab active:cursor-grabbing opacity-30 hover:opacity-100 transition-opacity",children:(0,a.jsxs)("div",{className:"w-5 h-5 flex flex-col gap-1",children:[(0,a.jsx)("div",{className:"w-full h-0.5 bg-current rounded"}),(0,a.jsx)("div",{className:"w-full h-0.5 bg-current rounded"}),(0,a.jsx)("div",{className:"w-full h-0.5 bg-current rounded"})]})}),(0,a.jsx)("div",{className:"w-32 aspect-[32/24] rounded-2xl overflow-hidden bg-muted flex-shrink-0 ".concat(s?"":"opacity-40 grayscale"),children:t.url&&t.type.startsWith("image/")?(0,a.jsx)(S,{src:t.url,alt:t.filename,className:"w-full h-full object-cover ".concat("processing"===t.processing_status?"animate-pulse":"")}):t.url&&t.type.startsWith("video/")?(0,a.jsx)("video",{src:t.url,muted:!0,loop:!0,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover ".concat("processing"===t.processing_status?"animate-pulse":"")}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"□"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"flex items-center gap-4 mb-2",children:(0,a.jsx)("h4",{className:"font-semibold text-lg truncate",children:t.filename})}),(0,a.jsxs)("div",{className:"flex items-center gap-8 text-sm text-muted-foreground",children:[(0,a.jsxs)("span",{children:[(t.size/1024/1024).toFixed(1)," MB"]}),(0,a.jsx)("span",{children:new Date(t.uploadedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),t.duration&&(0,a.jsxs)("span",{children:[t.duration,"s"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity",children:["processing"===t.processing_status?(0,a.jsx)("div",{className:"px-3 py-1 rounded-full text-xs font-medium bg-blue-500 text-white",children:"Processing..."}):(0,a.jsx)("button",{onClick:()=>s?i(t.slug):r(t),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors ".concat(s?"bg-green-400 text-black hover:bg-green-500":"bg-muted text-muted-foreground hover:bg-accent"),title:s?"Disable":"Enable",children:s?"Active":"Inactive"}),(0,a.jsx)("button",{onClick:()=>o(t.slug),className:"h-12 w-12 rounded-xl hover:bg-destructive hover:text-white flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lg",children:"\xd7"})})]})]})}function C(e){let t=new Map;for(let n of e){let e=t.get(n.filename);if(!e){t.set(n.filename,n);continue}let a=e=>{switch(e){case"completed":return 3;case"processing":return 2;case"uploaded":return 1;default:return 0}};a(n.processing_status)>a(e.processing_status)&&t.set(n.filename,n)}return Array.from(t.values())}function A(e,t){let n=new Set(t.map(e=>e.filename)),a=new Set(t.map(e=>e.filename.replace(/\.[^.]+$/,"").toLowerCase()));return Array.from(e.values()).filter(e=>{if("error"===e.transaction.state)return!0;if("complete"===e.transaction.state){let t=e.transaction.filename,s=t.replace(/\.[^.]+$/,"").toLowerCase();if(n.has(t)||a.has(s))return!1;for(let e of a)if(t.toLowerCase().includes(e))return!1}return"complete"!==e.transaction.state})}function E(e){let{progress:t}=e,{transaction:n}=t;return(0,a.jsxs)("div",{className:"group flex items-center gap-8 p-8 bg-accent/20 transition-all",children:[(0,a.jsx)("div",{className:"w-5 h-5 opacity-30",children:(0,a.jsx)(h.A,{className:"w-full h-full"})}),(0,a.jsx)("div",{className:"w-32 aspect-[32/24] rounded-2xl overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:(0,a.jsx)(p.A,{className:"h-8 w-8 text-muted-foreground"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-lg truncate",children:n.filename}),(()=>{switch(n.state){case"complete":return(0,a.jsx)(d.A,{className:"h-4 w-4 text-green-500"});case"error":return(0,a.jsx)(u.A,{className:"h-4 w-4 text-red-500"});default:return(0,a.jsx)(m.A,{className:"h-4 w-4 text-blue-500 animate-spin"})}})()]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:(()=>{switch(n.state){case"pending":return"Queued...";case"processing":default:return t.message||n.stage||"Processing...";case"uploading":return"Uploading files...";case"finalizing":return"Processing on device...";case"complete":return"Complete";case"error":return n.error||"Error"}})()}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[Math.round(n.progress),"%"]})]}),(0,a.jsx)(c,{value:n.progress,className:"h-2 w-full max-w-xs"})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)("div",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat((()=>{switch(n.state){case"complete":return"bg-green-400 text-black";case"error":return"bg-red-400 text-white";case"finalizing":return"bg-purple-400 text-black";default:return"bg-blue-400 text-black"}})()),children:(()=>{switch(n.state){case"processing":return"Converting";case"uploading":return"Uploading";case"finalizing":return"Finalizing";case"complete":return"Complete";case"error":return"Error";default:return"Processing"}})()})})]})}function U(e){var t,o,r;let{dashboardData:i,onCurrentlyPlayingChange:l}=e,[c,d]=(0,s.useState)([]),[u,m]=(0,s.useState)([]),[p,g]=(0,s.useState)(0),[x,b]=(0,s.useState)(!1),[N,S]=(0,s.useState)(new Map);(0,s.useEffect)(()=>{Promise.resolve().then(n.bind(n,5604)).then(e=>{let{uploadCoordinator:t}=e;if(t)return t.onProgress(e=>{S(t=>{let n=new Map(t);return("complete"===e.transaction.state||"error"===e.transaction.state)&&setTimeout(()=>{S(t=>{let n=new Map(t);return n.delete(e.transaction.id),n})},"complete"===e.transaction.state?1e3:3e3),n.set(e.transaction.id,e),n})})})},[]);let U=(0,w.FR)((0,w.MS)(w.AN),(0,w.MS)(w.uN,{coordinateGetter:j.JR}));(0,s.useEffect)(()=>{var e,t;if(!i)return;let n=C(null!==(e=i.media)&&void 0!==e?e:[]),a=(null!==(t=i.loop)&&void 0!==t?t:[]).map(e=>n.find(t=>t.slug===e)).filter(Boolean);if(d(n),m(a),i.active){let e=a.findIndex(e=>e.slug===i.active);-1!==e&&g(e)}},[i]),(0,s.useEffect)(()=>{let e=()=>{(0,f.Uk)(),(0,f.ZW)().then(e=>{var t,n;let a=C(null!==(t=e.media)&&void 0!==t?t:[]);d(a);let s=(null!==(n=e.loop)&&void 0!==n?n:[]).map(e=>a.find(t=>t.slug===e)).filter(Boolean);if(m(s),e.active){let t=s.findIndex(t=>t.slug===e.active);-1!==t&&g(t)}}).catch(console.error)};return window.addEventListener("mediaUploaded",e),()=>{window.removeEventListener("mediaUploaded",e)}},[]),(0,s.useEffect)(()=>{var e,t;if((null==i?void 0:null===(t=i.status)||void 0===t?void 0:null===(e=t.player)||void 0===e?void 0:e.is_playing)&&u.length>0){let e=setInterval(()=>{g(e=>(e+1)%u.length)},8e3);return()=>clearInterval(e)}},[null==i?void 0:null===(o=i.status)||void 0===o?void 0:null===(t=o.player)||void 0===t?void 0:t.is_playing,u.length]),(0,s.useEffect)(()=>{l(u.length>0?u[p]:null)},[u,p,l]);let T=async e=>{try{var t,n;await (0,f.jq)(e);let a=await (0,f.ZW)(),s=C(null!==(t=a.media)&&void 0!==t?t:[]),o=(null!==(n=a.loop)&&void 0!==n?n:[]).map(e=>s.find(t=>t.slug===e)).filter(Boolean);if(d(s),m(o),a.active){let e=o.findIndex(e=>e.slug===a.active);-1!==e&&g(e)}else g(0)}catch(e){v("media-remove-fail","error","Failed to remove from loop")}},D=async e=>{try{var t,n;await (0,f.w8)(e);let a=await (0,f.ZW)(),s=C(null!==(t=a.media)&&void 0!==t?t:[]),o=(null!==(n=a.loop)&&void 0!==n?n:[]).map(e=>s.find(t=>t.slug===e)).filter(Boolean);if(d(s),m(o),a.active&&o.length>0){let e=o.findIndex(e=>e.slug===a.active);-1!==e?g(e):g(0)}else g(0)}catch(e){v("media-delete-fail","error","Failed to delete media")}},F=async e=>{try{var t,n;await (0,f.hR)(e.slug);let a=await (0,f.ZW)(),s=C(null!==(t=a.media)&&void 0!==t?t:[]),o=(null!==(n=a.loop)&&void 0!==n?n:[]).map(e=>s.find(t=>t.slug===e)).filter(Boolean);if(d(s),m(o),a.active){let e=o.findIndex(e=>e.slug===a.active);-1!==e&&g(e)}}catch(e){v("media-add-fail","error","Failed to add to loop")}},I=u.map(e=>e.slug),_=u.length>0?null===(r=u[p])||void 0===r?void 0:r.slug:i.active;return(0,a.jsxs)("div",{className:" pb-16",children:[(0,a.jsx)(y,{onUploadComplete:()=>{(0,f.Uk)()},trigger:x}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-12 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Loop Library"}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:[c.length," items",(()=>{let e=A(N,c);return e.length>0?" • ".concat(e.length," uploading"):""})()]})]}),(0,a.jsxs)("button",{onClick:()=>{b(!x)},className:"flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-2xl hover:bg-primary/90 transition-colors",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),"Upload Media"]})]}),0===c.length&&0===A(N,c).length?(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-32 text-center",children:[(0,a.jsx)("div",{className:"text-8xl mb-8",children:"□"}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"No media"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Upload files to get started"})]}):(0,a.jsx)("div",{className:"rounded-3xl bg-card overflow-hidden",children:(0,a.jsxs)("div",{className:"divide-y divide-border",children:[A(N,c).map(e=>(0,a.jsx)(E,{progress:e},e.transaction.id)),c.length>0&&(0,a.jsx)(w.Mp,{sensors:U,collisionDetection:w.fp,onDragEnd:e=>{let{active:t,over:n}=e;n&&t.id!==n.id&&d(e=>{let a=e.findIndex(e=>e.slug===t.id),s=e.findIndex(e=>e.slug===n.id),o=(0,j.be)(e,a,s),r=new Set(u.map(e=>e.slug)),i=o.filter(e=>r.has(e.slug)).map(e=>e.slug);return(0,f.ij)(i).catch(console.error),o})},children:(0,a.jsx)(j.gB,{items:c.map(e=>e.slug),strategy:j._G,children:c.map(e=>(0,a.jsx)(k,{item:e,isActive:e.slug===_,isInLoop:I.includes(e.slug),onDelete:D,onAddToLoop:F,onRemove:T},e.slug))})})]})})]})]})}class T{connect(){var e;if((null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN){console.log("WebSocket already connected");return}this.connectionState="connecting",this.notifyStateChange();try{let e;let t="https:"===window.location.protocol?"wss:":"ws:";e="".concat(t,"//").concat(window.location.host,"/ws"),0===this.reconnectAttempts&&console.log("Connecting to WebSocket:",e),this.ws=new WebSocket(e),this.ws.onopen=this.handleOpen.bind(this),this.ws.onmessage=this.handleMessage.bind(this),this.ws.onclose=this.handleClose.bind(this),this.ws.onerror=this.handleError.bind(this)}catch(e){console.warn("Failed to create WebSocket connection:",e),this.connectionState="connecting",this.notifyStateChange(),this.scheduleReconnect()}}disconnect(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.ws&&(this.ws.close(),this.ws=null),this.connectionState="disconnected",this.connectionId=null,this.notifyStateChange()}subscribe(e){if("connected"!==this.connectionState||!this.ws){console.warn("Cannot subscribe to ".concat(e,": not connected"));return}this.subscribedRooms.add(e),this.send({type:"subscribe",room:e})}unsubscribe(e){"connected"===this.connectionState&&this.ws&&(this.subscribedRooms.delete(e),this.send({type:"unsubscribe",room:e}))}on(e,t){let n=this.listeners.get(e);return n&&n.add(t),()=>{let n=this.listeners.get(e);n&&n.delete(t)}}off(e,t){let n=this.listeners.get(e);n&&n.delete(t)}getConnectionState(){return this.connectionState}getConnectionId(){return this.connectionId}send(e){var t;(null===(t=this.ws)||void 0===t?void 0:t.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("Cannot send message: WebSocket not connected",e)}handleOpen(){console.log("WebSocket connected successfully"),this.connectionState="connected",this.reconnectAttempts=0,this.reconnectDelay=1e3,this.notifyStateChange(),this.startPing()}handleMessage(e){try{let t=JSON.parse(e.data);if("connection"===t.type){let e=t.data;this.connectionId=(null==e?void 0:e.connection_id)||null,this.connectionId?console.log("WebSocket connection confirmed:",this.connectionId):console.log("WebSocket connection confirmed"),this.subscribedRooms.forEach(e=>{this.send({type:"subscribe",room:e})})}this.emit(t.type,t)}catch(t){console.error("Failed to parse WebSocket message:",t,e.data)}}handleClose(e){1e3!==e.code&&1001!==e.code&&console.log("WebSocket connection closed:",e.code,e.reason),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),1e3!==e.code?(this.connectionState="connecting",this.scheduleReconnect()):this.connectionState="disconnected",this.connectionId=null,this.notifyStateChange()}handleError(){this.reconnectAttempts<3?console.log("WebSocket connection issue, retrying..."):console.warn("WebSocket connection problems after multiple attempts"),this.connectionState="connecting",this.notifyStateChange()}emit(e,t){let n=this.listeners.get(e);n&&n.forEach(n=>{try{n(t)}catch(t){console.error("Error in WebSocket event listener for ".concat(e,":"),t)}})}notifyStateChange(){this.emit("connection",{type:"connection",data:{state:this.connectionState,connectionId:this.connectionId}})}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.warn("Max WebSocket reconnection attempts reached. Connection lost."),this.connectionState="error",this.notifyStateChange();return}this.reconnectAttempts++;let e=Math.min(this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.maxReconnectDelay);this.reconnectAttempts>2&&console.log("Reconnecting to WebSocket (attempt ".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{"connected"!==this.connectionState&&this.connect()},e)}startPing(){this.pingInterval&&clearInterval(this.pingInterval),this.pingInterval=setInterval(()=>{"connected"===this.connectionState&&this.send({type:"ping"})},3e4)}constructor(){this.ws=null,this.connectionState="disconnected",this.listeners=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.maxReconnectDelay=3e4,this.pingInterval=null,this.connectionId=null,this.subscribedRooms=new Set,["connection","initial_dashboard","dashboard_update","media_uploaded","media_deleted","loop_updated","playback_changed","wifi_status_changed","system_status_changed","upload_progress","error","subscribe_response","unsubscribe_response","pong"].forEach(e=>{this.listeners.set(e,new Set)})}}let D=new T;function F(){return(0,s.useEffect)(()=>D.on("initial_dashboard",e=>{var t,n;let a=e.data;console.log("initial_dashboard media length =",null==a?void 0:null===(t=a.media)||void 0===t?void 0:t.length,null==a?void 0:null===(n=a.media)||void 0===n?void 0:n.slice(0,2))}),[]),(0,a.jsx)("div",{className:"space-y-16 pb-16",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-12",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Loop Library"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]}),(0,a.jsx)("div",{className:"rounded-3xl bg-muted/20 py-32 text-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Connecting to LOOP..."})]})})]})})}D.connect(),window.addEventListener("focus",()=>{"disconnected"===D.getConnectionState()&&D.connect()});var I=n(184);let _=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(I.bL,{className:l("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",n),...s,ref:t,children:(0,a.jsx)(I.zi,{className:l("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});function P(e){var t,n,s;let{status:o,currentlyPlaying:r}=e,i=async()=>{try{await (0,f.sd)()}catch(e){v("playback-toggle-fail","error","Failed to toggle playback")}},l=async()=>{try{await (0,f.S)()}catch(e){v("loopmode-fail","error","Failed to toggle loop mode")}};return(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-black border-t border-gray-800",children:(0,a.jsx)("div",{className:"mx-auto max-w-6xl px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-800 flex-shrink-0",children:(null==r?void 0:r.url)&&r.type.startsWith("image/")?(0,a.jsx)("img",{src:r.url||"/placeholder.svg",alt:r.filename,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"□"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"text-white text-sm font-medium truncate",children:r?r.filename:"No media in loop"}),(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:r?"Now Playing":"Add media to start"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs text-gray-400",children:(null==o?void 0:null===(t=o.player)||void 0===t?void 0:t.loop_mode)==="all"?"Loop All":"Loop One"}),(0,a.jsx)(_,{checked:(null==o?void 0:null===(n=o.player)||void 0===n?void 0:n.loop_mode)==="all",onCheckedChange:l,className:"data-[state=checked]:bg-green-400 data-[state=unchecked]:bg-gray-600"})]}),(0,a.jsx)("button",{onClick:i,className:"h-10 w-10 rounded-full bg-white text-black hover:bg-gray-100 transition-colors flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lg",children:(null==o?void 0:null===(s=o.player)||void 0===s?void 0:s.is_playing)?"⏸":"▶"})})]})]})})})}_.displayName=I.bL.displayName;var L=n(1189),M=n(4416);let R=L.bL,z=L.l9,W=L.ZL;L.bm;let B=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(L.hJ,{ref:t,className:l("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...s})});B.displayName=L.hJ.displayName;let O=s.forwardRef((e,t)=>{let{className:n,children:s,...o}=e;return(0,a.jsxs)(W,{children:[(0,a.jsx)(B,{}),(0,a.jsxs)(L.UC,{ref:t,className:l("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...o,children:[s,(0,a.jsxs)(L.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(M.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});O.displayName=L.UC.displayName;let H=e=>{let{className:t,...n}=e;return(0,a.jsx)("div",{className:l("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};H.displayName="DialogHeader";let X=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(L.hE,{ref:t,className:l("text-lg font-semibold leading-none tracking-tight",n),...s})});X.displayName=L.hE.displayName,s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(L.VY,{ref:t,className:l("text-sm text-muted-foreground",n),...s})}).displayName=L.VY.displayName;var q=n(9708),G=n(2085);let J=(0,G.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Q=s.forwardRef((e,t)=>{let{className:n,variant:s,size:o,asChild:r=!1,...i}=e,c=r?q.DX:"button";return(0,a.jsx)(c,{className:l(J({variant:s,size:o,className:n})),ref:t,...i})});Q.displayName="Button";let V=(0,G.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Z(e){let{className:t,variant:n,...s}=e;return(0,a.jsx)("div",{className:l(V({variant:n}),t),...s})}let $=s.forwardRef((e,t)=>{let{className:n,type:s,...o}=e;return(0,a.jsx)("input",{type:s,className:l("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...o})});$.displayName="Input";var K=n(968);let Y=(0,G.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ee=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(K.b,{ref:t,className:l(Y(),n),...s})});ee.displayName=K.b.displayName;var et=n(2652),en=n(6517),ea=n(4449),es=n(2919);function eo(){let[e,t]=(0,s.useState)([]),[n,o]=(0,s.useState)(!1),[r,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(""),[m,h]=(0,s.useState)({connected:!1,ssid:"",hotspotActive:!1});(0,s.useEffect)(()=>{let e=async()=>{try{let e=await (0,f.BS)();(null==e?void 0:e.wifi)&&h({connected:!!e.wifi.connected,ssid:e.wifi.current_ssid||"",hotspotActive:!!e.wifi.hotspot_active})}catch(e){}};e();let t=setInterval(e,5e3);return()=>clearInterval(t)},[]);let p=async()=>{o(!0);try{let e=await (0,f.Xf)();t(e.networks),v("wifi-scan-ok","success","Found ".concat(e.networks.length," networks"))}catch(e){v("wifi-scan-err","error","Failed to scan for networks")}finally{o(!1)}},g=async()=>{if(l){i(!0);try{await (0,f.Zs)(l.ssid,d),v("wifi-connect","success","Connected to ".concat(l.ssid)),h(e=>({...e,connected:!0,ssid:l.ssid})),c(null),u("")}catch(e){v("wifi-connect-fail","error","Failed to connect to network")}finally{i(!1)}}},x=async()=>{try{await (0,f.Id)();let e=!m.hotspotActive;h(t=>({...t,hotspotActive:e})),v("hotspot-toggle","success",e?"Hotspot enabled":"Hotspot disabled")}catch(e){v("hotspot-err","error","Failed to toggle hotspot")}},b=e=>e>75?(0,a.jsx)(et.A,{className:"h-4 w-4"}):e>50?(0,a.jsx)(et.A,{className:"h-4 w-4 opacity-75"}):e>25?(0,a.jsx)(et.A,{className:"h-4 w-4 opacity-50"}):(0,a.jsx)(et.A,{className:"h-4 w-4 opacity-25"});return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8 space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"WiFi Configuration"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[m.connected?(0,a.jsx)(en.A,{className:"h-5 w-5 text-green-500"}):(0,a.jsx)(ea.A,{className:"h-5 w-5 text-red-500"}),(0,a.jsx)("span",{className:"font-medium",children:m.connected?'Connected to "'.concat(m.ssid,'"'):"Not connected"})]}),m.hotspotActive&&(0,a.jsx)(Z,{variant:"secondary",children:"Hotspot Active"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(Q,{onClick:p,disabled:n,variant:"outline",children:n?"Scanning...":"Scan for Networks"}),(0,a.jsx)(Q,{onClick:x,variant:m.hotspotActive?"destructive":"outline",children:m.hotspotActive?"Disable Hotspot":"Enable Hotspot"})]}),e.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Available Networks"}),(0,a.jsx)("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:e.map(e=>(0,a.jsxs)(R,{children:[(0,a.jsx)(z,{asChild:!0,children:(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg cursor-pointer hover:bg-accent",onClick:()=>c(e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"font-medium",children:e.ssid}),e.secured&&(0,a.jsx)(es.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[b(e.signal),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.signal,"%"]})]})]})}),(0,a.jsxs)(O,{children:[(0,a.jsx)(H,{children:(0,a.jsxs)(X,{children:["Connect to ",e.ssid]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[e.secured&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee,{htmlFor:"password",children:"Password"}),(0,a.jsx)($,{id:"password",type:"password",value:d,onChange:e=>u(e.target.value),placeholder:"Enter network password"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(Q,{variant:"outline",onClick:()=>c(null),children:"Cancel"}),(0,a.jsx)(Q,{onClick:g,disabled:r||e.secured&&!d,children:r?"Connecting...":"Connect"})]})]})]})]},e.ssid))})]})]})}var er=n(1788);function ei(){let[e]=(0,s.useState)("1.0.0"),[t,n]=(0,s.useState)(null),[o,r]=(0,s.useState)(!1),[i,l]=(0,s.useState)(!1),c=async()=>{r(!0);try{(await (0,f.Ux)()).updates_available.git?(n("Available"),v("update-avail","success","Git update available")):v("update-none","info","System is up to date")}catch(e){v("update-check-fail","error","Failed to check for updates")}finally{r(!1)}},u=async()=>{if(t){l(!0);try{await (0,f.Px)(),v("update-installed","success","Update installed - device will restart"),n(null)}catch(e){v("update-install-fail","error","Failed to install update")}finally{l(!1)}}};return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8 space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"System & Updates"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.A,{className:"h-5 w-5 text-green-500"}),(0,a.jsx)("span",{className:"font-medium",children:"Current Version"})]}),(0,a.jsx)(Z,{variant:"outline",children:e})]}),t&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-primary/5 border border-primary/20 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(er.A,{className:"h-5 w-5 text-primary"}),(0,a.jsx)("span",{className:"font-medium",children:"Update Available"})]}),(0,a.jsx)(Z,{children:t})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(Q,{onClick:c,disabled:o,variant:"outline",children:o?"Checking...":"Check for Updates"}),(0,a.jsx)(Q,{onClick:u,disabled:!t||i,children:i?"Installing...":"Install Update"})]}),t&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground p-3 bg-muted rounded-lg",children:[(0,a.jsx)("strong",{children:"Note:"})," The device will automatically restart after the update is installed. Make sure no critical operations are running."]})]})}function el(e){let t,{storage:n}=e;if(!n)return(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Storage"}),(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading storage info…"})]})]});let s=e=>0===e?"0 GB":"".concat((e/0x40000000).toFixed(1)," GB"),o=n.system/n.total*100,r=n.app/n.total*100,i=n.media/n.total*100;return n.free,n.total,(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Storage"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total Usage"}),(0,a.jsxs)("span",{className:"font-medium",children:[s(n.used)," / ",s(n.total)]})]}),(0,a.jsx)("div",{className:"w-full bg-muted/20 rounded-full h-3 overflow-hidden",children:(0,a.jsxs)("div",{className:"h-full flex",children:[(0,a.jsx)("div",{className:"bg-red-500 transition-all duration-300",style:{width:"".concat(o,"%")}}),(0,a.jsx)("div",{className:"bg-blue-500 transition-all duration-300",style:{width:"".concat(r,"%")}}),(0,a.jsx)("div",{className:"bg-green-500 transition-all duration-300",style:{width:"".concat(i,"%")}})]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"System"})]}),(0,a.jsx)("span",{className:"font-medium",children:s(n.system)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"App"})]}),(0,a.jsx)("span",{className:"font-medium",children:s(n.app)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Media"})]}),(0,a.jsx)("span",{className:"font-medium",children:s(n.media)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-muted/20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-muted/40"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Available"})]}),(0,a.jsx)("span",{className:"font-medium text-green-600",children:s(n.free)})]})]})]})]})}var ec=n(8018);let ed=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsxs)(ec.bL,{ref:t,className:l("relative flex w-full touch-none select-none items-center",n),...s,children:[(0,a.jsx)(ec.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-muted-foreground/50",children:(0,a.jsx)(ec.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(ec.zi,{className:"block h-8 w-8 rounded-full border-[3px] border-primary bg-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});function eu(){let[e,t]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{let{brightness:e}=await (0,f.QQ)();t("number"==typeof e?e:100)}catch(e){console.error("Failed to fetch brightness",e)}})()},[]);let n=async()=>{if(null!==e)try{await (0,f.A4)({brightness:e}),v("display-set","success","Brightness set to ".concat(e,"%"))}catch(e){v("brightness-err","error",e.message||"Failed to set brightness")}};return null===e?(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Display Settings"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Brightness"}),(0,a.jsxs)("div",{className:"rounded-3xl bg-muted/20 py-24 text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-muted rounded-full animate-spin border-t-primary mx-auto mb-6"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading brightness…"})]})]})]}):(0,a.jsxs)("div",{className:"rounded-3xl bg-card p-8",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-8",children:"Display Settings"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Brightness"}),(0,a.jsx)(ed,{min:0,max:100,value:[e],onValueChange:e=>t(e[0]),onValueCommit:()=>n()}),(0,a.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:[e,"%"]})]})]})}function em(e){let{isOpen:t,onClose:n}=e,[o,r]=(0,s.useState)(null),[i,l]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{if(!t){r(null);return}(async()=>{l(!0);try{let e=await (0,f.UB)();r(e)}catch(e){console.error("Failed to fetch storage info:",e)}finally{l(!1)}})()},[t]),(0,a.jsx)(R,{open:t,onOpenChange:n,children:(0,a.jsx)(O,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0",children:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,a.jsx)(X,{className:"text-3xl font-semibold",children:"Settings"})}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)(eu,{}),(0,a.jsx)(el,{storage:i?null:o}),(0,a.jsx)(eo,{}),(0,a.jsx)(ei,{})]})]})})})}function eh(e){let{connectionState:t}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(()=>{switch(t){case"connecting":return(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-yellow-400 animate-pulse"});case"connected":return(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-400"});case"disconnected":default:return(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-gray-400"});case"error":return(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-400 animate-pulse"})}})(),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:(()=>{switch(t){case"connecting":return"Re-connecting…";case"connected":return"Connected";case"disconnected":return"Offline";case"error":return"Connection Lost";default:return"Unknown"}})()})]})}function ep(){var e;let[t,n]=(0,s.useState)(!1),[o,r]=(0,s.useState)(null),{data:i,connectionState:l}=function(){let[e,t]=(0,s.useState)(null),[n,a]=(0,s.useState)("disconnected"),[o,r]=(0,s.useState)(null),[i,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(null),u=(0,s.useCallback)(e=>{console.log("✅ Media uploaded, updating dashboard:",e.data),window.dispatchEvent(new CustomEvent("mediaUploaded",{detail:e.data})),t(t=>{let n;let a=e.data;if(!i||!t)return t;let s=t.media.findIndex(e=>e.slug===(null==a?void 0:a.slug));return s>=0?(n=[...t.media])[s]=a:n=[...t.media,a],{...t,media:n}})},[i]),m=(0,s.useCallback)(e=>{console.log("Media deleted, updating dashboard"),t(t=>{if(t){let n=e.data,a=t.media.filter(e=>e.slug!==(null==n?void 0:n.slug));return{...t,media:a}}return t})},[]),h=(0,s.useCallback)(e=>{console.log("Loop updated via WebSocket"),t(t=>{if(t){let n=e.data;return{...t,loop:(null==n?void 0:n.loop)||[]}}return t})},[]),p=(0,s.useCallback)(e=>{let{bytes_received:t,total_bytes:n,percent:a,filename:s,stage:o,progress:r}=e.data||{};if((void 0!==a||void 0!==r)&&s&&o){let e=void 0!==r?r:a;console.log("\uD83D\uDCCA WebSocket upload progress: ".concat(s," ").concat(e,"% (").concat(o,")")),window.dispatchEvent(new CustomEvent("uploadProgress",{detail:{filename:s,progress:e,percent:e,stage:o}}));return}if("number"==typeof t||"number"==typeof n){let e="number"==typeof a?a:"number"==typeof n&&"number"==typeof t?t/n*100:0;d({filename:"uploading",progress:e,status:e>=100?"finalizing":"uploading"})}},[]);return(0,s.useEffect)(()=>{let e=!0,n=D.on("connection",t=>{if(!e)return;let n=t.data,s=(null==n?void 0:n.state)||((null==n?void 0:n.status)==="connected"?"connected":"disconnected");a(s),"connected"===s&&(r(null),D.subscribe("dashboard"),D.subscribe("progress"))}),s=D.on("initial_dashboard",n=>{e&&(console.log("Received initial dashboard data via WebSocket"),t(n.data),l(!0),r(null))}),o=D.on("dashboard_update",n=>{e&&(console.log("Received dashboard update via WebSocket"),t(n.data),r(null))}),i=D.on("media_uploaded",u),c=D.on("media_deleted",m),d=D.on("loop_updated",h),f=D.on("playback_changed",n=>{e&&(console.log("Playback changed via WebSocket"),t(e=>{let t=n.data;return e&&(null==t?void 0:t.player)?{...e,status:{...e.status,player:t.player}}:e}))}),g=D.on("upload_progress",p),x=D.on("error",t=>{if(!e)return;console.error("WebSocket error:",t.data);let n=t.data;r(Error((null==n?void 0:n.message)||"WebSocket error"))});return a(D.getConnectionState()),"connected"===D.getConnectionState()&&(D.subscribe("dashboard"),D.subscribe("progress")),()=>{e=!1,n(),s(),o(),i(),c(),d(),f(),g(),x(),D.unsubscribe("dashboard"),D.unsubscribe("progress")}},[u,m,h]),{data:e,error:o,connectionState:n,uploadProgress:c,isConnected:"connected"===n,isConnecting:"connecting"===n}}();return(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,a.jsx)("header",{className:"border-b border-border",children:(0,a.jsx)("div",{className:"mx-auto max-w-6xl px-8 py-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h1",{className:"text-3xl font-semibold",children:["LOOP ",(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"v0.1"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-8",children:[(0,a.jsx)(eh,{connectionState:l}),(0,a.jsx)("button",{onClick:()=>n(!0),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Settings"})]})]})})}),(0,a.jsx)("main",{className:"mx-auto max-w-6xl px-8 py-12",children:i?(0,a.jsx)(U,{dashboardData:i,onCurrentlyPlayingChange:r}):(0,a.jsx)(F,{})}),(0,a.jsx)(P,{status:null!==(e=null==i?void 0:i.status)&&void 0!==e?e:null,currentlyPlaying:o}),(0,a.jsx)(em,{isOpen:t,onClose:()=>n(!1)})]})}ed.displayName=ec.bL.displayName},5604:(e,t,n)=>{"use strict";n.r(t),n.d(t,{debugUploadCoordinator:()=>r,uploadCoordinator:()=>o});var a=n(1886);class s{async startUpload(e){let t;let n=await e.arrayBuffer();try{var a,s;if(null===(s=crypto)||void 0===s?void 0:null===(a=s.subtle)||void 0===a?void 0:a.digest)t=await crypto.subtle.digest("SHA-256",n);else throw Error("Web Crypto API not available")}catch(a){console.warn("Web Crypto API not available, using fallback hash:",a),t=this.createFallbackHash(e,n)}let o=Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("").slice(0,16),r=e.name.replace(/\.[^.]+$/,"").replace(/\s+/g,"_").toLowerCase(),i="".concat(r,"_").concat(o),l="upload_".concat(i);if(this.transactions.has(l)){let t=this.transactions.get(l);if("error"!==t.state&&"cancelled"!==t.state)throw console.warn("Blocking duplicate upload: ".concat(e.name," (ID: ").concat(l,")")),Error("Upload already in progress: ".concat(e.name));console.log("Replacing failed upload transaction: ".concat(l)),this.cleanupTransaction(l)}if(Array.from(this.transactions.values()).find(t=>t.filename===e.name&&"error"!==t.state&&"cancelled"!==t.state&&"complete"!==t.state))throw console.warn("Blocking duplicate upload by filename: ".concat(e.name)),Error("Upload already in progress: ".concat(e.name));let c={id:l,filename:e.name,originalFile:e,state:"pending",progress:0,stage:"queued",createdAt:Date.now(),expectedSlug:i};return this.transactions.set(l,c),this.persistTransaction(c),this.emit(c,"queued",0,"Upload queued"),this.activeCount<this.maxConcurrent&&this.processTransaction(l),l}createFallbackHash(e,t){let n=new Uint8Array(t),a=0;for(let t=0;t<e.name.length;t++)a=31*a+e.name.charCodeAt(t)&0xffffffff;a=31*a+e.size&0xffffffff;for(let t=0;t<e.type.length;t++)a=31*a+e.type.charCodeAt(t)&0xffffffff;let s=Math.min(1024,n.length),o=Math.max(1,Math.floor(n.length/s));for(let e=0;e<n.length;e+=o)a=31*a+n[e]&0xffffffff;let r=new ArrayBuffer(32),i=new DataView(r);for(let e=0;e<8;e++)i.setUint32(4*e,a+31*e,!1);return r}async processTransaction(e){let t=this.transactions.get(e);if(t){this.activeCount++;try{await this.processFile(t),await this.uploadFiles(t),await this.waitForCompletion(t),this.updateTransaction(t,"complete",100,"Upload complete")}catch(s){let a=s instanceof Error?s.message:String(s);this.updateTransaction(t,"error",0,a),console.error("Upload failed [".concat(e,"]:"),s);try{let{forceStopProgress:e}=await Promise.resolve().then(n.bind(n,1886));await e(),console.log("Force stopped backend progress display after upload failure")}catch(e){console.warn("Failed to force stop backend progress:",e)}}finally{this.cleanupTransaction(e),this.activeCount--,this.processNextQueued()}}}async processFile(e){if(!e.originalFile)throw Error("Original file not available for processing");this.updateTransaction(e,"processing",0,"Starting conversion...");let t=e.originalFile;if("image/svg+xml"===e.originalFile.type||e.originalFile.name.toLowerCase().endsWith(".svg")){this.updateTransaction(e,"processing",5,"Converting SVG to PNG...");let{convertSvgToRgb565Zip:t}=await n.e(405).then(n.bind(n,9405));try{let n=await t(e.originalFile,{onProgress:(t,n)=>{let a=Math.min(.4*t,40);this.updateTransaction(e,"processing",a,this.getStageMessage(n))}},e.expectedSlug);e.zipBlob=n.blob;return}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("SVG conversion failed: ".concat(e))}}return new Promise((a,s)=>{let o=new Worker(n.tu(new URL(n.p+n.u(158),n.b)));this.workers.set(e.id,o),o.addEventListener("message",t=>{let{id:n,progress:r,stage:i,done:l,blob:c,error:d}=t.data;if(n===e.id){if(d){o.terminate(),this.workers.delete(e.id),s(Error(d));return}if("number"==typeof r&&i){let t=Math.min(.4*r,40);this.updateTransaction(e,"processing",t,this.getStageMessage(i))}l&&c&&(e.zipBlob=c,o.terminate(),this.workers.delete(e.id),a())}}),o.postMessage({id:e.id,file:t,expectedSlug:e.expectedSlug}),setTimeout(()=>{this.workers.has(e.id)&&(o.terminate(),this.workers.delete(e.id),s(Error("Processing timeout")))},3e5)})}async uploadFiles(e){if(!e.zipBlob)throw Error("ZIP blob not available");if(!e.originalFile)throw Error("Original file not available for upload");this.updateTransaction(e,"uploading",40,"Uploading files...");let t=new FormData;t.append("files",e.originalFile,e.filename),t.append("files",e.zipBlob,"".concat(this.getBasename(e.filename),"_frames.zip"));let n=await (0,a.KG)(t,"".concat(e.filename," + frames"),t=>{this.updateTransaction(e,"uploading",40+20*t,"Uploading files...")});e.uploadResult=n}async waitForCompletion(e){return this.updateTransaction(e,"finalizing",60,"Processing on device..."),new Promise(t=>{let n=setTimeout(()=>{console.warn("Timeout waiting for completion: ".concat(e.filename)),t()},3e4);e.completionCallback=()=>{clearTimeout(n),t()}})}updateTransaction(e,t,n,a){e.state=t,e.progress=Math.round(n),e.stage=a,this.persistTransaction(e),this.emit(e,a,n)}emit(e,t,n,a){let s={transaction:{...e},stage:t,progress:n,message:a};this.listeners.forEach(e=>{try{e(s)}catch(e){console.error("Upload progress listener error:",e)}})}cleanupTransaction(e){console.log("Cleaning up transaction: ".concat(e));let t=this.workers.get(e);t&&(t.terminate(),this.workers.delete(e));let n=this.transactions.get(e);n&&n.completionCallback&&delete n.completionCallback,setTimeout(()=>{this.transactions.delete(e),localStorage.removeItem("upload_tx_".concat(e)),console.log("Transaction ".concat(e," removed from memory"))},3e5)}processNextQueued(){if(this.activeCount>=this.maxConcurrent)return;let e=Array.from(this.transactions.values()).filter(e=>"pending"===e.state).sort((e,t)=>e.createdAt-t.createdAt);e.length>0&&(console.log("Processing next queued transaction: ".concat(e[0].id," (").concat(e.length," pending, ").concat(this.activeCount," active)")),this.processTransaction(e[0].id))}setupWebSocketListeners(){window.addEventListener("mediaUploaded",e=>{let t=e.detail;for(let e of(console.log("\uD83D\uDCE1 Received mediaUploaded event:",t),this.transactions.values())){if("finalizing"!==e.state&&"uploading"!==e.state)continue;let n=e.filename===(null==t?void 0:t.filename),a=((null==t?void 0:t.filename)||"").replace(/\.[^.]+$/,"").toLowerCase(),s=e.filename.replace(/\.[^.]+$/,"").toLowerCase(),o=s===a||s.includes(a)||a.includes(s)||e.filename.toLowerCase().includes(a);if(n||o){console.log("✅ Matched upload completion: ".concat(e.filename," -> ").concat(t.slug," (").concat(n?"exact":"fuzzy"," match)")),this.updateTransaction(e,"complete",100,"Upload complete");let a=e.completionCallback;a&&a();break}}}),window.addEventListener("uploadProgress",e=>{let{filename:t,progress:n,percent:a,stage:s}=e.detail||{},o=void 0!==n?n:a;if(void 0!==o&&t){console.log("\uD83D\uDCCA Backend upload progress: ".concat(t," ").concat(o,"% (").concat(s,")"));let e=Array.from(this.transactions.values()).filter(e=>"finalizing"===e.state);console.log("\uD83D\uDD0D Looking for match among ".concat(e.length," finalizing transactions:"),e.map(e=>"".concat(e.filename," (").concat(e.id.slice(0,8),")")));let n=!1;for(let e of this.transactions.values()){if("finalizing"!==e.state&&"uploading"!==e.state)continue;let a=e.filename===t,r=t.replace(/\.[^.]+$/,"").toLowerCase(),i=e.filename.replace(/\.[^.]+$/,"").toLowerCase(),l=i===r||i.includes(r)||r.includes(i)||e.filename.toLowerCase().includes(r);if(a||l){let r;if(console.log('✅ Found matching transaction: "'.concat(e.filename,'" vs "').concat(t,'" (').concat(a?"exact":"fuzzy"," match)")),console.log("\uD83D\uDD0D Progress mapping debug: filename=".concat(t,", backendProgress=").concat(o,', stage="').concat(s,'"')),"complete"===s)r=100,console.log("✅ Complete stage: mapped to ".concat(r,"%"));else if("finalizing"===s){let e=60+35/65*(o-20);r=Math.min(95,Math.max(60,e)),console.log("\uD83D\uDCCA Finalizing stage: ".concat(o,"% -> ").concat(e," -> ").concat(r,"% (clamped)"))}else r=Math.min(95,Math.max(60,60+35/65*(o-20))),console.log('⚠️  Unknown stage "'.concat(s,'": treating as finalizing ').concat(o,"% -> ").concat(r,"%"));console.log("\uD83C\uDFAF Updating transaction ".concat(e.id,": ").concat(e.progress,"% -> ").concat(Math.round(r),"%")),this.updateTransaction(e,"finalizing",Math.round(r),this.getStageMessage(s)||"Processing on device..."),n=!0;break}}n||console.warn('❌ No matching finalizing transaction found for "'.concat(t,'"'))}}),window.addEventListener("uploadFinalizingProgress",e=>{let{filename:t,progress:n,stage:a}=e.detail;for(let e of(console.log("\uD83D\uDCCA Upload finalizing progress: ".concat(t," ").concat(n,"% (").concat(a,")")),this.transactions.values()))if(e.filename===t&&"finalizing"===e.state){let t=60+.4*n;this.updateTransaction(e,"finalizing",t,"Processing on device...");break}})}persistTransaction(e){try{let t={...e,originalFile:void 0,zipBlob:void 0};localStorage.setItem("upload_tx_".concat(e.id),JSON.stringify(t))}catch(e){console.warn("Failed to persist transaction:",e)}}restoreTransactions(){try{for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(null==t?void 0:t.startsWith("upload_tx_")){let e=localStorage.getItem(t);if(e){let n=JSON.parse(e);Date.now()-n.createdAt<36e5?("complete"!==n.state&&"error"!==n.state&&(n.state="error",n.stage="interrupted"),this.transactions.set(n.id,n)):localStorage.removeItem(t)}}}}catch(e){console.warn("Failed to restore transactions:",e)}}getBasename(e){return e.replace(/\.[^.]+$/,"")}getStageMessage(e){switch(e){case"resizing":return"Optimizing video...";case"converting":case"extracting":return"Extracting frames...";case"finalizing":return"Processing on device...";case"organizing":return"Organizing files...";case"complete":return"Upload complete";default:return"Processing..."}}onProgress(e){return this.listeners.add(e),()=>this.listeners.delete(e)}getTransaction(e){return this.transactions.get(e)}getAllTransactions(){return Array.from(this.transactions.values())}cancelUpload(e){let t=this.transactions.get(e);t&&"complete"!==t.state&&(console.log("Cancelling upload: ".concat(e)),this.updateTransaction(t,"cancelled",0,"Cancelled"),this.cleanupTransaction(e),this.activeCount=Math.max(0,this.activeCount-1),this.processNextQueued())}getStats(){let e=Array.from(this.transactions.values()).reduce((e,t)=>(e[t.state]=(e[t.state]||0)+1,e),{});return{active:this.activeCount,pending:e.pending||0,total:this.transactions.size}}constructor(){this.transactions=new Map,this.workers=new Map,this.listeners=new Set,this.maxConcurrent=2,this.activeCount=0,this.restoreTransactions(),this.setupWebSocketListeners()}}let o=new s,r={getStats:()=>(null==o?void 0:o.getStats())||{active:0,pending:0,total:0},getTransactions:()=>(null==o?void 0:o.getAllTransactions())||[],cancelAll:()=>{o&&o.getAllTransactions().forEach(e=>{"complete"!==e.state&&"error"!==e.state&&o.cancelUpload(e.id)})},reset:()=>{if(o){for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);(null==t?void 0:t.startsWith("upload_tx_"))&&localStorage.removeItem(t)}console.log("Upload coordinator reset")}}}}},e=>{var t=t=>e(e.s=t);e.O(0,[671,484,441,684,358],()=>t(2857)),_N_E=e.O()}]);