"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[637],{9637:(e,t,a)=>{a.d(t,{convertToRgb565Zip:()=>s});let o=null;async function n(){if(o)return o;let{FFmpeg:e}=await a.e(654).then(a.bind(a,5654));return o=e}async function l(){let e=new(await n());return await e.load({corePath:"/ffmpeg/umd/ffmpeg-core.js",log:!0}),e}function i(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var r=a(9311),c=a.n(r);async function g(e,t,a){var o,n,l,i,r,c;null===(o=a.onProgress)||void 0===o||o.call(a,0,"resizing"),null===(n=a.onLog)||void 0===n||n.call(a,"Starting video optimization..."),e.on("log",e=>{let{message:t}=e});let g="scale=".concat(320,":").concat(240,":force_original_aspect_ratio=increase,crop=").concat(320,":").concat(240,",fps=").concat(25);await e.exec(["-i",t,"-vf",g,"-c:v","mpeg4","-q:v","8","-an","-y","optimized.mp4"]),null===(l=a.onProgress)||void 0===l||l.call(a,15,"resizing"),null===(i=a.onLog)||void 0===i||i.call(a,"Video optimization complete");try{await e.deleteFile(t),null===(r=a.onLog)||void 0===r||r.call(a,"Deleted original ".concat(t," from MEMFS after optimization"))}catch(e){null===(c=a.onLog)||void 0===c||c.call(a,"Warning: Could not delete ".concat(t,": ").concat(e))}}async function s(e){var t,a,o,n,r,s,f,d,m,p,u,v,h,x,w;let y,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_="input_media",F=e.type.startsWith("image/")||e.name.toLowerCase().match(/\.(jpg|jpeg|png|gif|bmp|webp)$/),L=new Uint8Array(await e.arrayBuffer()),D=null;if(F){let n=await l();await n.writeFile(_,L),null===(t=b.onProgress)||void 0===t||t.call(b,0,"converting");let r="output.raw";await n.exec(["-i",_,"-vf","scale=".concat(320,":").concat(240,":force_original_aspect_ratio=increase,crop=").concat(320,":").concat(240),"-f","rawvideo","-pix_fmt","rgb565be","-vframes","1",r]),D=await n.readFile(r),y=1,await n.deleteFile(r),null===(a=b.onProgress)||void 0===a||a.call(b,90,"converting");let g=new(c());g.file("frame_000001.rgb",D);let s=e.name.replace(/\.[^./]+$/,"").replace(/\s+/g,"_").toLowerCase().concat("_",i().slice(0,8)),f={slug:s,original_filename:e.name,type:"image",width:320,height:240,frame_count:1,format:"rgb565",fps:0};if(g.file("metadata.json",JSON.stringify(f)),"function"==typeof n.exit)try{await n.exit()}catch(e){}return null===(o=b.onProgress)||void 0===o||o.call(b,100,"converting"),{slug:s,blob:await g.generateAsync({type:"blob"})}}{let t=await l();await t.writeFile(_,L),L=null,await g(t,_,b),null===(n=b.onProgress)||void 0===n||n.call(b,15,"converting"),null===(r=b.onLog)||void 0===r||r.call(b,"Starting frame extraction..."),t.on("log",e=>{var t;let{message:a}=e;null===(t=b.onLog)||void 0===t||t.call(b,a)});let a=new(c()),o="frame_%06d.rgb",F="optimized.mp4",D=0,P=0;for(;;){let e=0===D?["-i",F,"-frames:v","".concat(75),"-an","-threads","1","-c:v","rawvideo","-pix_fmt","rgb565be","-f","image2","-fps_mode","passthrough",o]:["-ss","".concat(D),"-i",F,"-frames:v","".concat(75),"-an","-threads","1","-c:v","rawvideo","-pix_fmt","rgb565be","-f","image2","-fps_mode","passthrough",o];try{await t.exec(e)}catch(e){if(!String(e||"").includes("Aborted"))throw e}let n=[];try{console.log("[DEBUG] Attempting to list files after FFmpeg exec...");let e=await t.listDir("/");console.log("[DEBUG] Raw fileList:",e),n=e.filter(e=>{let t=e.name||e;return/^frame_\d{6}\.rgb$/.test(t)}),console.log("[DEBUG] Filtered frameFiles:",n),null===(p=b.onLog)||void 0===p||p.call(b,"Found ".concat(e.length," total files: ").concat(e.map(e=>e.name||e).join(", "))),null===(u=b.onLog)||void 0===u||u.call(b,"Found ".concat(n.length," frame files: ").concat(n.map(e=>e.name||e).join(", ")))}catch(e){console.log("[DEBUG] listDir failed, trying alternative approach:",e);for(let e=1;e<=75;e++){let a="frame_".concat(e.toString().padStart(6,"0"),".rgb");try{let e=await t.readFile(a);e&&e.length>0&&n.push(a)}catch(e){break}}console.log("[DEBUG] Fallback method found ".concat(n.length," files:"),n),null===(v=b.onLog)||void 0===v||v.call(b,"Fallback method found ".concat(n.length," frame files"))}if(0===n.length){if(0===P)throw null===(h=b.onLog)||void 0===h||h.call(b,"First chunk failed - no frames found. Check debug logs above."),Error("FFmpeg could not extract frames");break}for(let e of(n.sort((e,t)=>{let a="string"==typeof e?e:e.name,o="string"==typeof t?t:t.name;return parseInt(a.match(/\d+/)[0])-parseInt(o.match(/\d+/)[0])}),n)){let o="string"==typeof e?e:e.name;console.log("[DEBUG] Processing frame file: ".concat(o));let n=await t.readFile(o);P++,a.file("frame_".concat(P.toString().padStart(6,"0"),".rgb"),n);try{await t.deleteFile(o)}catch(e){console.log("[DEBUG] Could not delete ".concat(o,":"),e)}}let l=15+(D+=3)/600*80;null===(m=b.onProgress)||void 0===m||m.call(b,Math.min(l,95),"converting")}y=P,null===(s=b.onProgress)||void 0===s||s.call(b,95,"converting"),null===(f=b.onLog)||void 0===f||f.call(b,"Packaging frames...");let S=e.name.replace(/\.[^./]+$/,"").replace(/\s+/g,"_").toLowerCase().concat("_",i().slice(0,8)),U={slug:S,original_filename:e.name,type:"video",width:320,height:240,frame_count:y,format:"rgb565",fps:25};a.file("metadata.json",JSON.stringify(U));let k=await a.generateAsync({type:"blob"});if(null===(d=b.onProgress)||void 0===d||d.call(b,100,"converting"),"function"==typeof t.exit)try{await t.exit(),null===(x=b.onLog)||void 0===x||x.call(b,"FFmpeg WASM heap released")}catch(e){null===(w=b.onLog)||void 0===w||w.call(b,"Warning: FFmpeg cleanup failed: ".concat(e))}return{slug:S,blob:k}}}}}]);