(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[37,137],{666:e=>{!function(){var t={229:function(e){var t,n,r,o=e.exports={};function i(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c=[],s=!1,u=-1;function f(){s&&r&&(s=!1,r.length?c=r.concat(c):u=-1,c.length&&g())}function g(){if(!s){var e=l(f);s=!0;for(var t=c.length;t;){for(r=c,c=[];++u<t;)r&&r[u].run();u=-1,t=c.length}r=null,s=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function d(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||s||l(g)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=d,o.addListener=d,o.once=d,o.off=d,o.removeListener=d,o.removeAllListeners=d,o.emit=d,o.prependListener=d,o.prependOnceListener=d,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={exports:{}},a=!0;try{t[e](i,i.exports,r),a=!1}finally{a&&delete n[e]}return i.exports}r.ab="//",e.exports=r(229)}()},8137:(e,t,n)=>{"use strict";n.d(t,{convertToRgb565Zip:()=>s});let r=null;async function o(){if(r)return r;let{FFmpeg:e}=await n.e(654).then(n.bind(n,5654));return r=e}async function i(){let e=new(await o());return await e.load({corePath:"/ffmpeg/umd/ffmpeg-core.js",log:!0}),e}var a=n(9311),l=n.n(a);async function c(e,t,n){var r,o,i,a,l,c;null===(r=n.onProgress)||void 0===r||r.call(n,0,"resizing"),null===(o=n.onLog)||void 0===o||o.call(n,"Starting video optimization...");let s=e=>{var t;let{progress:r}=e;null===(t=n.onProgress)||void 0===t||t.call(n,15*r,"resizing")},u=e=>{let{message:t}=e};e.on("progress",s),e.on("log",u);let f="scale=".concat(320,":").concat(240,":force_original_aspect_ratio=increase,crop=").concat(320,":").concat(240,",fps=").concat(25);await e.exec(["-i",t,"-vf",f,"-c:v","mpeg4","-q:v","8","-an","-y","optimized.mp4"]),e.off("progress",s),e.off("log",u),null===(i=n.onProgress)||void 0===i||i.call(n,15,"resizing"),null===(a=n.onLog)||void 0===a||a.call(n,"Video optimization complete");try{await e.deleteFile(t),null===(l=n.onLog)||void 0===l||l.call(n,"Deleted original ".concat(t," from MEMFS after optimization"))}catch(e){null===(c=n.onLog)||void 0===c||c.call(n,"Warning: Could not delete ".concat(t,": ").concat(e))}}async function s(e){var t,n,r,o,a,s,u,f,g,p,d,v,m,h;let w,y,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0,_="input_media";if(x)w=x;else{let t=await e.arrayBuffer(),n=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("").slice(0,16),r=e.name.replace(/\.[^.]+$/,"").replace(/\s+/g,"_").toLowerCase();w="".concat(r,"_").concat(n)}let L=e.type.startsWith("image/")||e.name.toLowerCase().match(/\.(jpg|jpeg|png|gif|bmp|webp)$/),T=new Uint8Array(await e.arrayBuffer());if(L){let o=await i();await o.writeFile(_,T),null===(t=b.onProgress)||void 0===t||t.call(b,0,"converting");let a="output.raw";await o.exec(["-i",_,"-vf","scale=".concat(320,":").concat(240,":force_original_aspect_ratio=increase,crop=").concat(320,":").concat(240),"-f","rawvideo","-pix_fmt","rgb565be","-vframes","1",a]);let c=await o.readFile(a);y=1,await o.deleteFile(a),null===(n=b.onProgress)||void 0===n||n.call(b,90,"converting");let s=new(l()),u=new Uint8Array(8+c.length),f=new DataView(u.buffer);f.setUint32(0,y,!1),f.setUint32(4,153600,!1),u.set(c,8),s.file("frames.bin",u);let g={slug:w,original_filename:e.name,type:"image",width:320,height:240,frame_count:y,format:"rgb565",fps:0};if(s.file("metadata.json",JSON.stringify(g)),"function"==typeof o.exit)try{await o.exit()}catch(e){}return null===(r=b.onProgress)||void 0===r||r.call(b,100,"converting"),{slug:w,blob:await s.generateAsync({type:"blob"})}}{let t;let n=await i();await n.writeFile(_,T),T=null,await c(n,_,b),null===(o=b.onProgress)||void 0===o||o.call(b,15,"converting"),null===(a=b.onLog)||void 0===a||a.call(b,"Starting streaming frame extraction..."),n.on("log",e=>{var t;let{message:n}=e;null===(t=b.onLog)||void 0===t||t.call(b,n)});let r="all_frames.bin";null===(s=b.onLog)||void 0===s||s.call(b,"Extracting all frames to single binary file...");try{await n.exec(["-i","optimized.mp4","-an","-pix_fmt","rgb565be","-c:v","rawvideo","-f","rawvideo",r])}catch(e){if(!String(e||"").includes("Aborted"))throw e}try{t=await n.readFile(r),null===(d=b.onLog)||void 0===d||d.call(b,"Binary extraction complete: ".concat(t.length," bytes"))}catch(e){throw null===(v=b.onLog)||void 0===v||v.call(b,"Failed to read binary output: ".concat(e)),Error("FFmpeg failed to generate binary frame data")}if(0===(y=Math.floor(t.length/153600)))throw Error("No frames extracted - binary file size: ".concat(t.length," bytes"));null===(u=b.onProgress)||void 0===u||u.call(b,80,"converting"),null===(f=b.onLog)||void 0===f||f.call(b,"Extracted ".concat(y," frames (").concat(t.length," bytes)"));let x=new Uint8Array(8+t.length),L=new DataView(x.buffer);L.setUint32(0,y,!1),L.setUint32(4,153600,!1),x.set(t,8),null===(g=b.onProgress)||void 0===g||g.call(b,90,"converting");let F=new(l());F.file("frames.bin",x);let A={slug:w,original_filename:e.name,type:"video",width:320,height:240,frame_count:y,format:"rgb565",fps:25};F.file("metadata.json",JSON.stringify(A));let E=await F.generateAsync({type:"blob"});if(null===(p=b.onProgress)||void 0===p||p.call(b,100,"converting"),"function"==typeof n.exit)try{await n.exit(),null===(m=b.onLog)||void 0===m||m.call(b,"FFmpeg WASM heap released")}catch(e){null===(h=b.onLog)||void 0===h||h.call(b,"Warning: FFmpeg cleanup failed: ".concat(e))}return{slug:w,blob:E}}}},9509:(e,t,n)=>{"use strict";var r,o;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(666)}}]);